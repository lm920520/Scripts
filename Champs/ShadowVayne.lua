--[[

	Shadow Vayne Script by Superx321
	Version: 2.75

	For Functions & Changelog, check the Thread on the BoL Forums:
	http://botoflegends.com/forum/topic/18939-shadow-vayne-the-mighty-hunter/

	If anything is not working or u wish a new Function, let me know it

	Thx to Jus & Hellsing for minor helping, Manciuszz for his Gapcloserlist and Klokje for his Interruptlist
	]]

if myHero.charName ~= "Vayne" then return end
if not VIP_USER then
	rawset(_G, "LoadVIPScript", function() return end)
end
local informationTable, AAInfoTable, CastedLastE, ScriptStartTick = {}, {}, 0, 0
local TickCountScriptStart, OnLoadDone, spellExpired, Beta = GetTickCount(), nil, true, false
local ScriptOnLoadDone, LastAttackedEnemy = false, nil
local LastPrioUpdate = 0
_G.SV_PERMASHOW = {}

-- ScriptConfigHook Start
function _ScriptConfigHookCheck()
	function _StringDecode(data)
		local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
		data = string.gsub(data, '[^'..b..'=]', '')
		return (data:gsub('.', function(x)
			if (x == '=') then return '' end
			local r,f='',(b:find(x)-1)
			for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
			return r;
		end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
			if (#x ~= 8) then return '' end
			local c=0
			for i=1,8 do c=c+(x:sub(i,i)=='1' and 2^(8-i) or 0) end
			return string.char(c)
		end))
	end

	if FileExist(SCRIPT_PATH.."/Common/ScriptConfigHook.lua") then
		ScriptConfigHookVersionMain = 1
		require "ScriptConfigHook"
		if ScriptConfigHookVersion == nil then ScriptConfigHookVersion = 0 end
		if tonumber(ScriptConfigHookVersionMain) > tonumber(ScriptConfigHookVersion) then
			OverWriteScriptConfigFile = true
		end
	end

	if not FileExist(SCRIPT_PATH.."/Common/ScriptConfigHook.lua") or OverWriteScriptConfigFile then
		ScriptConfigHookString = "U2NyaXB0Q29uZmlnSG9va1ZlcnNpb24gPSAxCmZ1bmN0aW9uIF9Mb2FkQ3VzdG9tQWxsQ2xhc3MoKQotLSBQcmVkaWN0aW9uIEZ1bmN0aW9ucwotLVtbCiAgICBHbG9iYWxzIEZ1bmN0aW9ucwogICAgICAgIEdldFByZWRpY3Rpb25Qb3MoaUhlcm8sIGRlbGF5KSAgICAgICAgICAgICAgICAgIC0tIHJldHVybiBuZXh0UG9zaXRpb24gaW4gZGVsYXkgKG1zKSBmb3IgaUhlcm8gKGluZGV4KQogICAgICAgIEdldFByZWRpY3Rpb25Qb3MoSGVybywgZGVsYXkpICAgICAgICAgICAgICAgICAgIC0tIHJldHVybiBuZXh0UG9zaXRpb24gaW4gZGVsYXkgKG1zKSBmb3IgSGVybwogICAgICAgIEdldFByZWRpY3Rpb25Qb3MoY2hhck5hbWUsIGRlbGF5LCBlbmVteVRlYW0pICAgIC0tIHJldHVybiBuZXh0UG9zaXRpb24gaW4gZGVsYXkgKG1zKSBmb3IgY2hhck5hbWUgaW4gZW5lbXlUZWFtICh0cnVlL2ZhbHNlLCBkZWZhdWx0IHRydWUpCiAgICAgICAgR2V0UHJlZGljdGlvbkhlYWx0aChpSGVybywgZGVsYXkpICAgICAgICAgICAgICAgLS0gcmV0dXJuIG5leHQgSGVhbHRoIGluIGRlbGF5IChtcykgZm9yIGlIZXJvIChpbmRleCkKICAgICAgICBHZXRQcmVkaWN0aW9uSGVhbHRoKEhlcm8sIGRlbGF5KSAgICAgICAgICAgICAgICAtLSByZXR1cm4gbmV4dCBIZWFsdGggaW4gZGVsYXkgKG1zKSBmb3IgSGVybwogICAgICAgIEdldFByZWRpY3Rpb25IZWFsdGgoY2hhck5hbWUsIGRlbGF5LCBlbmVteVRlYW0pIC0tIHJldHVybiBuZXh0IEhlYWx0aCBpbiBkZWxheSAobXMpIGZvciBjaGFyTmFtZSBpbiBlbmVteVRlYW0gKHRydWUvZmFsc2UsIGRlZmF1bHQgdHJ1ZSkKXV0KLS0gUHJlZGljdGlvbiBGdW5jdGlvbnMKLS1bWwogICAgR2xvYmFscyBGdW5jdGlvbnMKICAgICAgICBHZXRQcmVkaWN0aW9uUG9zKGlIZXJvLCBkZWxheSkgICAgICAgICAgICAgICAgICAtLSByZXR1cm4gbmV4dFBvc2l0aW9uIGluIGRlbGF5IChtcykgZm9yIGlIZXJvIChpbmRleCkKICAgICAgICBHZXRQcmVkaWN0aW9uUG9zKEhlcm8sIGRlbGF5KSAgICAgICAgICAgICAgICAgICAtLSByZXR1cm4gbmV4dFBvc2l0aW9uIGluIGRlbGF5IChtcykgZm9yIEhlcm8KICAgICAgICBHZXRQcmVkaWN0aW9uUG9zKGNoYXJOYW1lLCBkZWxheSwgZW5lbXlUZWFtKSAgICAtLSByZXR1cm4gbmV4dFBvc2l0aW9uIGluIGRlbGF5IChtcykgZm9yIGNoYXJOYW1lIGluIGVuZW15VGVhbSAodHJ1ZS9mYWxzZSwgZGVmYXVsdCB0cnVlKQogICAgICAgIEdldFByZWRpY3Rpb25IZWFsdGgoaUhlcm8sIGRlbGF5KSAgICAgICAgICAgICAgIC0tIHJldHVybiBuZXh0IEhlYWx0aCBpbiBkZWxheSAobXMpIGZvciBpSGVybyAoaW5kZXgpCiAgICAgICAgR2V0UHJlZGljdGlvbkhlYWx0aChIZXJvLCBkZWxheSkgICAgICAgICAgICAgICAgLS0gcmV0dXJuIG5leHQgSGVhbHRoIGluIGRlbGF5IChtcykgZm9yIEhlcm8KICAgICAgICBHZXRQcmVkaWN0aW9uSGVhbHRoKGNoYXJOYW1lLCBkZWxheSwgZW5lbXlUZWFtKSAtLSByZXR1cm4gbmV4dCBIZWFsdGggaW4gZGVsYXkgKG1zKSBmb3IgY2hhck5hbWUgaW4gZW5lbXlUZWFtICh0cnVlL2ZhbHNlLCBkZWZhdWx0IHRydWUpCl1dCmxvY2FsIF9nYW1lSGVyb2VzLCBfZ2FtZUFsbHlDb3VudCwgX2dhbWVFbmVteUNvdW50ID0ge30sIDAsIDAKLS0gQ2xhc3MgcmVsYXRlZCBmdW5jdGlvbgpsb2NhbCBmdW5jdGlvbiBfZ2FtZUhlcm9lc19faW5pdCgpCiAgICBpZiAjX2dhbWVIZXJvZXMgPT0gMCB0aGVuCiAgICAgICAgX2dhbWVBbGx5Q291bnQsIF9nYW1lRW5lbXlDb3VudCA9IDAsIDAKICAgICAgICBmb3IgaSA9IDEsIGhlcm9NYW5hZ2VyLmlDb3VudCBkbwogICAgICAgICAgICBsb2NhbCBoZXJvID0gaGVyb01hbmFnZXI6Z2V0SGVybyhpKQogICAgICAgICAgICBpZiBoZXJvIH49IG5pbCBhbmQgaGVyby52YWxpZCB0aGVuCiAgICAgICAgICAgICAgICBpZiBoZXJvLnRlYW0gPT0gcGxheWVyLnRlYW0gdGhlbgogICAgICAgICAgICAgICAgICAgIF9nYW1lQWxseUNvdW50ID0gX2dhbWVBbGx5Q291bnQgKyAxCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KF9nYW1lSGVyb2VzLCB7IGhlcm8gPSBoZXJvLCBpbmRleCA9IGksIHRJbmRleCA9IF9nYW1lQWxseUNvdW50LCBpZ25vcmUgPSBmYWxzZSwgcHJpb3JpdHkgPSAxLCBlbmVteSA9IGZhbHNlIH0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2dhbWVFbmVteUNvdW50ID0gX2dhbWVFbmVteUNvdW50ICsgMQogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChfZ2FtZUhlcm9lcywgeyBoZXJvID0gaGVybywgaW5kZXggPSBpLCB0SW5kZXggPSBfZ2FtZUVuZW15Q291bnQsIGlnbm9yZSA9IGZhbHNlLCBwcmlvcml0eSA9IDEsIGVuZW15ID0gdHJ1ZSB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gX2dhbWVIZXJvZXNfX2V4dGVuZGVkKHRhcmdldCwgYXNzZXJ0VGV4dCkKICAgIGxvY2FsIGFzc2VydFRleHQgPSBhc3NlcnRUZXh0IG9yICIiCiAgICBpZiB0eXBlKHRhcmdldCkgPT0gIm51bWJlciIgdGhlbgogICAgICAgIHJldHVybiBfZ2FtZUhlcm9lc1t0YXJnZXRdCiAgICBlbHNlaWYgdGFyZ2V0IH49IG5pbCBhbmQgdGFyZ2V0LnZhbGlkIHRoZW4KICAgICAgICBhc3NlcnQodHlwZSh0YXJnZXQubmV0d29ya0lEKSA9PSAibnVtYmVyIiwgYXNzZXJ0VGV4dCAuLiAiOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPGNoYXJOYW1lPiBvciA8aGVyb0luZGV4PiBvciA8aGVybz4gZXhwZWN0ZWQpIikKICAgICAgICBmb3IgXywgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICAgICAgaWYgX2dhbWVIZXJvLmhlcm8ubmV0d29ya0lEID09IHRhcmdldC5uZXR3b3JrSUQgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIF9nYW1lSGVybwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIF9nYW1lSGVyb2VzX19oZXJvKHRhcmdldCwgYXNzZXJ0VGV4dCwgZW5lbXlUZWFtKQogICAgbG9jYWwgYXNzZXJ0VGV4dCA9IGFzc2VydFRleHQgb3IgIiIKICAgIGVuZW15VGVhbSA9IChlbmVteVRlYW0gfj0gZmFsc2UpCiAgICBpZiB0eXBlKHRhcmdldCkgPT0gInN0cmluZyIgdGhlbgogICAgICAgIGZvciBfLCBfZ2FtZUhlcm8gaW4gaXBhaXJzKF9nYW1lSGVyb2VzKSBkbwogICAgICAgICAgICBpZiBfZ2FtZUhlcm8uaGVyby5jaGFyTmFtZSA9PSB0YXJnZXQgYW5kIChfZ2FtZUhlcm8uaGVyby50ZWFtIH49IHBsYXllci50ZWFtKSA9PSBlbmVteVRlYW0gdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIF9nYW1lSGVyby5oZXJvCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZWlmIHR5cGUodGFyZ2V0KSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgcmV0dXJuIGhlcm9NYW5hZ2VyOmdldEhlcm8odGFyZ2V0KQogICAgZWxzZWlmIHRhcmdldCA9PSBuaWwgdGhlbgogICAgICAgIHJldHVybiBHZXRUYXJnZXQoKQogICAgZWxzZQogICAgICAgIGFzc2VydCh0eXBlKHRhcmdldC5uZXR3b3JrSUQpID09ICJudW1iZXIiLCBhc3NlcnRUZXh0IC4uICI6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8Y2hhck5hbWU+IG9yIDxoZXJvSW5kZXg+IG9yIDxoZXJvPiBvciBuaWwgZXhwZWN0ZWQpIikKICAgICAgICByZXR1cm4gdGFyZ2V0CiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBfZ2FtZUhlcm9lc19faW5kZXgodGFyZ2V0LCBhc3NlcnRUZXh0LCBlbmVteVRlYW0pCiAgICBsb2NhbCBhc3NlcnRUZXh0ID0gYXNzZXJ0VGV4dCBvciAiIgogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGlmIHR5cGUodGFyZ2V0KSA9PSAic3RyaW5nIiB0aGVuCiAgICAgICAgZm9yIF8sIF9nYW1lSGVybyBpbiBpcGFpcnMoX2dhbWVIZXJvZXMpIGRvCiAgICAgICAgICAgIGlmIF9nYW1lSGVyby5oZXJvLmNoYXJOYW1lID09IHRhcmdldCBhbmQgKF9nYW1lSGVyby5oZXJvLnRlYW0gfj0gcGxheWVyLnRlYW0pID09IGVuZW15VGVhbSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gX2dhbWVIZXJvLmluZGV4CiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZWlmIHR5cGUodGFyZ2V0KSA9PSAibnVtYmVyIiB0aGVuCiAgICAgICAgcmV0dXJuIHRhcmdldAogICAgZWxzZQogICAgICAgIGFzc2VydCh0eXBlKHRhcmdldC5uZXR3b3JrSUQpID09ICJudW1iZXIiLCBhc3NlcnRUZXh0IC4uICI6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8Y2hhck5hbWU+IG9yIDxoZXJvSW5kZXg+IG9yIDxoZXJvPiBvciBuaWwgZXhwZWN0ZWQpIikKICAgICAgICByZXR1cm4gX2dhbWVIZXJvZXNfX2luZGV4KHRhcmdldC5jaGFyTmFtZSwgYXNzZXJ0VGV4dCwgKHRhcmdldC50ZWFtIH49IHBsYXllci50ZWFtKSkKICAgIGVuZAplbmQKCmxvY2FsIF9QcmVkaWN0aW9uID0geyBpbml0ID0gdHJ1ZSwgZGVsdGEgPSAxIH0KbG9jYWwgX19QcmVkaWN0aW9uX19PblRpY2sKbG9jYWwgZnVuY3Rpb24gX1ByZWRpY3Rpb25fX09uTG9hZCgpCiAgICBpZiBub3QgX19QcmVkaWN0aW9uX19PblRpY2sgdGhlbgogICAgICAgIGZ1bmN0aW9uIF9fUHJlZGljdGlvbl9fT25UaWNrKCkKICAgICAgICAgICAgbG9jYWwgdGljayA9IEdldFRpY2tDb3VudCgpCiAgICAgICAgICAgIF9QcmVkaWN0aW9uLmRlbHRhID0gMSAvICh0aWNrIC0gX1ByZWRpY3Rpb24udGljaykKICAgICAgICAgICAgX1ByZWRpY3Rpb24udGljayA9IHRpY2sKICAgICAgICAgICAgZm9yIF8sIF9nYW1lSGVybyBpbiBpcGFpcnMoX2dhbWVIZXJvZXMpIGRvCiAgICAgICAgICAgICAgICBpZiBfZ2FtZUhlcm8uaGVybyB+PSBuaWwgYW5kIF9nYW1lSGVyby5oZXJvLnZhbGlkIGFuZCBfZ2FtZUhlcm8uaGVyby5kZWFkID09IGZhbHNlIGFuZCBfZ2FtZUhlcm8uaGVyby52aXNpYmxlIHRoZW4KICAgICAgICAgICAgICAgICAgICBfZ2FtZUhlcm8ucFZlY3RvciA9IChWZWN0b3IoX2dhbWVIZXJvLmhlcm8pIC0gX2dhbWVIZXJvLmxhc3RQb3MpCiAgICAgICAgICAgICAgICAgICAgX2dhbWVIZXJvLmxhc3RQb3MgPSBWZWN0b3IoX2dhbWVIZXJvLmhlcm8pCiAgICAgICAgICAgICAgICAgICAgX2dhbWVIZXJvLnBIZWFsdGggPSBfZ2FtZUhlcm8uaGVyby5oZWFsdGggLSBfZ2FtZUhlcm8ubGFzdEhlYWx0aAogICAgICAgICAgICAgICAgICAgIF9nYW1lSGVyby5sYXN0SGVhbHRoID0gX2dhbWVIZXJvLmhlcm8uaGVhbHRoCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIEFkZFRpY2tDYWxsYmFjayhfX1ByZWRpY3Rpb25fX09uVGljaykKICAgIGVuZAogICAgX2dhbWVIZXJvZXNfX2luaXQoKQogICAgX1ByZWRpY3Rpb24udGljayA9IEdldFRpY2tDb3VudCgpCiAgICBmb3IgXywgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICBpZiBfZ2FtZUhlcm8uaGVybyB+PSBuaWwgYW5kIF9nYW1lSGVyby5oZXJvLnZhbGlkIHRoZW4KICAgICAgICAgICAgX2dhbWVIZXJvLnBWZWN0b3IgPSBWZWN0b3IoKQogICAgICAgICAgICBfZ2FtZUhlcm8ubGFzdFBvcyA9IFZlY3RvcihfZ2FtZUhlcm8uaGVybykKICAgICAgICAgICAgX2dhbWVIZXJvLnBIZWFsdGggPSAwCiAgICAgICAgICAgIF9nYW1lSGVyby5sYXN0SGVhbHRoID0gX2dhbWVIZXJvLmhlcm8uaGVhbHRoCiAgICAgICAgZW5kCiAgICBlbmQKICAgIF9QcmVkaWN0aW9uLmluaXQgPSBuaWwKZW5kCgpsb2NhbCBmdW5jdGlvbiBfUHJlZGljdGlvblBvc2l0aW9uKGlIZXJvLCBkZWxheSkKICAgIGxvY2FsIF9nYW1lSGVybyA9IF9nYW1lSGVyb2VzW2lIZXJvXQogICAgaWYgX2dhbWVIZXJvIGFuZCBWZWN0b3JUeXBlKF9nYW1lSGVyby5wVmVjdG9yKSBhbmQgVmVjdG9yVHlwZShfZ2FtZUhlcm8ubGFzdFBvcykgdGhlbgogICAgICAgIGxvY2FsIGhlcm9Qb3NpdGlvbiA9IF9nYW1lSGVyby5sYXN0UG9zICsgKF9nYW1lSGVyby5wVmVjdG9yICogKF9QcmVkaWN0aW9uLmRlbHRhICogZGVsYXkpKQogICAgICAgIGhlcm9Qb3NpdGlvbi55ID0gX2dhbWVIZXJvLmhlcm8ueQogICAgICAgIHJldHVybiBoZXJvUG9zaXRpb24KICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIF9QcmVkaWN0aW9uSGVhbHRoKGlIZXJvLCBkZWxheSkKICAgIGxvY2FsIF9nYW1lSGVybyA9IF9nYW1lSGVyb2VzW2lIZXJvXQogICAgaWYgX2dhbWVIZXJvIGFuZCBfZ2FtZUhlcm8ucEhlYWx0aCB+PSBuaWwgYW5kIF9nYW1lSGVyby5sYXN0SGVhbHRoIH49IG5pbCB0aGVuCiAgICAgICAgcmV0dXJuIF9nYW1lSGVyby5sYXN0SGVhbHRoICsgKF9nYW1lSGVyby5wSGVhbHRoICogKF9QcmVkaWN0aW9uLmRlbHRhICogZGVsYXkpKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gR2V0UHJlZGljdGlvblBvcyh0YXJnZXQsIGRlbGF5LCBlbmVteVRlYW0pCiAgICBpZiBfUHJlZGljdGlvbi5pbml0IHRoZW4gX1ByZWRpY3Rpb25fX09uTG9hZCgpIGVuZAogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGxvY2FsIGlIZXJvID0gX2dhbWVIZXJvZXNfX2luZGV4KHRhcmdldCwgIkdldFByZWRpY3Rpb25Qb3MiLCBlbmVteVRlYW0pCiAgICByZXR1cm4gX1ByZWRpY3Rpb25Qb3NpdGlvbihpSGVybywgZGVsYXkpCmVuZAoKZnVuY3Rpb24gR2V0UHJlZGljdGlvbkhlYWx0aCh0YXJnZXQsIGRlbGF5LCBlbmVteVRlYW0pCiAgICBpZiBfUHJlZGljdGlvbi5pbml0IHRoZW4gX1ByZWRpY3Rpb25fX09uTG9hZCgpIGVuZAogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGxvY2FsIGlIZXJvID0gX2dhbWVIZXJvZXNfX2luZGV4KHRhcmdldCwgIkdldFByZWRpY3Rpb25IZWFsdGgiLCBlbmVteVRlYW0pCiAgICByZXR1cm4gX1ByZWRpY3Rpb25IZWFsdGgoaUhlcm8sIGRlbGF5KQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBUYXJnZXRTZWxlY3RvciBDbGFzcwotLVtbClRhcmdldFNlbGVjdG9yIENsYXNzIDoKICAgIE1ldGhvZHM6CiAgICAgICAgdHMgPSBUYXJnZXRTZWxlY3Rvcihtb2RlLCByYW5nZSwgZGFtYWdlVHlwZSAob3B0KSwgdGFyZ2V0U2VsZWN0ZWQgKG9wdCksIGVuZW15VGVhbSAob3B0KSkKICAgIEdvYmxhbCBGdW5jdGlvbnMgOgogICAgICAgIFRTX1ByaW50KGVuZW15VGVhbSAob3B0KSkgICAgICAgICAgIC0+IHByaW50IFByaW9yaXR5IChnbG9iYWwpCiAgICAgICAgVFNfU2V0Rm9jdXMoKSAgICAgICAgICAgLT4gc2V0IHByaW9yaXR5IHRvIHRoZSBzZWxlY3RlZCBjaGFtcGlvbiAoeW91IG5lZWQgdG8gdXNlIFBSSU9SSVRZIG1vZGVzIHRvIHVzZSBpdCkgKGdsb2JhbCkKICAgICAgICBUU19TZXRGb2N1cyhpZCkgICAgICAgICAtPiBzZXQgcHJpb3JpdHkgdG8gdGhlIGNoYW1waW9uSUQgKHlvdSBuZWVkIHRvIHVzZSBQUklPUklUWSBtb2RlcyB0byB1c2UgaXQpIChnbG9iYWwpCiAgICAgICAgVFNfU2V0Rm9jdXMoY2hhck5hbWUsIGVuZW15VGVhbSAob3B0KSkgIC0+IHNldCBwcmlvcml0eSB0byB0aGUgY2hhbXBpb24gY2hhck5hbWUgKHlvdSBuZWVkIHRvIHVzZSBQUklPUklUWSBtb2RlcyB0byB1c2UgaXQpIChnbG9iYWwpCiAgICAgICAgVFNfU2V0Rm9jdXMoaGVybykgICAgICAgLT4gc2V0IHByaW9yaXR5IHRvIHRoZSBoZXJvIG9iamVjdCAoeW91IG5lZWQgdG8gdXNlIFBSSU9SSVRZIG1vZGVzIHRvIHVzZSBpdCkgKGdsb2JhbCkKICAgICAgICBUU19TZXRIZXJvUHJpb3JpdHkocHJpb3JpdHksIHRhcmdldCwgZW5lbXlUZWFtIChvcHQpKSAgICAgICAgICAgICAgICAgICAtPiBzZXQgdGhlIHByaW9yaXR5IHRvIHRhcmdldAogICAgICAgIFRTX1NldFByaW9yaXR5KHRhcmdldDEsIHRhcmdldDIsIHRhcmdldDMsIHRhcmdldDQsIHRhcmdldDUpICAgICAtPiBzZXQgcHJpb3JpdHkgaW4gb3JkZXIgdG8gZW5lbXkgdGFyZ2V0cwogICAgICAgIFRTX1NldFByaW9yaXR5QSh0YXJnZXQxLCB0YXJnZXQyLCB0YXJnZXQzLCB0YXJnZXQ0LCB0YXJnZXQ1KSAgICAtPiBzZXQgcHJpb3JpdHkgaW4gb3JkZXIgdG8gYWxseSB0YXJnZXRzCiAgICAgICAgVFNfR2V0UHJpb3JpdHkodGFyZ2V0LCBlbmVteVRlYW0pICAgICAgIC0+IHJldHVybiB0aGUgY3VycmVudCBwcmlvcml0eSwgYW5kIHRoZSBtYXggYWxsb3dlZAogICAgRnVuY3Rpb25zIDoKICAgICAgICB0czp1cGRhdGUoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHVwZGF0ZSB0aGUgaW5zdGFuY2UgdGFyZ2V0CiAgICAgICAgdHM6U2V0RGFtYWdlcyhtYWdpY0RtZ0Jhc2UsIHBoeXNpY2FsRG1nQmFzZSwgdHJ1ZURtZykKICAgICAgICB0czpTZXRQcmVkaWN0aW9uKCkgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIHByZWRpY3Rpb24gb2ZmCiAgICAgICAgdHM6U2V0UHJlZGljdGlvbihkZWxheSkgICAgICAgICAgICAgICAgICAgICAtLSBwcmVkaWN0IG1vdmVtZW50IGZvciBjaGFtcHMgKG5lZWQgUHJlZGljdGlvbl9fT25UaWNrKCkpCiAgICAgICAgdHM6U2V0TWluaW9uQ29sbGlzaW9uKCkgICAgICAgICAgICAgICAgICAgICAtLSBtaW5pb24gY29saXNzaW9uIG9mZgogICAgICAgIHRzOlNldE1pbmlvbkNvbGxpc2lvbihzcGVsbFdpZHRoKSAgICAgICAgICAgLS0gYXZvaWQgY2hhbXAgaWYgbWluaW9uIGJldHdlZW4gcGxheWVyCiAgICAgICAgdHM6U2V0Q29uZGl0aW9uYWwoKSAgICAgICAgICAgICAgICAgICAgICAgICAtLSBlcmFzZSBleHRlcm5hbCBmdW5jdGlvbiB1c2UKICAgICAgICB0czpTZXRDb25kaXRpb25hbChmdW5jKSAgICAgICAgICAgICAgICAgICAgIC0tIHNldCBleHRlcm5hbCBmdW5jdGlvbiB0aGF0IHJldHVybiB0cnVlL2ZhbHNlIHRvIGFsbG93IGZpbHRlciAtLSBmdW5jdGlvbihoZXJvLCBpbmRleCAob3B0KSkKICAgICAgICB0czpTZXRQcm9qZWN0aWxlU3BlZWQocFNwZWVkKSAgICAgICAgICAgICAgIC0tIHNldCBwcm9qZWN0aWxlIHNwZWVkIChuZWVkIFByZWRpY3Rpb25fX09uVGljaygpKQogICAgTWVtYmVyczoKICAgICAgICB0cy5tb2RlICAgICAgICAgICAgICAgICAgICAgLT4gVEFSR0VUX0xPV19IUCwgVEFSR0VUX01PU1RfQVAsIFRBUkdFVF9NT1NUX0FELCBUQVJHRVRfUFJJT1JJVFksIFRBUkdFVF9ORUFSX01PVVNFLCBUQVJHRVRfTE9XX0hQX1BSSU9SSVRZLCBUQVJHRVRfTEVTU19DQVNULCBUQVJHRVRfTEVTU19DQVNUX1BSSU9SSVRZCiAgICAgICAgdHMucmFuZ2UgICAgICAgICAgICAgICAgICAgIC0+IG51bWJlciA+IDAKICAgICAgICB0cy50YXJnZXRTZWxlY3RlZCAgICAgICAtPiB0cnVlL2ZhbHNlCiAgICAgICAgdHMudGFyZ2V0ICAgICAgICAgICAgICAgICAgIC0+IHJldHVybiB0aGUgdGFyZ2V0IChvYmplY3Qgb3IgbmlsKQogICAgICAgIHRzLmluZGV4ICAgICAgICAtPiBpbmRleCBvZiB0YXJnZXQgKGlmIGhlcm8pCiAgICAgICAgdHMubmV4dFBvc2l0aW9uIC0+IG5leHRQb3NpdGlvbiBwcmVkaWN0ZWQKICAgICAgICB0cy5uZXh0SGVhbHRoICAgICAgIC0+IG5leHRIZWFsdGggcHJlZGljdGVkCiAgICBVc2FnZSA6CiAgICAgICAgdmFyaWFibGUgPSBUYXJnZXRTZWxlY3Rvcihtb2RlLCByYW5nZSwgZGFtYWdlVHlwZSAob3B0KSwgdGFyZ2V0U2VsZWN0ZWQgKG9wdCksIGVuZW15VGVhbSAob3B0KSkKICAgICAgICB0YXJnZXRTZWxlY3RlZCBpcyBzZXQgdG8gdHJ1ZSBpZiBub3QgZmlsbGVkCiAgICAgICAgRGFtYWdlcyBhcmUgc2V0IGFzIGRlZmF1bHQgdG8gbWFnaWMgMTAwIGlmIG5vbmUgaXMgc2V0CiAgICAgICAgZW5lbXlUZWFtIGlzIGZhbHNlIGlmIGFsbHksIG5pbCBvciB0cnVlIGlmIGVuZW15CiAgICAgICAgd2hlbiB5b3Ugd2FudCB0byB1cGRhdGUsIGNhbGwgdmFyaWFibGU6dXBkYXRlKCkKICAgICAgICBWYWx1ZXMgeW91IGNhbiBjaGFuZ2Ugb24gaW5zdGFuY2UgOgogICAgICAgIHZhcmlhYmxlLm1vZGUgLT4gVEFSR0VUX0xPV19IUCwgVEFSR0VUX01PU1RfQVAsIFRBUkdFVF9QUklPUklUWSwgVEFSR0VUX05FQVJfTU9VU0UsIFRBUkdFVF9MT1dfSFBfUFJJT1JJVFksIFRBUkdFVF9MRVNTX0NBU1QsIFRBUkdFVF9MRVNTX0NBU1RfUFJJT1JJVFkKICAgICAgICB2YXJpYWJsZS5yYW5nZSAtPiBudW1iZXIgPiAwCiAgICAgICAgdmFyaWFibGUudGFyZ2V0U2VsZWN0ZWQgLT4gdHJ1ZS9mYWxzZSAoaWYgeW91IGNsaWNrZWQgb24gYSBjaGFtcCkKICAgIGV4IDoKICAgICAgICBmdW5jdGlvbiBPbkxvYWQoKQogICAgICAgICAgICB0cyA9IFRhcmdldFNlbGVjdG9yKFRBUkdFVF9MRVNTX0NBU1QsIDYwMCwgREFNQUdFX01BR0lDLCB0cnVlKQogICAgICAgIGVuZAogICAgICAgIGZ1bmN0aW9uIE9uVGljaygpCiAgICAgICAgICAgIGlmIHRzLnRhcmdldCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgUHJpbnRDaGF0KHRzLnRhcmdldC5jaGFyTmFtZSkKICAgICAgICAgICAgICAgIHRzOlNldERhbWFnZXMoKHBsYXllci5hcCAqIDEwKSwgMCwgMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCl1dCi0tIENsYXNzIHJlbGF0ZWQgY29uc3RhbnRzClRBUkdFVF9MT1dfSFAgPSAxClRBUkdFVF9NT1NUX0FQID0gMgpUQVJHRVRfTU9TVF9BRCA9IDMKVEFSR0VUX0xFU1NfQ0FTVCA9IDQKVEFSR0VUX05FQVJfTU9VU0UgPSA1ClRBUkdFVF9QUklPUklUWSA9IDYKVEFSR0VUX0xPV19IUF9QUklPUklUWSA9IDcKVEFSR0VUX0xFU1NfQ0FTVF9QUklPUklUWSA9IDgKVEFSR0VUX0RFQUQgPSA5ClRBUkdFVF9DTE9TRVNUID0gMTAKREFNQUdFX01BR0lDID0gMQpEQU1BR0VfUEhZU0lDQUwgPSAyCi0tIENsYXNzIHJlbGF0ZWQgZ2xvYmFsCmxvY2FsIF9UU19EcmF3CmxvY2FsIF9UYXJnZXRTZWxlY3Rvcl9fdGV4dGVkID0geyAiTG93SFAiLCAiTW9zdEFQIiwgIk1vc3RBRCIsICJMZXNzQ2FzdCIsICJOZWFyTW91c2UiLCAiUHJpb3JpdHkiLCAiTG93SFBQcmlvcml0eSIsICJMZXNzQ2FzdFByaW9yaXR5IiwgIkRlYWQiLCAiQ2xvc2VzdCIgfQpmdW5jdGlvbiBUU19QcmludChlbmVteVRlYW0pCiAgICBsb2NhbCBlbmVteVRlYW0gPSAoZW5lbXlUZWFtIH49IGZhbHNlKQogICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoX2dhbWVIZXJvZXMpIGRvCiAgICAgICAgaWYgdGFyZ2V0Lmhlcm8gfj0gbmlsIGFuZCB0YXJnZXQuaGVyby52YWxpZCBhbmQgdGFyZ2V0LmVuZW15ID09IGVuZW15VGVhbSB0aGVuCiAgICAgICAgICAgIFByaW50Q2hhdCgiW1RTXSAiIC4uIChlbmVteVRlYW0gYW5kICJFbmVteSAiIG9yICJBbGx5ICIpIC4uIHRhcmdldC50SW5kZXggLi4gIiAoIiAuLiB0YXJnZXQuaW5kZXggLi4gIikgOiAiIC4uIHRhcmdldC5oZXJvLmNoYXJOYW1lIC4uICIgTW9kZT0iIC4uICh0YXJnZXQuaWdub3JlIGFuZCAiaWdub3JlIiBvciAidGFyZ2V0IikgLi4gIiBQcmlvcml0eT0iIC4uIHRhcmdldC5wcmlvcml0eSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFRTX1NldEZvY3VzKHRhcmdldCwgZW5lbXlUZWFtKQogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGxvY2FsIHNlbGVjdGVkID0gX2dhbWVIZXJvZXNfX2hlcm8odGFyZ2V0LCAiVFNfU2V0Rm9jdXMiKQogICAgaWYgc2VsZWN0ZWQgfj0gbmlsIGFuZCBzZWxlY3RlZC52YWxpZCBhbmQgc2VsZWN0ZWQudHlwZSA9PSAib2JqX0FJX0hlcm8iIGFuZCAoc2VsZWN0ZWQudGVhbSB+PSBwbGF5ZXIudGVhbSkgPT0gZW5lbXlUZWFtIHRoZW4KICAgICAgICBmb3IgXywgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICAgICAgaWYgX2dhbWVIZXJvLmVuZW15ID09IGVuZW15VGVhbSB0aGVuCiAgICAgICAgICAgICAgICBpZiBfZ2FtZUhlcm8uaGVyby5uZXR3b3JrSUQgPT0gc2VsZWN0ZWQubmV0d29ya0lEIHRoZW4KICAgICAgICAgICAgICAgICAgICBfZ2FtZUhlcm8ucHJpb3JpdHkgPSAxCiAgICAgICAgICAgICAgICAgICAgUHJpbnRDaGF0KCJbVFNdIEZvY3VzaW5nICIgLi4gX2dhbWVIZXJvLmhlcm8uY2hhck5hbWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgX2dhbWVIZXJvLnByaW9yaXR5ID0gKGVuZW15VGVhbSBhbmQgX2dhbWVFbmVteUNvdW50IG9yIF9nYW1lQWxseUNvdW50KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gVFNfU2V0SGVyb1ByaW9yaXR5KHByaW9yaXR5LCB0YXJnZXQsIGVuZW15VGVhbSkKICAgIGxvY2FsIGVuZW15VGVhbSA9IChlbmVteVRlYW0gfj0gZmFsc2UpCiAgICBsb2NhbCBoZXJvQ291bnQgPSAoZW5lbXlUZWFtIGFuZCBfZ2FtZUVuZW15Q291bnQgb3IgX2dhbWVBbGx5Q291bnQpCiAgICBhc3NlcnQodHlwZShwcmlvcml0eSkgPT0gIm51bWJlciIgYW5kIHByaW9yaXR5ID49IDAgYW5kIHByaW9yaXR5IDw9IGhlcm9Db3VudCwgIlRTX1NldEhlcm9Qcmlvcml0eTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxudW1iZXI+IDEgdG8gIiAuLiBoZXJvQ291bnQgLi4gIiBleHBlY3RlZCkiKQogICAgbG9jYWwgc2VsZWN0ZWQgPSBfZ2FtZUhlcm9lc19faW5kZXgodGFyZ2V0LCAiVFNfU2V0SGVyb1ByaW9yaXR5OiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPGNoYXJOYW1lPiBvciA8aGVyb0luZGV4PiBvciA8aGVybz4gb3IgbmlsIGV4cGVjdGVkKSIsIGVuZW15VGVhbSkKICAgIGlmIHNlbGVjdGVkIH49IG5pbCB0aGVuCiAgICAgICAgbG9jYWwgb2xkUHJpb3JpdHkgPSBfZ2FtZUhlcm9lc1tzZWxlY3RlZF0ucHJpb3JpdHkKICAgICAgICBpZiBvbGRQcmlvcml0eSA9PSBuaWwgb3Igb2xkUHJpb3JpdHkgPT0gcHJpb3JpdHkgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgZm9yIGluZGV4LCBfZ2FtZUhlcm8gaW4gaXBhaXJzKF9nYW1lSGVyb2VzKSBkbwogICAgICAgICAgICBpZiBfZ2FtZUhlcm8uZW5lbXkgPT0gZW5lbXlUZWFtIHRoZW4KICAgICAgICAgICAgICAgIGlmIGluZGV4ID09IHNlbGVjdGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBfZ2FtZUhlcm8ucHJpb3JpdHkgPSBwcmlvcml0eQogICAgICAgICAgICAgICAgICAgIC0tUHJpbnRDaGF0KCJbVFNdICIuLihlbmVteVRlYW0gYW5kICJFbmVteSAiIG9yICJBbGx5ICIpLi5fZ2FtZUhlcm8udEluZGV4Li4iICgiLi5fZ2FtZUhlcm8uaW5kZXguLiIpIDogIiAuLiBfZ2FtZUhlcm8uaGVyby5jaGFyTmFtZSAuLiAiIE1vZGU9IiAuLiAoX2dhbWVIZXJvLmlnbm9yZSBhbmQgImlnbm9yZSIgb3IgInRhcmdldCIpIC4uIiBQcmlvcml0eT0iIC4uIF9nYW1lSGVyby5wcmlvcml0eSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFRTX1NldFByaW9yaXR5KHRhcmdldDEsIHRhcmdldDIsIHRhcmdldDMsIHRhcmdldDQsIHRhcmdldDUpCiAgICBhc3NlcnQoKHRhcmdldDUgfj0gbmlsIGFuZCBfZ2FtZUVuZW15Q291bnQgPT0gNSkgb3IgKHRhcmdldDQgfj0gbmlsIGFuZCBfZ2FtZUVuZW15Q291bnQgPCA1KSBvciAodGFyZ2V0MyB+PSBuaWwgYW5kIF9nYW1lRW5lbXlDb3VudCA9PSAzKSBvciAodGFyZ2V0MiB+PSBuaWwgYW5kIF9nYW1lRW5lbXlDb3VudCA9PSAyKSBvciAodGFyZ2V0MSB+PSBuaWwgYW5kIF9nYW1lRW5lbXlDb3VudCA9PSAxKSwgIlRTX1NldFByaW9yaXR5OiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoIiAuLiBfZ2FtZUVuZW15Q291bnQgLi4gIiA8dGFyZ2V0PiBleHBlY3RlZCkiKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDEsIHRhcmdldDEpCiAgICBUU19TZXRIZXJvUHJpb3JpdHkoMiwgdGFyZ2V0MikKICAgIFRTX1NldEhlcm9Qcmlvcml0eSgzLCB0YXJnZXQzKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDQsIHRhcmdldDQpCiAgICBUU19TZXRIZXJvUHJpb3JpdHkoNSwgdGFyZ2V0NSkKZW5kCgpmdW5jdGlvbiBUU19TZXRQcmlvcml0eUEodGFyZ2V0MSwgdGFyZ2V0MiwgdGFyZ2V0MywgdGFyZ2V0NCwgdGFyZ2V0NSkKICAgIGFzc2VydCgodGFyZ2V0NSB+PSBuaWwgYW5kIF9nYW1lQWxseUNvdW50ID09IDUpIG9yICh0YXJnZXQ0IH49IG5pbCBhbmQgX2dhbWVBbGx5Q291bnQgPCA1KSBvciAodGFyZ2V0MyB+PSBuaWwgYW5kIF9nYW1lQWxseUNvdW50ID09IDMpIG9yICh0YXJnZXQyIH49IG5pbCBhbmQgX2dhbWVBbGx5Q291bnQgPT0gMikgb3IgKHRhcmdldDEgfj0gbmlsIGFuZCBfZ2FtZUFsbHlDb3VudCA9PSAxKSwgIlRTX1NldFByaW9yaXR5QTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKCIgLi4gX2dhbWVBbGx5Q291bnQgLi4gIiA8dGFyZ2V0PiBleHBlY3RlZCkiKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDEsIHRhcmdldDEsIGZhbHNlKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDIsIHRhcmdldDIsIGZhbHNlKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDMsIHRhcmdldDMsIGZhbHNlKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDQsIHRhcmdldDQsIGZhbHNlKQogICAgVFNfU2V0SGVyb1ByaW9yaXR5KDUsIHRhcmdldDUsIGZhbHNlKQplbmQKCmZ1bmN0aW9uIFRTX0dldFByaW9yaXR5KHRhcmdldCwgZW5lbXlUZWFtKQogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGxvY2FsIGluZGV4ID0gX2dhbWVIZXJvZXNfX2luZGV4KHRhcmdldCwgIlRTX0dldFByaW9yaXR5IiwgZW5lbXlUZWFtKQogICAgcmV0dXJuIChpbmRleCBhbmQgX2dhbWVIZXJvZXNbaW5kZXhdLnByaW9yaXR5IG9yIG5pbCksIChlbmVteVRlYW0gYW5kIF9nYW1lRW5lbXlDb3VudCBvciBfZ2FtZUFsbHlDb3VudCkKZW5kCgpmdW5jdGlvbiBUU19JZ25vcmUodGFyZ2V0LCBlbmVteVRlYW0pCiAgICBsb2NhbCBlbmVteVRlYW0gPSAoZW5lbXlUZWFtIH49IGZhbHNlKQogICAgbG9jYWwgc2VsZWN0ZWQgPSBfZ2FtZUhlcm9lc19faGVybyh0YXJnZXQsICJUU19JZ25vcmUiKQogICAgaWYgc2VsZWN0ZWQgfj0gbmlsIGFuZCBzZWxlY3RlZC52YWxpZCBhbmQgc2VsZWN0ZWQudHlwZSA9PSAib2JqX0FJX0hlcm8iIGFuZCAoc2VsZWN0ZWQudGVhbSB+PSBwbGF5ZXIudGVhbSkgPT0gZW5lbXlUZWFtIHRoZW4KICAgICAgICBmb3IgXywgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICAgICAgaWYgX2dhbWVIZXJvLmhlcm8ubmV0d29ya0lEID09IHNlbGVjdGVkLm5ldHdvcmtJRCBhbmQgX2dhbWVIZXJvLmVuZW15ID09IGVuZW15VGVhbSB0aGVuCiAgICAgICAgICAgICAgICBfZ2FtZUhlcm8uaWdub3JlID0gbm90IF9nYW1lSGVyby5pZ25vcmUKICAgICAgICAgICAgICAgIC0tUHJpbnRDaGF0KCJbVFNdICIuLihfZ2FtZUhlcm8uaWdub3JlIGFuZCAiSWdub3JpbmcgIiBvciAiUmUtdGFyZ2V0dGluZyAiKS4uX2dhbWVIZXJvLmhlcm8uY2hhck5hbWUpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIF9UU19EcmF3X0luaXQoKQogICAgaWYgbm90IF9UU19EcmF3IHRoZW4KICAgICAgICBVcGRhdGVXaW5kb3coKQogICAgICAgIF9UU19EcmF3ID0geyB5MSA9IDAsIGhlaWdodCA9IDAsIGZvbnRTaXplID0gV0lORE9XX0ggYW5kIG1hdGgucm91bmQoV0lORE9XX0ggLyA1NCkgb3IgMTQsIHdpZHRoID0gV0lORE9XX1cgYW5kIG1hdGgucm91bmQoV0lORE9XX1cgLyA0LjgpIG9yIDIxMywgYm9yZGVyID0gMiwgYmFja2dyb3VuZCA9IDE0MTMxNjc5MzEsIHRleHRDb2xvciA9IDQyOTA0Mjc1NzgsIHJlZENvbG9yID0gMTQyMjcyMTAyNCwgZ3JlZW5Db2xvciA9IDE0MDkzMjE3MjgsIGJsdWVDb2xvciA9IDI2ODQzNTQ3MTYgfQogICAgICAgIF9UU19EcmF3LmNlbGxTaXplLCBfVFNfRHJhdy5taWRTaXplLCBfVFNfRHJhdy5yb3cxLCBfVFNfRHJhdy5yb3cyLCBfVFNfRHJhdy5yb3czLCBfVFNfRHJhdy5yb3c0ID0gX1RTX0RyYXcuZm9udFNpemUgKyBfVFNfRHJhdy5ib3JkZXIsIF9UU19EcmF3LmZvbnRTaXplIC8gMiwgX1RTX0RyYXcud2lkdGggKiAwLjYsIF9UU19EcmF3LndpZHRoICogMC43LCBfVFNfRHJhdy53aWR0aCAqIDAuOCwgX1RTX0RyYXcud2lkdGggKiAwLjkKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIFRTX19EcmF3TWVudSh4LCB5LCBlbmVteVRlYW0pCiAgICBhc3NlcnQodHlwZSh4KSA9PSAibnVtYmVyIiBhbmQgdHlwZSh5KSA9PSAibnVtYmVyIiwgIlRTX19EcmF3TWVudTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxudW1iZXI+LCA8bnVtYmVyPiBleHBlY3RlZCkiKQogICAgX1RTX0RyYXdfSW5pdCgpCiAgICBsb2NhbCBlbmVteVRlYW0gPSAoZW5lbXlUZWFtIH49IGZhbHNlKQogICAgbG9jYWwgeTEgPSB5CiAgICBmb3IgXywgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICBpZiBfZ2FtZUhlcm8uZW5lbXkgPT0gZW5lbXlUZWFtIHRoZW4KICAgICAgICAgICAgRHJhd0xpbmUoeCAtIF9UU19EcmF3LmJvcmRlciwgeTEgKyBfVFNfRHJhdy5taWRTaXplLCB4ICsgX1RTX0RyYXcucm93MSAtIF9UU19EcmF3LmJvcmRlciwgeTEgKyBfVFNfRHJhdy5taWRTaXplLCBfVFNfRHJhdy5jZWxsU2l6ZSwgKF9nYW1lSGVyby5pZ25vcmUgYW5kIF9UU19EcmF3LnJlZENvbG9yIG9yIF9UU19EcmF3LmJhY2tncm91bmQpKQogICAgICAgICAgICBEcmF3VGV4dChfZ2FtZUhlcm8uaGVyby5jaGFyTmFtZSwgX1RTX0RyYXcuZm9udFNpemUsIHgsIHkxLCBfVFNfRHJhdy50ZXh0Q29sb3IpCiAgICAgICAgICAgIERyYXdMaW5lKHggKyBfVFNfRHJhdy5yb3cxLCB5MSArIF9UU19EcmF3Lm1pZFNpemUsIHggKyBfVFNfRHJhdy5yb3cyIC0gX1RTX0RyYXcuYm9yZGVyLCB5MSArIF9UU19EcmF3Lm1pZFNpemUsIF9UU19EcmF3LmNlbGxTaXplLCBfVFNfRHJhdy5iYWNrZ3JvdW5kKQogICAgICAgICAgICBEcmF3VGV4dCgiICAgIiAuLiAoX2dhbWVIZXJvLmlnbm9yZSBhbmQgIi0iIG9yIHRvc3RyaW5nKF9nYW1lSGVyby5wcmlvcml0eSkpLCBfVFNfRHJhdy5mb250U2l6ZSwgeCArIF9UU19EcmF3LnJvdzEsIHkxLCBfVFNfRHJhdy50ZXh0Q29sb3IpCiAgICAgICAgICAgIERyYXdMaW5lKHggKyBfVFNfRHJhdy5yb3cyLCB5MSArIF9UU19EcmF3Lm1pZFNpemUsIHggKyBfVFNfRHJhdy5yb3czIC0gX1RTX0RyYXcuYm9yZGVyLCB5MSArIF9UU19EcmF3Lm1pZFNpemUsIF9UU19EcmF3LmNlbGxTaXplLCBfVFNfRHJhdy5ibHVlQ29sb3IpCiAgICAgICAgICAgIERyYXdUZXh0KCIgICAtIiwgX1RTX0RyYXcuZm9udFNpemUsIHggKyBfVFNfRHJhdy5yb3cyLCB5MSwgX1RTX0RyYXcudGV4dENvbG9yKQogICAgICAgICAgICBEcmF3TGluZSh4ICsgX1RTX0RyYXcucm93MywgeTEgKyBfVFNfRHJhdy5taWRTaXplLCB4ICsgX1RTX0RyYXcucm93NCAtIF9UU19EcmF3LmJvcmRlciwgeTEgKyBfVFNfRHJhdy5taWRTaXplLCBfVFNfRHJhdy5jZWxsU2l6ZSwgX1RTX0RyYXcuYmx1ZUNvbG9yKQogICAgICAgICAgICBEcmF3VGV4dCgiICAgKyIsIF9UU19EcmF3LmZvbnRTaXplLCB4ICsgX1RTX0RyYXcucm93MywgeTEsIF9UU19EcmF3LnRleHRDb2xvcikKICAgICAgICAgICAgRHJhd0xpbmUoeCArIF9UU19EcmF3LnJvdzQsIHkxICsgX1RTX0RyYXcubWlkU2l6ZSwgeCArIF9UU19EcmF3LndpZHRoLCB5MSArIF9UU19EcmF3Lm1pZFNpemUsIF9UU19EcmF3LmNlbGxTaXplLCBfVFNfRHJhdy5yZWRDb2xvcikKICAgICAgICAgICAgRHJhd1RleHQoIiAgIFgiLCBfVFNfRHJhdy5mb250U2l6ZSwgeCArIF9UU19EcmF3LnJvdzQsIHkxLCBfVFNfRHJhdy50ZXh0Q29sb3IpCiAgICAgICAgICAgIHkxID0geTEgKyBfVFNfRHJhdy5jZWxsU2l6ZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4geTEKZW5kCgpsb2NhbCBmdW5jdGlvbiBUU19DbGlja01lbnUoeCwgeSwgZW5lbXlUZWFtKQogICAgYXNzZXJ0KHR5cGUoeCkgPT0gIm51bWJlciIgYW5kIHR5cGUoeSkgPT0gIm51bWJlciIsICJUU19fRHJhd01lbnU6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8bnVtYmVyPiwgPG51bWJlcj4gZXhwZWN0ZWQpIikKICAgIF9UU19EcmF3X0luaXQoKQogICAgbG9jYWwgZW5lbXlUZWFtID0gKGVuZW15VGVhbSB+PSBmYWxzZSkKICAgIGxvY2FsIHkxID0geQogICAgZm9yIGluZGV4LCBfZ2FtZUhlcm8gaW4gaXBhaXJzKF9nYW1lSGVyb2VzKSBkbwogICAgICAgIGlmIF9nYW1lSGVyby5lbmVteSA9PSBlbmVteVRlYW0gdGhlbgogICAgICAgICAgICBpZiBDdXJzb3JJc1VuZGVyKHggKyBfVFNfRHJhdy5yb3cyLCB5MSwgX1RTX0RyYXcuZm9udFNpemUsIF9UU19EcmF3LmZvbnRTaXplKSB0aGVuCiAgICAgICAgICAgICAgICBUU19TZXRIZXJvUHJpb3JpdHkobWF0aC5tYXgoMSwgX2dhbWVIZXJvLnByaW9yaXR5IC0gMSksIGluZGV4KQogICAgICAgICAgICBlbHNlaWYgQ3Vyc29ySXNVbmRlcih4ICsgX1RTX0RyYXcucm93MywgeTEsIF9UU19EcmF3LmZvbnRTaXplLCBfVFNfRHJhdy5mb250U2l6ZSkgdGhlbgogICAgICAgICAgICAgICAgVFNfU2V0SGVyb1ByaW9yaXR5KG1hdGgubWluKChlbmVteVRlYW0gYW5kIF9nYW1lRW5lbXlDb3VudCBvciBfZ2FtZUFsbHlDb3VudCksIF9nYW1lSGVyby5wcmlvcml0eSArIDEpLCBpbmRleCkKICAgICAgICAgICAgZWxzZWlmIEN1cnNvcklzVW5kZXIoeCArIF9UU19EcmF3LnJvdzQsIHkxLCBfVFNfRHJhdy5mb250U2l6ZSwgX1RTX0RyYXcuZm9udFNpemUpIHRoZW4gVFNfSWdub3JlKGluZGV4KQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgeTEgPSB5MSArIF9UU19EcmF3LmNlbGxTaXplCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiB5MQplbmQKCmxvY2FsIF9fVGFyZ2V0U2VsZWN0b3JfX09uU2VuZENoYXQKbG9jYWwgZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3JfX09uTG9hZCgpCiAgICBpZiBub3QgX19UYXJnZXRTZWxlY3Rvcl9fT25TZW5kQ2hhdCB0aGVuCiAgICAgICAgZnVuY3Rpb24gX19UYXJnZXRTZWxlY3Rvcl9fT25TZW5kQ2hhdChtc2cpCiAgICAgICAgICAgIGlmIG5vdCBtc2cgb3IgbXNnOnN1YigxLCAzKSB+PSAiLnRzIiB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgQmxvY2tDaGF0KCkKICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt9CiAgICAgICAgICAgIHdoaWxlIHN0cmluZy5maW5kKG1zZywgIiAiKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgaW5kZXggPSBzdHJpbmcuZmluZChtc2csICIgIikKICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChhcmdzLCBtc2c6c3ViKDEsIGluZGV4IC0gMSkpCiAgICAgICAgICAgICAgICBtc2cgPSBzdHJpbmcuc3ViKG1zZywgaW5kZXggKyAxKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGFyZ3MsIG1zZykKICAgICAgICAgICAgbG9jYWwgY21kID0gYXJnc1sxXTpsb3dlcigpCiAgICAgICAgICAgIGlmIGNtZCA9PSAiLnRzcHJpbnQiIHRoZW4KICAgICAgICAgICAgICAgIFRTX1ByaW50KCkKICAgICAgICAgICAgZWxzZWlmIGNtZCA9PSAiLnRzcHJpbnRhIiB0aGVuCiAgICAgICAgICAgICAgICBUU19QcmludChmYWxzZSkKICAgICAgICAgICAgZWxzZWlmIGNtZCA9PSAiLnRzZm9jdXMiIHRoZW4KICAgICAgICAgICAgICAgIFByaW50Q2hhdChjbWQgLi4gIiAtICIgLi4gYXJnc1syXSkKICAgICAgICAgICAgICAgIFRTX1NldEZvY3VzKGFyZ3NbMl0pCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c2ZvY3VzYSIgdGhlbgogICAgICAgICAgICAgICAgVFNfU2V0Rm9jdXMoYXJnc1syXSwgZmFsc2UpCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c3ByaW9yaXR5aGVybyIgdGhlbgogICAgICAgICAgICAgICAgVFNfU2V0SGVyb1ByaW9yaXR5KGFyZ3NbMl0sIGFyZ3NbM10pCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c3ByaW9yaXR5aGVyb2EiIHRoZW4KICAgICAgICAgICAgICAgIFRTX1NldEhlcm9Qcmlvcml0eShhcmdzWzJdLCBhcmdzWzNdLCBmYWxzZSkKICAgICAgICAgICAgZWxzZWlmIGNtZCA9PSAiLnRzcHJpb3JpdHkiIHRoZW4KICAgICAgICAgICAgICAgIFRTX1NldFByaW9yaXR5KGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0sIGFyZ3NbNl0pCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c3ByaW9yaXR5YSIgdGhlbgogICAgICAgICAgICAgICAgVFNfU2V0UHJpb3JpdHlBKGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0sIGFyZ3NbNl0pCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c2lnbm9yZSIgdGhlbgogICAgICAgICAgICAgICAgVFNfSWdub3JlKGFyZ3NbMl0pCiAgICAgICAgICAgIGVsc2VpZiBjbWQgPT0gIi50c2lnbm9yZWEiIHRoZW4KICAgICAgICAgICAgICAgIFRTX0lnbm9yZShhcmdzWzJdLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIEFkZENoYXRDYWxsYmFjayhfX1RhcmdldFNlbGVjdG9yX19PblNlbmRDaGF0KQogICAgZW5kCmVuZAoKY2xhc3MnVGFyZ2V0U2VsZWN0b3InCmZ1bmN0aW9uIFRhcmdldFNlbGVjdG9yOl9faW5pdChtb2RlLCByYW5nZSwgZGFtYWdlVHlwZSwgdGFyZ2V0U2VsZWN0ZWQsIGVuZW15VGVhbSkKICAgIC0tIEluaXQgR2xvYmFsCiAgICBhc3NlcnQodHlwZShtb2RlKSA9PSAibnVtYmVyIiBhbmQgdHlwZShyYW5nZSkgPT0gIm51bWJlciIsICJUYXJnZXRTZWxlY3Rvcjogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxtb2RlPiwgPG51bWJlcj4gZXhwZWN0ZWQpIikKICAgIF9nYW1lSGVyb2VzX19pbml0KCkKICAgIFRhcmdldFNlbGVjdG9yX19PbkxvYWQoKQogICAgc2VsZi5tb2RlID0gbW9kZQogICAgc2VsZi5yYW5nZSA9IHJhbmdlCiAgICBzZWxmLl9tRG1nQmFzZSwgc2VsZi5fcERtZ0Jhc2UsIHNlbGYuX3REbWcgPSAwLCAwLCAwCiAgICBzZWxmLl9kbWdUeXBlID0gZGFtYWdlVHlwZSBvciBEQU1BR0VfTUFHSUMKICAgIGlmIHNlbGYuX2RtZ1R5cGUgPT0gREFNQUdFX01BR0lDIHRoZW4gc2VsZi5fbURtZ0Jhc2UgPSAxMDAgZWxzZSBzZWxmLl9wRG1nQmFzZSA9IHBsYXllci50b3RhbERhbWFnZSBlbmQKICAgIHNlbGYudGFyZ2V0U2VsZWN0ZWQgPSAodGFyZ2V0U2VsZWN0ZWQgfj0gZmFsc2UpCiAgICBzZWxmLmVuZW15VGVhbSA9IChlbmVteVRlYW0gfj0gZmFsc2UpCiAgICBzZWxmLnRhcmdldCA9IG5pbAogICAgc2VsZi5fY29uZGl0aW9uYWwgPSBuaWwKICAgIHNlbGYuX2Nhc3RXaWR0aCA9IG5pbAogICAgc2VsZi5fcERlbGF5ID0gbmlsCiAgICBzZWxmLl9CQm94TW9kZSA9IGZhbHNlCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6cHJpbnRNb2RlKCkKICAgIFByaW50Q2hhdCgiW1RTXSBUYXJnZXQgbW9kZTogIiAuLiBfVGFyZ2V0U2VsZWN0b3JfX3RleHRlZFtzZWxmLm1vZGVdKQplbmQKCmZ1bmN0aW9uIFRhcmdldFNlbGVjdG9yOlNldERhbWFnZXMobWFnaWNEbWdCYXNlLCBwaHlzaWNhbERtZ0Jhc2UsIHRydWVEbWcpCiAgICBhc3NlcnQobWFnaWNEbWdCYXNlID09IG5pbCBvciB0eXBlKG1hZ2ljRG1nQmFzZSkgPT0gIm51bWJlciIsICJTZXREYW1hZ2VzOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPG51bWJlcj4gb3IgbmlsIGV4cGVjdGVkKSBmb3IgbWFnaWNEbWdCYXNlIikKICAgIGFzc2VydChwaHlzaWNhbERtZ0Jhc2UgPT0gbmlsIG9yIHR5cGUocGh5c2ljYWxEbWdCYXNlKSA9PSAibnVtYmVyIiwgIlNldERhbWFnZXM6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8bnVtYmVyPiBvciBuaWwgZXhwZWN0ZWQpIGZvciBwaHlzaWNhbERtZ0Jhc2UiKQogICAgYXNzZXJ0KHRydWVEbWcgPT0gbmlsIG9yIHR5cGUodHJ1ZURtZykgPT0gIm51bWJlciIsICJTZXREYW1hZ2VzOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPG51bWJlcj4gb3IgbmlsIGV4cGVjdGVkKSBmb3IgdHJ1ZURtZyIpCiAgICBzZWxmLl9kbWdUeXBlID0gMAogICAgc2VsZi5fbURtZ0Jhc2UgPSBtYWdpY0RtZ0Jhc2Ugb3IgMAogICAgc2VsZi5fcERtZ0Jhc2UgPSBwaHlzaWNhbERtZ0Jhc2Ugb3IgMAogICAgc2VsZi5fdERtZyA9IHRydWVEbWcgb3IgMAplbmQKCmZ1bmN0aW9uIFRhcmdldFNlbGVjdG9yOlNldE1pbmlvbkNvbGxpc2lvbihjYXN0V2lkdGgsIG1pbmlvblR5cGUpCiAgICBhc3NlcnQoY2FzdFdpZHRoID09IG5pbCBvciB0eXBlKGNhc3RXaWR0aCkgPT0gIm51bWJlciIsICJTZXRNaW5pb25Db2xsaXNpb246IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8bnVtYmVyPiBvciBuaWwgZXhwZWN0ZWQpIikKICAgIHNlbGYuX2Nhc3RXaWR0aCA9IChjYXN0V2lkdGggYW5kIGNhc3RXaWR0aCA+IDApIGFuZCBjYXN0V2lkdGgKICAgIGlmIHNlbGYuX2Nhc3RXaWR0aCB0aGVuCiAgICAgICAgbG9jYWwgbWluaW9uVHlwZSA9IG1pbmlvblR5cGUgb3IgTUlOSU9OX0VORU1ZCiAgICAgICAgc2VsZi5fbWluaW9uVGFibGUgPSBtaW5pb25NYW5hZ2VyKG1pbmlvblR5cGUsIHNlbGYucmFuZ2UgKyAzMDApCiAgICBlbHNlCiAgICAgICAgc2VsZi5fbWluaW9uVGFibGUgPSBuaWwKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFRhcmdldFNlbGVjdG9yOlNldFByZWRpY3Rpb24oZGVsYXkpCiAgICBhc3NlcnQoZGVsYXkgPT0gbmlsIG9yIHR5cGUoZGVsYXkpID09ICJudW1iZXIiLCAiU2V0UHJlZGljdGlvbjogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxudW1iZXI+IG9yIG5pbCBleHBlY3RlZCkiKQogICAgX1ByZWRpY3Rpb25fX09uTG9hZCgpCiAgICBzZWxmLl9wRGVsYXkgPSAoKGRlbGF5IH49IG5pbCBhbmQgZGVsYXkgPiAwKSBhbmQgZGVsYXkgb3IgbmlsKQplbmQKCmZ1bmN0aW9uIFRhcmdldFNlbGVjdG9yOlNldFByb2plY3RpbGVTcGVlZChwU3BlZWQpCiAgICBhc3NlcnQoZGVsYXkgPT0gbmlsIG9yIHR5cGUoZGVsYXkpID09ICJudW1iZXIiLCAiU2V0UHJvamVjdGlsZVNwZWVkOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPG51bWJlcj4gb3IgbmlsIGV4cGVjdGVkKSIpCiAgICBfUHJlZGljdGlvbl9fT25Mb2FkKCkKICAgIHNlbGYuX3BTcGVlZCA9ICgocFNwZWVkIH49IG5pbCBhbmQgcFNwZWVkID4gMCkgYW5kIHBTcGVlZCBvciBuaWwpCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6U2V0Q29uZGl0aW9uYWwoZnVuYykKICAgIGFzc2VydChmdW5jID09IG5pbCBvciB0eXBlKGZ1bmMpID09ICJmdW5jdGlvbiIsICJTZXRDb25kaXRpb25hbCA6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8ZnVuY3Rpb24+IG9yIG5pbCBleHBlY3RlZCkiKQogICAgc2VsZi5fY29uZGl0aW9uYWwgPSBmdW5jCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6U2V0QkJveE1vZGUoYmJNb2RlKQogICAgYXNzZXJ0KHR5cGUoYmJNb2RlKSA9PSAiYm9vbGVhbiIsICJTZXRCQm94TW9kZSA6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8Ym9vbGVhbj4gZXhwZWN0ZWQpIikKICAgIHNlbGYuX0JCb3hNb2RlID0gYmJNb2RlCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6X3RhcmdldFNlbGVjdGVkQnlQbGF5ZXIoKQogICAgaWYgc2VsZi50YXJnZXRTZWxlY3RlZCB0aGVuCiAgICAgICAgbG9jYWwgY3VycmVudFRhcmdldCA9IEdldFRhcmdldCgpCiAgICAgICAgbG9jYWwgdmFsaWRUYXJnZXQgPSBmYWxzZQogICAgICAgIGlmIHNlbGYuX0JCb3hNb2RlIHRoZW4KICAgICAgICAgICAgdmFsaWRUYXJnZXQgPSBWYWxpZEJCb3hUYXJnZXQoY3VycmVudFRhcmdldCwgc2VsZi5yYW5nZSwgc2VsZi5lbmVteVRlYW0pCiAgICAgICAgZWxzZQogICAgICAgICAgICB2YWxpZFRhcmdldCA9IFZhbGlkVGFyZ2V0KGN1cnJlbnRUYXJnZXQsIHNlbGYucmFuZ2UsIHNlbGYuZW5lbXlUZWFtKQogICAgICAgIGVuZAogICAgICAgIGlmIHZhbGlkVGFyZ2V0IGFuZCAoY3VycmVudFRhcmdldC50eXBlID09ICJvYmpfQUlfSGVybyIgb3IgY3VycmVudFRhcmdldC50eXBlID09ICJvYmpfQUlfTWluaW9uIikgYW5kIChzZWxmLl9jb25kaXRpb25hbCA9PSBuaWwgb3Igc2VsZi5fY29uZGl0aW9uYWwoY3VycmVudFRhcmdldCkpIHRoZW4KICAgICAgICAgICAgaWYgc2VsZi50YXJnZXQgPT0gbmlsIG9yIG5vdCBzZWxmLnRhcmdldC52YWxpZCBvciBzZWxmLnRhcmdldC5uZXR3b3JrSUQgfj0gY3VycmVudFRhcmdldC5uZXR3b3JrSUQgdGhlbgogICAgICAgICAgICAgICAgc2VsZi50YXJnZXQgPSBjdXJyZW50VGFyZ2V0CiAgICAgICAgICAgICAgICBzZWxmLmluZGV4ID0gX2dhbWVIZXJvZXNfX2luZGV4KGN1cnJlbnRUYXJnZXQsICJfdGFyZ2V0U2VsZWN0ZWRCeVBsYXllciIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBkZWxheSA9IDAKICAgICAgICAgICAgaWYgc2VsZi5fcERlbGF5IH49IG5pbCBhbmQgc2VsZi5fcERlbGF5ID4gMCB0aGVuCiAgICAgICAgICAgICAgICBkZWxheSA9IGRlbGF5ICsgc2VsZi5fcERlbGF5CiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLl9wU3BlZWQgfj0gbmlsIGFuZCBzZWxmLl9wU3BlZWQgPiAwIHRoZW4KICAgICAgICAgICAgICAgIGRlbGF5ID0gZGVsYXkgKyAoR2V0RGlzdGFuY2UoY3VycmVudFRhcmdldCkgLyBzZWxmLl9wU3BlZWQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLmluZGV4IGFuZCBkZWxheSA+IDAgdGhlbgogICAgICAgICAgICAgICAgc2VsZi5uZXh0UG9zaXRpb24gPSBfUHJlZGljdGlvblBvc2l0aW9uKHNlbGYuaW5kZXgsIGRlbGF5KQogICAgICAgICAgICAgICAgc2VsZi5uZXh0SGVhbHRoID0gX1ByZWRpY3Rpb25IZWFsdGgoc2VsZi5pbmRleCwgZGVsYXkpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNlbGYubmV4dFBvc2l0aW9uID0gVmVjdG9yKGN1cnJlbnRUYXJnZXQpCiAgICAgICAgICAgICAgICBzZWxmLm5leHRIZWFsdGggPSBjdXJyZW50VGFyZ2V0LmhlYWx0aAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6dXBkYXRlKCkKICAgIC0tIFJlc2V0cyB0aGUgdGFyZ2V0IGlmIHBsYXllciBkaWVkCiAgICBpZiBwbGF5ZXIuZGVhZCB0aGVuCiAgICAgICAgc2VsZi50YXJnZXQgPSBuaWwKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgLS0gR2V0IGN1cnJlbnQgc2VsZWN0ZWQgdGFyZ2V0IChieSBwbGF5ZXIpIGlmIG5lZWRlZAogICAgaWYgc2VsZjpfdGFyZ2V0U2VsZWN0ZWRCeVBsYXllcigpIHRoZW4gcmV0dXJuIGVuZAogICAgbG9jYWwgc2VsZWN0ZWQsIGluZGV4LCB2YWx1ZSwgbmV4dFBvc2l0aW9uLCBuZXh0SGVhbHRoCiAgICBsb2NhbCByYW5nZSA9IChzZWxmLm1vZGUgPT0gVEFSR0VUX05FQVJfTU9VU0UgYW5kIDIwMDAgb3Igc2VsZi5yYW5nZSkKICAgIGlmIHNlbGYuX21pbmlvblRhYmxlIHRoZW4gc2VsZi5fbWluaW9uVGFibGU6dXBkYXRlKCkgZW5kCiAgICBmb3IgaSwgX2dhbWVIZXJvIGluIGlwYWlycyhfZ2FtZUhlcm9lcykgZG8KICAgICAgICBsb2NhbCBoZXJvID0gX2dhbWVIZXJvLmhlcm8KICAgICAgICBsb2NhbCB2YWxpZFRhcmdldCA9IGZhbHNlCiAgICAgICAgaWYgc2VsZi5fQkJveE1vZGUgdGhlbgogICAgICAgICAgICB2YWxpZFRhcmdldCA9IFZhbGlkQkJveFRhcmdldChoZXJvLCByYW5nZSwgc2VsZi5lbmVteVRlYW0pCiAgICAgICAgZWxzZQogICAgICAgICAgICB2YWxpZFRhcmdldCA9IFZhbGlkVGFyZ2V0KGhlcm8sIHJhbmdlLCBzZWxmLmVuZW15VGVhbSkKICAgICAgICBlbmQKICAgICAgICBpZiB2YWxpZFRhcmdldCBhbmQgbm90IF9nYW1lSGVyby5pZ25vcmUgYW5kIChzZWxmLl9jb25kaXRpb25hbCA9PSBuaWwgb3Igc2VsZi5fY29uZGl0aW9uYWwoaGVybywgaSkpIHRoZW4KICAgICAgICAgICAgbG9jYWwgbWluaW9uQ29sbGlzaW9uID0gZmFsc2UKICAgICAgICAgICAgbG9jYWwgZGVsYXkgPSAwCiAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlVmFsaWQgPSB0cnVlCiAgICAgICAgICAgIGlmIHNlbGYuX3BEZWxheSB+PSBuaWwgYW5kIHNlbGYuX3BEZWxheSA+IDAgdGhlbgogICAgICAgICAgICAgICAgZGVsYXkgPSBkZWxheSArIHNlbGYuX3BEZWxheQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgc2VsZi5fcFNwZWVkIH49IG5pbCBhbmQgc2VsZi5fcFNwZWVkID4gMCB0aGVuCiAgICAgICAgICAgICAgICBkZWxheSA9IGRlbGF5ICsgKEdldERpc3RhbmNlKGhlcm8pIC8gc2VsZi5fcFNwZWVkKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZGVsYXkgPiAwIHRoZW4KICAgICAgICAgICAgICAgIG5leHRQb3NpdGlvbiA9IF9QcmVkaWN0aW9uUG9zaXRpb24oaSwgZGVsYXkpCiAgICAgICAgICAgICAgICBuZXh0SGVhbHRoID0gX1ByZWRpY3Rpb25IZWFsdGgoaSwgZGVsYXkpCiAgICAgICAgICAgICAgICBkaXN0YW5jZVZhbGlkID0gR2V0RGlzdGFuY2UobmV4dFBvc2l0aW9uKSA8PSByYW5nZQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBuZXh0UG9zaXRpb24sIG5leHRIZWFsdGggPSBWZWN0b3IoaGVybyksIGhlcm8uaGVhbHRoCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzZWxmLl9jYXN0V2lkdGggdGhlbiBtaW5pb25Db2xsaXNpb24gPSBHZXRNaW5pb25Db2xsaXNpb24ocGxheWVyLCBuZXh0UG9zaXRpb24sIHNlbGYuX2Nhc3RXaWR0aCwgc2VsZi5fbWluaW9uVGFibGUub2JqZWN0cykgZW5kCiAgICAgICAgICAgIGlmIGRpc3RhbmNlVmFsaWQgYW5kIG1pbmlvbkNvbGxpc2lvbiA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBzZWxmLm1vZGUgPT0gVEFSR0VUX0xPV19IUCBvciBzZWxmLm1vZGUgPT0gVEFSR0VUX0xPV19IUF9QUklPUklUWSBvciBzZWxmLm1vZGUgPT0gVEFSR0VUX0xFU1NfQ0FTVCBvciBzZWxmLm1vZGUgPT0gVEFSR0VUX0xFU1NfQ0FTVF9QUklPUklUWSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gUmV0dXJucyBsb3dlc3QgZWZmZWN0aXZlIEhQIHRhcmdldCB0aGF0IGlzIGluIHJhbmdlCiAgICAgICAgICAgICAgICAgICAgLS0gT3IgbG93ZXN0IGNhc3QgdG8ga2lsbCB0YXJnZXQgdGhhdCBpcyBpbiByYW5nZQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX2RtZ1R5cGUgPT0gREFNQUdFX1BIWVNJQ0FMIHRoZW4gc2VsZi5fcERtZ0Jhc2UgPSBwbGF5ZXIudG90YWxEYW1hZ2UgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbURtZyA9IChzZWxmLl9tRG1nQmFzZSA+IDAgYW5kIHBsYXllcjpDYWxjTWFnaWNEYW1hZ2UoaGVybywgc2VsZi5fbURtZ0Jhc2UpIG9yIDApCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcERtZyA9IChzZWxmLl9wRG1nQmFzZSA+IDAgYW5kIHBsYXllcjpDYWxjRGFtYWdlKGhlcm8sIHNlbGYuX3BEbWdCYXNlKSBvciAwKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRvdGFsRG1nID0gbURtZyArIHBEbWcgKyBzZWxmLl90RG1nCiAgICAgICAgICAgICAgICAgICAgLS0gcHJpb3JpdHkgbW9kZQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYubW9kZSA9PSBUQVJHRVRfTE9XX0hQX1BSSU9SSVRZIG9yIHNlbGYubW9kZSA9PSBUQVJHRVRfTEVTU19DQVNUX1BSSU9SSVRZIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxEbWcgPSB0b3RhbERtZyAvIF9nYW1lSGVyby5wcmlvcml0eQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhlcm9WYWx1ZQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYubW9kZSA9PSBUQVJHRVRfTE9XX0hQIG9yIHNlbGYubW9kZSA9PSBUQVJHRVRfTE9XX0hQX1BSSU9SSVRZIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaGVyb1ZhbHVlID0gaGVyby5oZWFsdGggLSB0b3RhbERtZwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaGVyb1ZhbHVlID0gaGVyby5oZWFsdGggLyB0b3RhbERtZwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZCBvciBoZXJvVmFsdWUgPCB2YWx1ZSB0aGVuIHNlbGVjdGVkLCBpbmRleCwgdmFsdWUgPSBoZXJvLCBpLCBoZXJvVmFsdWUgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgc2VsZi5tb2RlID09IFRBUkdFVF9ERUFEIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9kbWdUeXBlID09IERBTUFHRV9QSFlTSUNBTCB0aGVuIHNlbGYuX3BEbWdCYXNlID0gcGxheWVyLnRvdGFsRGFtYWdlIGVuZAogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1EbWcgPSAoc2VsZi5fbURtZ0Jhc2UgPiAwIGFuZCBwbGF5ZXI6Q2FsY01hZ2ljRGFtYWdlKGhlcm8sIHNlbGYuX21EbWdCYXNlKSBvciAwKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBEbWcgPSAoc2VsZi5fcERtZ0Jhc2UgPiAwIGFuZCBwbGF5ZXI6Q2FsY0RhbWFnZShoZXJvLCBzZWxmLl9wRG1nQmFzZSkgb3IgMCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCB0b3RhbERtZyA9IG1EbWcgKyBwRG1nICsgc2VsZi5fdERtZwogICAgICAgICAgICAgICAgICAgIGlmIGhlcm8uaGVhbHRoIC0gdG90YWxEbWcgPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkLCBpbmRleCwgdmFsdWUgPSBoZXJvLCBpLCAwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgc2VsZi5tb2RlID09IFRBUkdFVF9NT1NUX0FQIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBSZXR1cm5zIHRhcmdldCB0aGF0IGhhcyBoaWdoZXN0IEFQIHRoYXQgaXMgaW4gcmFuZ2UKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWQgb3IgaGVyby5hcCA+IHNlbGVjdGVkLmFwIHRoZW4gc2VsZWN0ZWQsIGluZGV4ID0gaGVybywgaSBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBzZWxmLm1vZGUgPT0gVEFSR0VUX01PU1RfQUQgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIFJldHVybnMgdGFyZ2V0IHRoYXQgaGFzIGhpZ2hlc3QgQUQgdGhhdCBpcyBpbiByYW5nZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZCBvciBoZXJvLnRvdGFsRGFtYWdlID4gc2VsZWN0ZWQudG90YWxEYW1hZ2UgdGhlbiBzZWxlY3RlZCwgaW5kZXggPSBoZXJvLCBpIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIHNlbGYubW9kZSA9PSBUQVJHRVRfUFJJT1JJVFkgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIFJldHVybnMgdGFyZ2V0IHdpdGggaGlnaGVzdCBwcmlvcml0eSAjIHRoYXQgaXMgaW4gcmFuZ2UKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWQgb3IgX2dhbWVIZXJvLnByaW9yaXR5IDwgdmFsdWUgdGhlbiBzZWxlY3RlZCwgaW5kZXgsIHZhbHVlID0gaGVybywgaSwgX2dhbWVIZXJvLnByaW9yaXR5IGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIHNlbGYubW9kZSA9PSBUQVJHRVRfQ0xPU0VTVCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gUmV0dXJucyB0YXJnZXQgdGhhdCBpcyB0aGUgY2xvc2VzdCB0byB5b3VyIGNoYW1waW9uLgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gR2V0RGlzdGFuY2VTcXIoaGVybykKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWQgb3IgZGlzdGFuY2UgPCB2YWx1ZSB0aGVuIHNlbGVjdGVkLCBpbmRleCwgdmFsdWUgPSBoZXJvLCBpLCBkaXN0YW5jZSBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBzZWxmLm1vZGUgPT0gVEFSR0VUX05FQVJfTU9VU0UgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIFJldHVybnMgdGFyZ2V0IHRoYXQgaXMgdGhlIGNsb3Nlc3QgdG8gdGhlIG1vdXNlIGN1cnNvci4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IEdldERpc3RhbmNlU3FyKG1vdXNlUG9zLCBoZXJvKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZCBvciBkaXN0YW5jZSA8IHZhbHVlIHRoZW4gc2VsZWN0ZWQsIGluZGV4LCB2YWx1ZSA9IGhlcm8sIGksIGRpc3RhbmNlIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBzZWxmLmluZGV4ID0gaW5kZXgKICAgIHNlbGYudGFyZ2V0ID0gc2VsZWN0ZWQKICAgIHNlbGYubmV4dFBvc2l0aW9uID0gbmV4dFBvc2l0aW9uCiAgICBzZWxmLm5leHRIZWFsdGggPSBuZXh0SGVhbHRoCmVuZAoKZnVuY3Rpb24gVGFyZ2V0U2VsZWN0b3I6T25TZW5kQ2hhdChtc2csIHByZWZpeCkKICAgIGFzc2VydCh0eXBlKHByZWZpeCkgPT0gInN0cmluZyIgYW5kIHByZWZpeCB+PSAiIiBhbmQgcHJlZml4Omxvd2VyKCkgfj0gInRzIiwgIlRTIE9uU2VuZENoYXQ6IHdyb25nIGFyZ3VtZW50IHR5cGVzICg8c3RyaW5nPiAobm90IFRTKSBleHBlY3RlZCBmb3IgcHJlZml4KSIpCiAgICBpZiBtc2c6c3ViKDEsIDEpIH49ICIuIiB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIHByZWZpeCA9IHByZWZpeDpsb3dlcigpCiAgICBsb2NhbCBsZW5ndGggPSBwcmVmaXg6bGVuKCkgKyAxCiAgICBpZiBtc2c6c3ViKDEsIGxlbmd0aCkgfj0gIi4iIC4uIHByZWZpeCB0aGVuIHJldHVybiBlbmQKICAgIEJsb2NrQ2hhdCgpCiAgICBsb2NhbCBhcmdzID0ge30KICAgIHdoaWxlIHN0cmluZy5maW5kKG1zZywgIiAiKSBkbwogICAgICAgIGxvY2FsIGluZGV4ID0gc3RyaW5nLmZpbmQobXNnLCAiICIpCiAgICAgICAgdGFibGUuaW5zZXJ0KGFyZ3MsIG1zZzpzdWIoMSwgaW5kZXggLSAxKSkKICAgICAgICBtc2cgPSBtc2c6c3ViKGluZGV4ICsgMSkKICAgIGVuZAogICAgdGFibGUuaW5zZXJ0KGFyZ3MsIG1zZykKICAgIGxvY2FsIGNtZCA9IGFyZ3NbMV06bG93ZXIoKQogICAgaWYgY21kID09ICIuIiAuLiBwcmVmaXggLi4gIm1vZGUiIHRoZW4KICAgICAgICBhc3NlcnQoYXJnc1syXSB+PSBuaWwsICJUUyBPblNlbmRDaGF0OiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoTG93SFAsIE1vc3RBUCwgTW9zdEFELCBMZXNzQ2FzdCwgTmVhck1vdXNlLCBQcmlvcml0eSwgTG93SFBQcmlvcml0eSwgTGVzc0Nhc3RQcmlvcml0eSBleHBlY3RlZCkiKQogICAgICAgIGxvY2FsIGluZGV4ID0gMAogICAgICAgIGZvciBpLCBtb2RlIGluIGlwYWlycyh7ICJMb3dIUCIsICJNb3N0QVAiLCAiTW9zdEFEIiwgIkxlc3NDYXN0IiwgIk5lYXJNb3VzZSIsICJQcmlvcml0eSIsICJMb3dIUFByaW9yaXR5IiwgIkxlc3NDYXN0UHJpb3JpdHkiIH0pIGRvCiAgICAgICAgICAgIGlmIG1vZGU6bG93ZXIoKSA9PSBhcmdzWzJdOmxvd2VyKCkgdGhlbgogICAgICAgICAgICAgICAgaW5kZXggPSBpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBhc3NlcnQoaW5kZXggfj0gMCwgIlRTIE9uU2VuZENoYXQ6IHdyb25nIGFyZ3VtZW50IHR5cGVzIChMb3dIUCwgTW9zdEFQLCBNb3N0QUQsIExlc3NDYXN0LCBOZWFyTW91c2UsIFByaW9yaXR5LCBMb3dIUFByaW9yaXR5LCBMZXNzQ2FzdFByaW9yaXR5IGV4cGVjdGVkKSIpCiAgICAgICAgc2VsZi5tb2RlID0gaW5kZXgKICAgICAgICBzZWxmOnByaW50TW9kZSgpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBUYXJnZXRTZWxlY3RvcjpEcmF3TWVudSh4LCB5KQogICAgYXNzZXJ0KHR5cGUoeCkgPT0gIm51bWJlciIgYW5kIHR5cGUoeSkgPT0gIm51bWJlciIsICJ0czpEcmF3TWVudTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxudW1iZXI+LCA8bnVtYmVyPiBleHBlY3RlZCkiKQogICAgX1RTX0RyYXdfSW5pdCgpCiAgICBEcmF3TGluZSh4IC0gX1RTX0RyYXcuYm9yZGVyLCB5ICsgX1RTX0RyYXcubWlkU2l6ZSwgeCArIF9UU19EcmF3LnJvdzMgLSBfVFNfRHJhdy5ib3JkZXIsIHkgKyBfVFNfRHJhdy5taWRTaXplLCBfVFNfRHJhdy5jZWxsU2l6ZSwgX1RTX0RyYXcuYmFja2dyb3VuZCkKICAgIERyYXdUZXh0KChzZWxmLm5hbWUgb3IgInRzIikgLi4gIiBNb2RlIDogIiAuLiBfVGFyZ2V0U2VsZWN0b3JfX3RleHRlZFtzZWxmLm1vZGVdLCBfVFNfRHJhdy5mb250U2l6ZSwgeCwgeSwgX1RTX0RyYXcudGV4dENvbG9yKQogICAgRHJhd0xpbmUoeCArIF9UU19EcmF3LnJvdzMsIHkgKyBfVFNfRHJhdy5taWRTaXplLCB4ICsgX1RTX0RyYXcucm93NCAtIF9UU19EcmF3LmJvcmRlciwgeSArIF9UU19EcmF3Lm1pZFNpemUsIF9UU19EcmF3LmNlbGxTaXplLCBfVFNfRHJhdy5ibHVlQ29sb3IpCiAgICBEcmF3VGV4dCgiICAgPCIsIF9UU19EcmF3LmZvbnRTaXplLCB4ICsgX1RTX0RyYXcucm93MywgeSwgX1RTX0RyYXcudGV4dENvbG9yKQogICAgRHJhd0xpbmUoeCArIF9UU19EcmF3LnJvdzQsIHkgKyBfVFNfRHJhdy5taWRTaXplLCB4ICsgX1RTX0RyYXcud2lkdGgsIHkgKyBfVFNfRHJhdy5taWRTaXplLCBfVFNfRHJhdy5jZWxsU2l6ZSwgX1RTX0RyYXcuYmx1ZUNvbG9yKQogICAgRHJhd1RleHQoIiAgID4iLCBfVFNfRHJhdy5mb250U2l6ZSwgeCArIF9UU19EcmF3LnJvdzQsIHksIF9UU19EcmF3LnRleHRDb2xvcikKICAgIHJldHVybiB5ICsgX1RTX0RyYXcuY2VsbFNpemUKZW5kCgpmdW5jdGlvbiBUYXJnZXRTZWxlY3RvcjpDbGlja01lbnUoeCwgeSkKICAgIGFzc2VydCh0eXBlKHgpID09ICJudW1iZXIiIGFuZCB0eXBlKHkpID09ICJudW1iZXIiLCAidHM6Q2xpY2tNZW51OiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPG51bWJlcj4sIDxudW1iZXI+LCA8c3RyaW5nPiBleHBlY3RlZCkiKQogICAgX1RTX0RyYXdfSW5pdCgpCiAgICBpZiBDdXJzb3JJc1VuZGVyKHggKyBfVFNfRHJhdy5yb3czLCB5LCBfVFNfRHJhdy5mb250U2l6ZSwgX1RTX0RyYXcuZm9udFNpemUpIHRoZW4KICAgICAgICBzZWxmLm1vZGUgPSAoc2VsZi5tb2RlID09IDEgYW5kICNfVGFyZ2V0U2VsZWN0b3JfX3RleHRlZCBvciBzZWxmLm1vZGUgLSAxKQogICAgZWxzZWlmIEN1cnNvcklzVW5kZXIoeCArIF9UU19EcmF3LnJvdzQsIHksIF9UU19EcmF3LmZvbnRTaXplLCBfVFNfRHJhdy5mb250U2l6ZSkgdGhlbgogICAgICAgIHNlbGYubW9kZSA9IChzZWxmLm1vZGUgPT0gI19UYXJnZXRTZWxlY3Rvcl9fdGV4dGVkIGFuZCAxIG9yIHNlbGYubW9kZSArIDEpCiAgICBlbmQKICAgIHJldHVybiB5ICsgX1RTX0RyYXcuY2VsbFNpemUKZW5kCgpTQ1JJUFRfUEFSQU1fT05PRkYgPSAxClNDUklQVF9QQVJBTV9PTktFWURPV04gPSAyClNDUklQVF9QQVJBTV9PTktFWVRPR0dMRSA9IDMKU0NSSVBUX1BBUkFNX1NMSUNFID0gNApTQ1JJUFRfUEFSQU1fSU5GTyA9IDUKU0NSSVBUX1BBUkFNX0NPTE9SID0gNgpTQ1JJUFRfUEFSQU1fTElTVCA9IDcKbG9jYWwgX1NDID0geyBpbml0ID0gdHJ1ZSwgaW5pdERyYXcgPSB0cnVlLCBtZW51S2V5ID0gMTYsIHVzZVRTID0gZmFsc2UsIG1lbnVJbmRleCA9IC0xLCBpbnN0YW5jZXMgPSB7fSwgX2NoYW5nZUtleSA9IGZhbHNlLCBfY2hhbmdlS2V5SW5zdGFuY2UgPSBmYWxzZSwgX3NsaWNlSW5zdGFuY2UgPSBmYWxzZSwgX2xpc3RJbnN0YW5jZSA9IGZhbHNlIH0KY2xhc3Mnc2NyaXB0Q29uZmlnJwpsb2NhbCBmdW5jdGlvbiBfX1NDX19yZW1vdmUobmFtZSkKICAgIGlmIG5vdCBHZXRTYXZlKCJzY3JpcHRDb25maWciKVtuYW1lXSB0aGVuIEdldFNhdmUoInNjcmlwdENvbmZpZyIpW25hbWVdID0ge30gZW5kCiAgICB0YWJsZS5jbGVhcihHZXRTYXZlKCJzY3JpcHRDb25maWciKVtuYW1lXSkKZW5kCgpsb2NhbCBmdW5jdGlvbiBfX1NDX19sb2FkKG5hbWUpCiAgICBpZiBub3QgR2V0U2F2ZSgic2NyaXB0Q29uZmlnIilbbmFtZV0gdGhlbiBHZXRTYXZlKCJzY3JpcHRDb25maWciKVtuYW1lXSA9IHt9IGVuZAogICAgcmV0dXJuIEdldFNhdmUoInNjcmlwdENvbmZpZyIpW25hbWVdCmVuZAoKbG9jYWwgZnVuY3Rpb24gX19TQ19fc2F2ZShuYW1lLCBjb250ZW50KQogICAgaWYgbm90IEdldFNhdmUoInNjcmlwdENvbmZpZyIpW25hbWVdIHRoZW4gR2V0U2F2ZSgic2NyaXB0Q29uZmlnIilbbmFtZV0gPSB7fSBlbmQKICAgIHRhYmxlLmNsZWFyKEdldFNhdmUoInNjcmlwdENvbmZpZyIpW25hbWVdKQogICAgdGFibGUubWVyZ2UoR2V0U2F2ZSgic2NyaXB0Q29uZmlnIilbbmFtZV0sIGNvbnRlbnQsIHRydWUpCmVuZAoKbG9jYWwgZnVuY3Rpb24gX19TQ19fc2F2ZU1hc3RlcigpCiAgICBsb2NhbCBjb25maWcgPSB7fQogICAgbG9jYWwgUCwgUFMsIEkgPSAwLCAwLCAwCiAgICBmb3IgXywgaW5zdGFuY2UgaW4gcGFpcnMoX1NDLmluc3RhbmNlcykgZG8KICAgICAgICBJID0gSSArIDEKICAgICAgICBQID0gUCArICNpbnN0YW5jZS5fcGFyYW0KICAgICAgICBQUyA9IFBTICsgI2luc3RhbmNlLl9wZXJtYVNob3cKICAgIGVuZAogICAgX1NDLm1hc3RlclsiSSIgLi4gX1NDLm1hc3RlckluZGV4XSA9IEkKICAgIF9TQy5tYXN0ZXJbIlAiIC4uIF9TQy5tYXN0ZXJJbmRleF0gPSBQCiAgICBfU0MubWFzdGVyWyJQUyIgLi4gX1NDLm1hc3RlckluZGV4XSA9IFBTCiAgICBpZiBub3QgX1NDLm1hc3Rlci51c2VUUyBhbmQgX1NDLnVzZVRTIHRoZW4gX1NDLm1hc3Rlci51c2VUUyA9IHRydWUgZW5kCiAgICBmb3IgdmFyLCB2YWx1ZSBpbiBwYWlycyhfU0MubWFzdGVyKSBkbwogICAgICAgIGNvbmZpZ1t2YXJdID0gdmFsdWUKICAgIGVuZAogICAgX19TQ19fc2F2ZSgiTWFzdGVyIiwgY29uZmlnKQplbmQKCmxvY2FsIGZ1bmN0aW9uIF9fU0NfX3VwZGF0ZU1hc3RlcigpCiAgICBfU0MubWFzdGVyID0gX19TQ19fbG9hZCgiTWFzdGVyIikKICAgIF9TQy5tYXN0ZXJZLCBfU0MubWFzdGVyWXAgPSAxLCAwCiAgICBfU0MubWFzdGVyWSA9IChfU0MubWFzdGVyLnVzZVRTIGFuZCAxIG9yIDApCiAgICBmb3IgaSA9IDEsIF9TQy5tYXN0ZXJJbmRleCAtIDEgZG8KICAgICAgICBfU0MubWFzdGVyWSA9IF9TQy5tYXN0ZXJZICsgX1NDLm1hc3RlclsiSSIgLi4gaV0KICAgICAgICBfU0MubWFzdGVyWXAgPSBfU0MubWFzdGVyWXAgKyBfU0MubWFzdGVyWyJQUyIgLi4gaV0KICAgIGVuZAogICAgbG9jYWwgc2l6ZSwgc2l6ZXAgPSAoX1NDLm1hc3Rlci51c2VUUyBhbmQgMiBvciAxKSwgMAogICAgZm9yIGkgPSAxLCBfU0MubWFzdGVyLmlDb3VudCBkbwogICAgICAgIHNpemUgPSBzaXplICsgX1NDLm1hc3RlclsiSSIgLi4gaV0KICAgICAgICBzaXplcCA9IHNpemVwICsgX1NDLm1hc3RlclsiUFMiIC4uIGldCiAgICBlbmQKICAgIF9TQy5kcmF3LmhlaWdodCA9IHNpemUgKiBfU0MuZHJhdy5jZWxsU2l6ZQogICAgX1NDLnBEcmF3LmhlaWdodCA9IHNpemVwICogX1NDLnBEcmF3LmNlbGxTaXplCiAgICBfU0MuZHJhdy54ID0gX1NDLm1hc3Rlci54CiAgICBfU0MuZHJhdy55ID0gX1NDLm1hc3Rlci55CiAgICBfU0MucERyYXcueCA9IF9TQy5tYXN0ZXIucHgKICAgIF9TQy5wRHJhdy55ID0gX1NDLm1hc3Rlci5weQogICAgX1NDLl9JZHJhdy54ID0gX1NDLmRyYXcueCArIF9TQy5kcmF3LndpZHRoICsgX1NDLmRyYXcuYm9yZGVyICogMgplbmQKCmxvY2FsIGZ1bmN0aW9uIF9fU0NfX3NhdmVNZW51KCkKICAgIF9fU0NfX3NhdmUoIk1lbnUiLCB7IG1lbnVLZXkgPSBfU0MubWVudUtleSwgZHJhdyA9IHsgeCA9IF9TQy5kcmF3LngsIHkgPSBfU0MuZHJhdy55IH0sIHBEcmF3ID0geyB4ID0gX1NDLnBEcmF3LngsIHkgPSBfU0MucERyYXcueSB9IH0pCiAgICBfU0MubWFzdGVyLnggPSBfU0MuZHJhdy54CiAgICBfU0MubWFzdGVyLnkgPSBfU0MuZHJhdy55CiAgICBfU0MubWFzdGVyLnB4ID0gX1NDLnBEcmF3LngKICAgIF9TQy5tYXN0ZXIucHkgPSBfU0MucERyYXcueQogICAgX19TQ19fc2F2ZU1hc3RlcigpCmVuZAoKbG9jYWwgZnVuY3Rpb24gX19TQ19faW5pdF9kcmF3KCkKICAgIGlmIF9TQy5pbml0RHJhdyB0aGVuCiAgICAgICAgVXBkYXRlV2luZG93KCkKICAgICAgICBfU0MuZHJhdyA9IHsgeCA9IFdJTkRPV19XIGFuZCBtYXRoLmZsb29yKFdJTkRPV19XIC8gNTApIG9yIDIwLCB5ID0gV0lORE9XX0ggYW5kIG1hdGguZmxvb3IoV0lORE9XX0ggLyA0KSBvciAxOTAsIHkxID0gMCwgaGVpZ2h0ID0gMCwgZm9udFNpemUgPSBXSU5ET1dfSCBhbmQgbWF0aC5yb3VuZChXSU5ET1dfSCAvIDU0KSBvciAxNCwgd2lkdGggPSBXSU5ET1dfVyBhbmQgbWF0aC5yb3VuZChXSU5ET1dfVyAvIDQuOCkgb3IgMjEzLCBib3JkZXIgPSAyLCBiYWNrZ3JvdW5kID0gMTQxMzE2NzkzMSwgdGV4dENvbG9yID0gNDI5MDQyNzU3OCwgdHJ1ZUNvbG9yID0gMTQyMjcyMTAyNCwgZmFsc2VDb2xvciA9IDE0MDkzMjE3MjgsIG1vdmUgPSBmYWxzZSB9CiAgICAgICAgX1NDLnBEcmF3ID0geyB4ID0gV0lORE9XX1cgYW5kIG1hdGguZmxvb3IoV0lORE9XX1cgKiAwLjY2KSBvciA2NzUsIHkgPSBXSU5ET1dfSCBhbmQgbWF0aC5mbG9vcihXSU5ET1dfSCAqIDAuOCkgb3IgNjA4LCB5MSA9IDAsIGhlaWdodCA9IDAsIGZvbnRTaXplID0gV0lORE9XX0ggYW5kIG1hdGgucm91bmQoV0lORE9XX0ggLyA3Mikgb3IgMTAsIHdpZHRoID0gV0lORE9XX1cgYW5kIG1hdGgucm91bmQoV0lORE9XX1cgLyA2LjQpIG9yIDE2MCwgYm9yZGVyID0gMSwgYmFja2dyb3VuZCA9IDE0MTMxNjc5MzEsIHRleHRDb2xvciA9IDQyOTA0Mjc1NzgsIHRydWVDb2xvciA9IDE0MjI3MjEwMjQsIGZhbHNlQ29sb3IgPSAxNDA5MzIxNzI4LCBtb3ZlID0gZmFsc2UgfQogICAgICAgIGxvY2FsIG1lbnVDb25maWcgPSBfX1NDX19sb2FkKCJNZW51IikKICAgICAgICB0YWJsZS5tZXJnZShfU0MsIG1lbnVDb25maWcsIHRydWUpCiAgICAgICAgX1NDLmNvbG9yID0geyBsZ3JleSA9IDE0MTMxNjc5MzEsIGdyZXkgPSA0MjkwNDI3NTc4LCByZWQgPSAxNDIyNzIxMDI0LCBncmVlbiA9IDE0MDkzMjE3MjgsIGl2b3J5ID0gNDI5NDk2NzI4MCB9CiAgICAgICAgX1NDLmRyYXcuY2VsbFNpemUsIF9TQy5kcmF3Lm1pZFNpemUsIF9TQy5kcmF3LnJvdzQsIF9TQy5kcmF3LnJvdzMsIF9TQy5kcmF3LnJvdzIsIF9TQy5kcmF3LnJvdzEgPSBfU0MuZHJhdy5mb250U2l6ZSArIF9TQy5kcmF3LmJvcmRlciwgX1NDLmRyYXcuZm9udFNpemUgLyAyLCBfU0MuZHJhdy53aWR0aCAqIDAuOSwgX1NDLmRyYXcud2lkdGggKiAwLjgsIF9TQy5kcmF3LndpZHRoICogMC43LCBfU0MuZHJhdy53aWR0aCAqIDAuNgogICAgICAgIF9TQy5wRHJhdy5jZWxsU2l6ZSwgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy5yb3cgPSBfU0MucERyYXcuZm9udFNpemUgKyBfU0MucERyYXcuYm9yZGVyLCBfU0MucERyYXcuZm9udFNpemUgLyAyLCBfU0MucERyYXcud2lkdGggKiAwLjcKICAgICAgICBfU0MuX0lkcmF3ID0geyB4ID0gX1NDLmRyYXcueCArIF9TQy5kcmF3LndpZHRoICsgX1NDLmRyYXcuYm9yZGVyICogMiwgeSA9IF9TQy5kcmF3LnksIGhlaWdodCA9IDAgfQogICAgICAgIGlmIFdJTkRPV19IIDwgNTAwIG9yIFdJTkRPV19XIDwgNTAwIHRoZW4gcmV0dXJuIHRydWUgZW5kCiAgICAgICAgX1NDLmluaXREcmF3ID0gbmlsCiAgICBlbmQKICAgIHJldHVybiBfU0MuaW5pdERyYXcKZW5kCmxvY2FsIFNWTG9hZGVkCmxvY2FsIGZ1bmN0aW9uIF9fU0NfX2luaXQobmFtZSkKICAgIGlmIG5hbWUgPT0gbmlsIHRoZW4KICAgICAgICByZXR1cm4gKF9TQy5pbml0IG9yIF9fU0NfX2luaXRfZHJhdygpKQogICAgZW5kCiAgICBpZiBfU0MuaW5pdCB0aGVuCiAgICAgICAgX1NDLmluaXQgPSBuaWwKICAgICAgICBfX1NDX19pbml0X2RyYXcoKQogICAgICAgIGxvY2FsIGdhbWVTdGFydCA9IEdldEdhbWUoKQogICAgICAgIF9TQy5tYXN0ZXIgPSBfX1NDX19sb2FkKCJNYXN0ZXIiKQogICAgICAgIC0tW1sgU3VyZmFjZVM6IExvb2sgaW50byBpdCEgV2hlbiBsb2FkaW5nIHRoZSBtYXN0ZXIsIGl0IHNjcmV3cyB1cCB0aGUgTWVudSwgd2hlbiB5b3UgY2hhbmdlIGF0IHRoZSBzYW1lIHRpbWUgdGhlIHJ1bm5pbmcgc2NyaXB0cy4KICAgICAgICAgICBpZiBfU0MubWFzdGVyLm9zVGltZSB+PSBuaWwgYW5kIF9TQy5tYXN0ZXIub3NUaW1lID09IGdhbWVTdGFydC5vc1RpbWUgdGhlbgogICAgICAgICAgICAgIGZvciBpID0gMSwgX1NDLm1hc3Rlci5pQ291bnQgZG8KICAgICAgICAgICAgICAgICAgaWYgX1NDLm1hc3RlclsibmFtZSIgLi4gaV0gPT0gbmFtZSB0aGVuIF9TQy5tYXN0ZXJJbmRleCA9IGkgZW5kCiAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgaWYgX1NDLm1hc3RlckluZGV4ID09IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgIF9TQy5tYXN0ZXJJbmRleCA9IF9TQy5tYXN0ZXIuaUNvdW50ICsgMQogICAgICAgICAgICAgICAgICBfU0MubWFzdGVyWyJuYW1lIiAuLiBfU0MubWFzdGVySW5kZXhdID0gbmFtZQogICAgICAgICAgICAgICAgICBfU0MubWFzdGVyLmlDb3VudCA9IF9TQy5tYXN0ZXJJbmRleAogICAgICAgICAgICAgICAgICBfX1NDX19zYXZlTWFzdGVyKCkKICAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VdXQogICAgICAgIF9fU0NfX3JlbW92ZSgiTWFzdGVyIikKICAgICAgICBfU0MubWFzdGVySW5kZXggPSAxCiAgICAgICAgX1NDLm1hc3Rlci51c2VUUyA9IGZhbHNlCiAgICAgICAgX1NDLm1hc3Rlci54ID0gX1NDLmRyYXcueAogICAgICAgIF9TQy5tYXN0ZXIueSA9IF9TQy5kcmF3LnkKICAgICAgICBfU0MubWFzdGVyLnB4ID0gX1NDLnBEcmF3LngKICAgICAgICBfU0MubWFzdGVyLnB5ID0gX1NDLnBEcmF3LnkKICAgICAgICBfU0MubWFzdGVyLm9zVGltZSA9IGdhbWVTdGFydC5vc1RpbWUKICAgICAgICBfU0MubWFzdGVyLm5hbWUxID0gbmFtZQogICAgICAgIF9TQy5tYXN0ZXIuaUNvdW50ID0gMQogICAgICAgIF9fU0NfX3NhdmVNYXN0ZXIoKQogICAgICAgIC0tZW5kCiAgICBlbmQKICAgIF9fU0NfX3VwZGF0ZU1hc3RlcigpCmVuZAoKbG9jYWwgZnVuY3Rpb24gX19TQ19fdHh0S2V5KGtleSkKICAgIHJldHVybiAoa2V5ID4gMzIgYW5kIGtleSA8IDk2IGFuZCAiICIgLi4gc3RyaW5nLmNoYXIoa2V5KSAuLiAiICIgb3IgIigiIC4uIHRvc3RyaW5nKGtleSkgLi4gIikiKQplbmQKCmxvY2FsIGZ1bmN0aW9uIF9fU0NfX0RyYXdJbnN0YW5jZShoZWFkZXIsIHNlbGVjdGVkKQogICAgRHJhd0xpbmUoX1NDLmRyYXcueCArIF9TQy5kcmF3LndpZHRoIC8gMiwgX1NDLmRyYXcueTEsIF9TQy5kcmF3LnggKyBfU0MuZHJhdy53aWR0aCAvIDIsIF9TQy5kcmF3LnkxICsgX1NDLmRyYXcuY2VsbFNpemUsIF9TQy5kcmF3LndpZHRoICsgX1NDLmRyYXcuYm9yZGVyICogMiwgKHNlbGVjdGVkIGFuZCBfU0MuY29sb3IucmVkIG9yIF9TQy5jb2xvci5sZ3JleSkpCiAgICBEcmF3VGV4dChoZWFkZXIsIF9TQy5kcmF3LmZvbnRTaXplLCBfU0MuZHJhdy54LCBfU0MuZHJhdy55MSwgKHNlbGVjdGVkIGFuZCBfU0MuY29sb3IuaXZvcnkgb3IgX1NDLmNvbG9yLmdyZXkpKQogICAgX1NDLmRyYXcueTEgPSBfU0MuZHJhdy55MSArIF9TQy5kcmF3LmNlbGxTaXplCmVuZAoKbG9jYWwgZnVuY3Rpb24gX19TQ19fUmVzZXRTdWJJbmRleGVzKCkKICAgIGZvciBpLCBpbnN0YW5jZSBpbiBpcGFpcnMoX1NDLmluc3RhbmNlcykgZG8KICAgICAgICBpbnN0YW5jZTpSZXNldFN1YkluZGV4ZXMoKQogICAgZW5kCmVuZAoKbG9jYWwgX19TQ19fT25EcmF3LCBfX1NDX19PblduZE1zZwpsb2NhbCBmdW5jdGlvbiBfX1NDX19PbkxvYWQoKQogICAgaWYgbm90IF9fU0NfX09uRHJhdyB0aGVuCiAgICAgICAgZnVuY3Rpb24gX19TQ19fT25EcmF3KCkKICAgICAgICAgICAgaWYgX19TQ19faW5pdCgpIG9yIENvbnNvbGVfX0lzT3BlbiBvciBHZXRHYW1lKCkuaXNPdmVyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBpZiBJc0tleURvd24oX1NDLm1lbnVLZXkpIG9yIF9TQy5fY2hhbmdlS2V5IHRoZW4KICAgICAgICAgICAgICAgIGlmIF9TQy5kcmF3Lm1vdmUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGN1cnNvciA9IEdldEN1cnNvclBvcygpCiAgICAgICAgICAgICAgICAgICAgX1NDLmRyYXcueCA9IGN1cnNvci54IC0gX1NDLmRyYXcub2Zmc2V0LngKICAgICAgICAgICAgICAgICAgICBfU0MuZHJhdy55ID0gY3Vyc29yLnkgLSBfU0MuZHJhdy5vZmZzZXQueQogICAgICAgICAgICAgICAgICAgIF9TQy5fSWRyYXcueCA9IF9TQy5kcmF3LnggKyBfU0MuZHJhdy53aWR0aCArIF9TQy5kcmF3LmJvcmRlciAqIDIKICAgICAgICAgICAgICAgIGVsc2VpZiBfU0MucERyYXcubW92ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3Vyc29yID0gR2V0Q3Vyc29yUG9zKCkKICAgICAgICAgICAgICAgICAgICBfU0MucERyYXcueCA9IGN1cnNvci54IC0gX1NDLnBEcmF3Lm9mZnNldC54CiAgICAgICAgICAgICAgICAgICAgX1NDLnBEcmF3LnkgPSBjdXJzb3IueSAtIF9TQy5wRHJhdy5vZmZzZXQueQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBfU0MubWFzdGVySW5kZXggPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgRHJhd0xpbmUoX1NDLmRyYXcueCArIF9TQy5kcmF3LndpZHRoIC8gMiwgX1NDLmRyYXcueSwgX1NDLmRyYXcueCArIF9TQy5kcmF3LndpZHRoIC8gMiwgX1NDLmRyYXcueSArIF9TQy5kcmF3LmhlaWdodCwgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIgKiAyLCAxNDE0ODEyNzU2KSAtLSBncmV5CiAgICAgICAgICAgICAgICAgICAgX1NDLmRyYXcueTEgPSBfU0MuZHJhdy55CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbWVudVRleHQgPSBfU0MuX2NoYW5nZUtleSBhbmQgbm90IF9TQy5fY2hhbmdlS2V5VmFyIGFuZCAicHJlc3Mga2V5IGZvciBNZW51IiBvciAiTWVudSIKICAgICAgICAgICAgICAgICAgICBEcmF3VGV4dChtZW51VGV4dCwgX1NDLmRyYXcuZm9udFNpemUsIF9TQy5kcmF3LngsIF9TQy5kcmF3LnkxLCBfU0MuY29sb3IuaXZvcnkpIC0tIGl2b3J5CiAgICAgICAgICAgICAgICAgICAgRHJhd1RleHQoX19TQ19fdHh0S2V5KF9TQy5tZW51S2V5KSwgX1NDLmRyYXcuZm9udFNpemUsIF9TQy5kcmF3LnggKyBfU0MuZHJhdy53aWR0aCAqIDAuOSwgX1NDLmRyYXcueTEsIF9TQy5jb2xvci5ncmV5KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBfU0MuZHJhdy55MSA9IF9TQy5kcmF3LnkgKyBfU0MuZHJhdy5jZWxsU2l6ZQogICAgICAgICAgICAgICAgaWYgX1NDLnVzZVRTIHRoZW4KICAgICAgICAgICAgICAgICAgICBfX1NDX19EcmF3SW5zdGFuY2UoIlRhcmdldCBTZWxlY3RvciIsIChfU0MubWVudUluZGV4ID09IDApKQogICAgICAgICAgICAgICAgICAgIGlmIF9TQy5tZW51SW5kZXggPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIERyYXdMaW5lKF9TQy5fSWRyYXcueCArIF9TQy5kcmF3LndpZHRoIC8gMiwgX1NDLmRyYXcueSwgX1NDLl9JZHJhdy54ICsgX1NDLmRyYXcud2lkdGggLyAyLCBfU0MuZHJhdy55ICsgX1NDLl9JZHJhdy5oZWlnaHQsIF9TQy5kcmF3LndpZHRoICsgX1NDLmRyYXcuYm9yZGVyICogMiwgMTQxNDgxMjc1NikgLS0gZ3JleQogICAgICAgICAgICAgICAgICAgICAgICBEcmF3VGV4dCgiVGFyZ2V0IFNlbGVjdG9yIiwgX1NDLmRyYXcuZm9udFNpemUsIF9TQy5fSWRyYXcueCwgX1NDLmRyYXcueSwgX1NDLmNvbG9yLml2b3J5KQogICAgICAgICAgICAgICAgICAgICAgICBfU0MuX0lkcmF3LnkgPSBUU19fRHJhd01lbnUoX1NDLl9JZHJhdy54LCBfU0MuZHJhdy55ICsgX1NDLmRyYXcuY2VsbFNpemUpCiAgICAgICAgICAgICAgICAgICAgICAgIF9TQy5fSWRyYXcuaGVpZ2h0ID0gX1NDLl9JZHJhdy55IC0gX1NDLmRyYXcueQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBfU0MuZHJhdy55MSA9IF9TQy5kcmF3LnkgKyBfU0MuZHJhdy5jZWxsU2l6ZSArIChfU0MuZHJhdy5jZWxsU2l6ZSAqIF9TQy5tYXN0ZXJZKQogICAgICAgICAgICAgICAgZm9yIGluZGV4LCBpbnN0YW5jZSBpbiBpcGFpcnMoX1NDLmluc3RhbmNlcykgZG8KICAgICAgICAgICAgICAgICAgICBfX1NDX19EcmF3SW5zdGFuY2UoaW5zdGFuY2UuaGVhZGVyLCAoX1NDLm1lbnVJbmRleCA9PSBpbmRleCkpCiAgICAgICAgICAgICAgICAgICAgaWYgX1NDLm1lbnVJbmRleCA9PSBpbmRleCB0aGVuIGluc3RhbmNlOk9uRHJhdygpIGVuZAoJCQkJZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCB5MSA9IF9TQy5wRHJhdy55ICsgKF9TQy5wRHJhdy5jZWxsU2l6ZSAqIF9TQy5tYXN0ZXJZcCkKICAgICAgICAgICAgbG9jYWwgZnVuY3Rpb24gRHJhd1Blcm1hU2hvd3MoaW5zdGFuY2UpCgkJCWxvY2FsIHZhckluZGV4X2NvdW50ID0gMAogICAgICAgICAgICAgICAgaWYgI2luc3RhbmNlLl9wZXJtYVNob3cgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgdmFySW5kZXggaW4gaXBhaXJzKGluc3RhbmNlLl9wZXJtYVNob3cpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBWYXIgPSBpbnN0YW5jZS5fcGFyYW1bdmFySW5kZXhdLnZhcgogICAgICAgICAgICAgICAgICAgICAgICBEcmF3TGluZShfU0MucERyYXcueCAtIF9TQy5wRHJhdy5ib3JkZXIsIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy54ICsgX1NDLnBEcmF3LnJvdyAtIF9TQy5wRHJhdy5ib3JkZXIsIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy5jZWxsU2l6ZSwgX1NDLmNvbG9yLmxncmV5KQogICAgICAgICAgICAgICAgICAgICAgICBEcmF3VGV4dChpbnN0YW5jZS5fcGFyYW1bdmFySW5kZXhdLnRleHQsIF9TQy5wRHJhdy5mb250U2l6ZSwgX1NDLnBEcmF3LngsIHkxLCBfU0MuY29sb3IuZ3JleSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5zdGFuY2UuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fU0xJQ0Ugb3IgaW5zdGFuY2UuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fTElTVCBvciBpbnN0YW5jZS5fcGFyYW1bdmFySW5kZXhdLnBUeXBlID09IFNDUklQVF9QQVJBTV9JTkZPIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyYXdMaW5lKF9TQy5wRHJhdy54ICsgX1NDLnBEcmF3LnJvdywgeTEgKyBfU0MucERyYXcubWlkU2l6ZSwgX1NDLnBEcmF3LnggKyBfU0MucERyYXcud2lkdGggKyBfU0MucERyYXcuYm9yZGVyLCB5MSArIF9TQy5wRHJhdy5taWRTaXplLCBfU0MucERyYXcuY2VsbFNpemUsIF9TQy5jb2xvci5sZ3JleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGluc3RhbmNlLl9wYXJhbVt2YXJJbmRleF0ucFR5cGUgPT0gU0NSSVBUX1BBUkFNX0xJU1QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRleHQgPSB0b3N0cmluZyhpbnN0YW5jZS5fcGFyYW1bdmFySW5kZXhdLmxpc3RUYWJsZVtpbnN0YW5jZVtwVmFyXV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbWF4V2lkdGggPSAoX1NDLnBEcmF3LndpZHRoIC0gX1NDLnBEcmF3LnJvdykgKiAwLjgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0V2lkdGggPSBHZXRUZXh0QXJlYSh0ZXh0LCBfU0MucERyYXcuZm9udFNpemUpLngKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0ZXh0V2lkdGggPiBtYXhXaWR0aCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0OnN1YigxLCBtYXRoLmZsb29yKHRleHQ6bGVuKCkgKiBtYXhXaWR0aCAvIHRleHRXaWR0aCkpIC4uICIuLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcmF3VGV4dCh0ZXh0LCBfU0MucERyYXcuZm9udFNpemUsIF9TQy5wRHJhdy54ICsgX1NDLnBEcmF3LnJvdywgeTEsIF9TQy5jb2xvci5ncmV5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyYXdUZXh0KHRvc3RyaW5nKGluc3RhbmNlW3BWYXJdKSwgX1NDLnBEcmF3LmZvbnRTaXplLCBfU0MucERyYXcueCArIF9TQy5wRHJhdy5yb3cgKyBfU0MucERyYXcuYm9yZGVyLCB5MSwgX1NDLmNvbG9yLmdyZXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRHJhd0xpbmUoX1NDLnBEcmF3LnggKyBfU0MucERyYXcucm93LCB5MSArIF9TQy5wRHJhdy5taWRTaXplLCBfU0MucERyYXcueCArIF9TQy5wRHJhdy53aWR0aCArIF9TQy5wRHJhdy5ib3JkZXIsIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy5jZWxsU2l6ZSwgKGluc3RhbmNlW3BWYXJdIGFuZCBfU0MuY29sb3IuZ3JlZW4gb3IgX1NDLmNvbG9yLmxncmV5KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERyYXdUZXh0KChpbnN0YW5jZVtwVmFyXSBhbmQgIiAgICAgIE9OIiBvciAiICAgICAgT0ZGIiksIF9TQy5wRHJhdy5mb250U2l6ZSwgX1NDLnBEcmF3LnggKyBfU0MucERyYXcucm93ICsgX1NDLnBEcmF3LmJvcmRlciwgeTEsIF9TQy5jb2xvci5ncmV5KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgeTEgPSB5MSArIF9TQy5wRHJhdy5jZWxsU2l6ZQoJCQkJCQl2YXJJbmRleF9jb3VudCA9IHZhckluZGV4X2NvdW50ICsgMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgoKCiAgICAgICAgICAgICAgICBmb3IgXywgc3ViSW5zdGFuY2UgaW4gaXBhaXJzKGluc3RhbmNlLl9zdWJJbnN0YW5jZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgRHJhd1Blcm1hU2hvd3Moc3ViSW5zdGFuY2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgoKICAgICAgICAgICAgbG9jYWwgZnVuY3Rpb24gRHJhd0N1c3RvbVBlcm1hU2hvd3MoKQoJCQkJaWYgX0cuU1ZfUEVSTUFTSE9XIH49IG5pbCBhbmQgX0cuU1ZfUEVSTUFTSE9XWyJDb3VudCJdIH49IG5pbCBhbmQgX0cuU1ZfUEVSTUFTSE9XWyJDb3VudCJdID4gMCB0aGVuCgkJCQkJZm9yIGkgPSAxLF9HLlNWX1BFUk1BU0hPV1siQ291bnQiXSBkbwoJCQkJCQlEcmF3TGluZShfU0MucERyYXcueCAtIF9TQy5wRHJhdy5ib3JkZXIsIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy54ICsgX1NDLnBEcmF3LnJvdyAtIF9TQy5wRHJhdy5ib3JkZXIsIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy5jZWxsU2l6ZSwgX1NDLmNvbG9yLmxncmV5KQoJCQkJCQlEcmF3VGV4dChfRy5TVl9QRVJNQVNIT1dbKGkpLi4iX05hbWUiXSwgX1NDLnBEcmF3LmZvbnRTaXplLCBfU0MucERyYXcueCwgeTEsIF9TQy5jb2xvci5ncmV5KQoJCQkJCQlEcmF3TGluZShfU0MucERyYXcueCArIF9TQy5wRHJhdy5yb3csIHkxICsgX1NDLnBEcmF3Lm1pZFNpemUsIF9TQy5wRHJhdy54ICsgX1NDLnBEcmF3LndpZHRoICsgX1NDLnBEcmF3LmJvcmRlciwgeTEgKyBfU0MucERyYXcubWlkU2l6ZSwgX1NDLnBEcmF3LmNlbGxTaXplLCAoX0cuU1ZfUEVSTUFTSE9XWyhpKS4uIl9TdGF0dXMiXSBhbmQgX1NDLmNvbG9yLmdyZWVuIG9yIF9TQy5jb2xvci5sZ3JleSkpCgkJCQkJCURyYXdUZXh0KChfRy5TVl9QRVJNQVNIT1dbKGkpLi4iX1N0YXR1cyJdIGFuZCAiICAgICAgT04iIG9yICIgICAgICBPRkYiKSwgX1NDLnBEcmF3LmZvbnRTaXplLCBfU0MucERyYXcueCArIF9TQy5wRHJhdy5yb3cgKyBfU0MucERyYXcuYm9yZGVyLCB5MSwgX1NDLmNvbG9yLmdyZXkpCgkJCQkJCXkxID0geTEgKyBfU0MucERyYXcuY2VsbFNpemUKCQkJCQllbmQKCQkJCWVuZAogICAgICAgICAgICBlbmQKCgogICAgICAgICAgICBmb3IgXywgaW5zdGFuY2UgaW4gaXBhaXJzKF9TQy5pbnN0YW5jZXMpIGRvCiAgICAgICAgICAgICAgICBEcmF3UGVybWFTaG93cyhpbnN0YW5jZSkKICAgICAgICAgICAgZW5kCgkJCSAgICBEcmF3Q3VzdG9tUGVybWFTaG93cygpCgogICAgICAgIGVuZAoKICAgICAgICBBZGREcmF3Q2FsbGJhY2soX19TQ19fT25EcmF3KQogICAgZW5kCiAgICBpZiBub3QgX19TQ19fT25XbmRNc2cgdGhlbgogICAgICAgIGZ1bmN0aW9uIF9fU0NfX09uV25kTXNnKG1zZywga2V5KQogICAgICAgICAgICBpZiBfX1NDX19pbml0KCkgb3IgQ29uc29sZV9fSXNPcGVuIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICBsb2NhbCBtc2csIGtleSA9IG1zZywga2V5CiAgICAgICAgICAgIGlmIGtleSA9PSBfU0MubWVudUtleSBhbmQgX1NDLmxhc3RLZXlTdGF0ZSB+PSBtc2cgdGhlbgogICAgICAgICAgICAgICAgX1NDLmxhc3RLZXlTdGF0ZSA9IG1zZwogICAgICAgICAgICAgICAgX19TQ19fdXBkYXRlTWFzdGVyKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIF9TQy5fY2hhbmdlS2V5IHRoZW4KICAgICAgICAgICAgICAgIGlmIG1zZyA9PSBLRVlfRE9XTiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgX1NDLl9jaGFuZ2VLZXlNZW51IHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIF9TQy5fY2hhbmdlS2V5ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBpZiBfU0MuX2NoYW5nZUtleVZhciA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfU0MubWVudUtleSA9IGtleQogICAgICAgICAgICAgICAgICAgICAgICBpZiBfU0MubWFzdGVySW5kZXggPT0gMSB0aGVuIF9fU0NfX3NhdmVNZW51KCkgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBfU0MuX2NoYW5nZUtleUluc3RhbmNlLl9wYXJhbVtfU0MuX2NoYW5nZUtleVZhcl0ua2V5ID0ga2V5CiAgICAgICAgICAgICAgICAgICAgICAgIF9TQy5fY2hhbmdlS2V5SW5zdGFuY2U6c2F2ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIC0tX1NDLmluc3RhbmNlc1tfU0MubWVudUluZGV4XS5fcGFyYW1bX1NDLl9jaGFuZ2VLZXlWYXJdLmtleSA9IGtleQogICAgICAgICAgICAgICAgICAgICAgICAtLV9TQy5pbnN0YW5jZXNbX1NDLm1lbnVJbmRleF06c2F2ZSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgX1NDLl9jaGFuZ2VLZXlNZW51IGFuZCBrZXkgPT0gX1NDLm1lbnVLZXkgdGhlbiBfU0MuX2NoYW5nZUtleU1lbnUgPSBmYWxzZSBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgbXNnID09IFdNX0xCVVRUT05ET1dOIGFuZCBJc0tleURvd24oX1NDLm1lbnVLZXkpIHRoZW4KICAgICAgICAgICAgICAgIGlmIEN1cnNvcklzVW5kZXIoX1NDLmRyYXcueCwgX1NDLmRyYXcueSwgX1NDLmRyYXcud2lkdGgsIF9TQy5kcmF3LmhlaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgIF9TQy5tZW51SW5kZXggPSAtMQogICAgICAgICAgICAgICAgICAgIF9fU0NfX1Jlc2V0U3ViSW5kZXhlcygpCiAgICAgICAgICAgICAgICAgICAgaWYgQ3Vyc29ySXNVbmRlcihfU0MuZHJhdy54ICsgX1NDLmRyYXcud2lkdGggLSBfU0MuZHJhdy5mb250U2l6ZSAqIDEuNSwgX1NDLmRyYXcueSwgX1NDLmRyYXcuZm9udFNpemUsIF9TQy5kcmF3LmNlbGxTaXplKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9TQy5fY2hhbmdlS2V5LCBfU0MuX2NoYW5nZUtleVZhciwgX1NDLl9jaGFuZ2VLZXlNZW51ID0gdHJ1ZSwgbmlsLCB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBDdXJzb3JJc1VuZGVyKF9TQy5kcmF3LngsIF9TQy5kcmF3LnksIF9TQy5kcmF3LndpZHRoLCBfU0MuZHJhdy5jZWxsU2l6ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfU0MuZHJhdy5vZmZzZXQgPSBWZWN0b3IoR2V0Q3Vyc29yUG9zKCkpIC0gX1NDLmRyYXcKICAgICAgICAgICAgICAgICAgICAgICAgX1NDLmRyYXcubW92ZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBfU0MudXNlVFMgYW5kIEN1cnNvcklzVW5kZXIoX1NDLmRyYXcueCwgX1NDLmRyYXcueSArIF9TQy5kcmF3LmNlbGxTaXplLCBfU0MuZHJhdy53aWR0aCwgX1NDLmRyYXcuY2VsbFNpemUpIHRoZW4gX1NDLm1lbnVJbmRleCA9IDAgX19TQ19fUmVzZXRTdWJJbmRleGVzKCkgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHkxID0gX1NDLmRyYXcueSArIF9TQy5kcmF3LmNlbGxTaXplICsgKF9TQy5kcmF3LmNlbGxTaXplICogX1NDLm1hc3RlclkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpbmRleCwgXyBpbiBpcGFpcnMoX1NDLmluc3RhbmNlcykgZG8KCQkJCQkJCWlmIEN1cnNvcklzVW5kZXIoX1NDLmRyYXcueCwgeTEsIF9TQy5kcmF3LndpZHRoLCBfU0MuZHJhdy5jZWxsU2l6ZSkgdGhlbiBfU0MubWVudUluZGV4ID0gaW5kZXggX19TQ19fUmVzZXRTdWJJbmRleGVzKCkgZW5kCgkJCQkJCQl5MSA9IHkxICsgX1NDLmRyYXcuY2VsbFNpemUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgQ3Vyc29ySXNVbmRlcihfU0MucERyYXcueCwgX1NDLnBEcmF3LnksIF9TQy5wRHJhdy53aWR0aCwgX1NDLnBEcmF3LmhlaWdodCkgdGhlbgogICAgICAgICAgICAgICAgICAgIF9TQy5wRHJhdy5vZmZzZXQgPSBWZWN0b3IoR2V0Q3Vyc29yUG9zKCkpIC0gX1NDLnBEcmF3CiAgICAgICAgICAgICAgICAgICAgX1NDLnBEcmF3Lm1vdmUgPSB0cnVlCiAgICAgICAgICAgICAgICBlbHNlaWYgX1NDLm1lbnVJbmRleCA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBUU19DbGlja01lbnUoX1NDLl9JZHJhdy54LCBfU0MuZHJhdy55ICsgX1NDLmRyYXcuY2VsbFNpemUpCiAgICAgICAgICAgICAgICBlbHNlaWYgX1NDLm1lbnVJbmRleCA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIENoZWNrT25XbmRNc2coaW5zdGFuY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEN1cnNvcklzVW5kZXIoaW5zdGFuY2UuX3gsIF9TQy5kcmF3LnksIF9TQy5kcmF3LndpZHRoLCBpbnN0YW5jZS5faGVpZ2h0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTpPblduZE1zZygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBpbnN0YW5jZS5fc3ViTWVudUluZGV4ID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGVja09uV25kTXNnKGluc3RhbmNlLl9zdWJJbnN0YW5jZXNbaW5zdGFuY2UuX3N1Yk1lbnVJbmRleF0pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIENoZWNrT25XbmRNc2coX1NDLmluc3RhbmNlc1tfU0MubWVudUluZGV4XSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgbXNnID09IFdNX0xCVVRUT05VUCB0aGVuCiAgICAgICAgICAgICAgICBpZiBfU0MuZHJhdy5tb3ZlIG9yIF9TQy5wRHJhdy5tb3ZlIHRoZW4KICAgICAgICAgICAgICAgICAgICBfU0MuZHJhdy5tb3ZlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBfU0MucERyYXcubW92ZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgX1NDLm1hc3RlckluZGV4ID09IDEgdGhlbiBfX1NDX19zYXZlTWVudSgpIGVuZAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZWxzZWlmIF9TQy5fc2xpY2VJbnN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgX1NDLl9zbGljZUluc3RhbmNlOnNhdmUoKQogICAgICAgICAgICAgICAgICAgIF9TQy5fc2xpY2VJbnN0YW5jZS5fc2xpY2UgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIF9TQy5fc2xpY2VJbnN0YW5jZSA9IGZhbHNlCgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZWxzZWlmIF9TQy5fbGlzdEluc3RhbmNlIHRoZW4KICAgICAgICAgICAgICAgICAgICBfU0MuX2xpc3RJbnN0YW5jZTpzYXZlKCkKICAgICAgICAgICAgICAgICAgICBfU0MuX2xpc3RJbnN0YW5jZS5fbGlzdCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgX1NDLl9saXN0SW5zdGFuY2UgPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIENoZWNrT25XbmRNc2coaW5zdGFuY2UpCgogICAgICAgICAgICAgICAgICAgIGZvciBfLCBwYXJhbSBpbiBpcGFpcnMoaW5zdGFuY2UuX3BhcmFtKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJhbS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05LRVlUT0dHTEUgYW5kIGtleSA9PSBwYXJhbS5rZXkgYW5kIG1zZyA9PSBLRVlfRE9XTiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZVtwYXJhbS52YXJdID0gbm90IGluc3RhbmNlW3BhcmFtLnZhcl0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHBhcmFtLnBUeXBlID09IFNDUklQVF9QQVJBTV9PTktFWURPV04gYW5kIGtleSA9PSBwYXJhbS5rZXkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VbcGFyYW0udmFyXSA9IChtc2cgPT0gS0VZX0RPV04pCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGZvciBfLCBzdWJJbnN0YW5jZSBpbiBpcGFpcnMoaW5zdGFuY2UuX3N1Ykluc3RhbmNlcykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tPblduZE1zZyhzdWJJbnN0YW5jZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZm9yIF8sIGluc3RhbmNlIGluIGlwYWlycyhfU0MuaW5zdGFuY2VzKSBkbwogICAgICAgICAgICAgICAgICAgIENoZWNrT25XbmRNc2coaW5zdGFuY2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIEFkZE1zZ0NhbGxiYWNrKF9fU0NfX09uV25kTXNnKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2NyaXB0Q29uZmlnOl9faW5pdChoZWFkZXIsIG5hbWUsIHBhcmVudCkKCWFzc2VydCgodHlwZShoZWFkZXIpID09ICJzdHJpbmciKSBhbmQgKHR5cGUobmFtZSkgPT0gInN0cmluZyIpLCAic2NyaXB0Q29uZmlnOiBleHBlY3RlZCA8c3RyaW5nPiwgPHN0cmluZz4pIikKCWlmIG5vdCBwYXJlbnQgdGhlbgoJCV9fU0NfX2luaXQobmFtZSkKCQlfX1NDX19PbkxvYWQoKQoJZWxzZQoJCXNlbGYuX3BhcmVudCA9IHBhcmVudAoJZW5kCglzZWxmLmhlYWRlciA9IGhlYWRlcgoJc2VsZi5uYW1lID0gbmFtZQoJc2VsZi5fdHNJbnN0YW5jZXMgPSB7fQoJc2VsZi5fcGFyYW0gPSB7fQoJc2VsZi5fcGVybWFTaG93ID0ge30KCXNlbGYuX3N1Ykluc3RhbmNlcyA9IHt9CglzZWxmLl9zdWJNZW51SW5kZXggPSAwCglzZWxmLl94ID0gcGFyZW50IGFuZCAocGFyZW50Ll94ICsgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIqMikgb3IgX1NDLl9JZHJhdy54CglzZWxmLl95ID0gMAoJc2VsZi5faGVpZ2h0ID0gMAoJc2VsZi5fc2xpY2UgPSBmYWxzZQoJdGFibGUuaW5zZXJ0KHBhcmVudCBhbmQgcGFyZW50Ll9zdWJJbnN0YW5jZXMgb3IgX1NDLmluc3RhbmNlcywgc2VsZikKZW5kCgpmdW5jdGlvbiBzY3JpcHRDb25maWc6YWRkU3ViTWVudShoZWFkZXIsIG5hbWUpCglhc3NlcnQoKHR5cGUoaGVhZGVyKSA9PSAic3RyaW5nIikgYW5kICh0eXBlKG5hbWUpID09ICJzdHJpbmciKSwgInNjcmlwdENvbmZpZzogZXhwZWN0ZWQgPHN0cmluZz4sIDxzdHJpbmc+KSIpCglsb2NhbCBzdWJOYW1lID0gc2VsZi5uYW1lIC4uICJfIiAuLiBuYW1lCglsb2NhbCBzdWIgPSBzY3JpcHRDb25maWcoaGVhZGVyLCBzdWJOYW1lLCBzZWxmKQoJc2VsZltuYW1lXSA9IHN1YgplbmQKCmZ1bmN0aW9uIHNjcmlwdENvbmZpZzphZGRQYXJhbShwVmFyLCBwVGV4dCwgcFR5cGUsIGRlZmF1bHRWYWx1ZSwgYSwgYiwgYykKCWlmIF9HLlNWX1BFUk1BU0hPVyB+PSBuaWwgYW5kIHNlbGYubmFtZSB+PSBuaWwgYW5kICgKCSAgIChzZWxmLm5hbWUgPT0gInNpZGFzYWNzZXR1cF9zaWRhc2FjYXV0b2NhcnJ5c3ViIiBhbmQgcFZhciA9PSAiQWN0aXZlIiBhbmQgcFRleHQgPT0gIkF1dG8gQ2FycnkiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUM6UiBBdXRvQ2FycnkKCW9yIChzZWxmLm5hbWUgPT0gInNpZGFzYWNzZXR1cF9zaWRhc2FjbWl4ZWRtb2Rlc3ViIiBhbmQgcFZhciA9PSAiQWN0aXZlIiBhbmQgcFRleHQgPT0gIk1peGVkIE1vZGUiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUM6UiBNaXhlZE1vZGUKCW9yIChzZWxmLm5hbWUgPT0gInNpZGFzYWNzZXR1cF9zaWRhc2FjbGFzdGhpdHN1YiIgYW5kIHBWYXIgPT0gIkFjdGl2ZSIgYW5kIHBUZXh0ID09ICJMYXN0IEhpdCIgYW5kIHBUeXBlID09IDIpIC0tIFNBQzpSIExhc3RIaXQKCW9yIChzZWxmLm5hbWUgPT0gInNpZGFzYWNzZXR1cF9zaWRhc2FjbGFuZWNsZWFyc3ViIiBhbmQgcFZhciA9PSAiQWN0aXZlIiBhbmQgcFRleHQgPT0gIkxhbmUgQ2xlYXIiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUM6UiBMYW5lQ2xlYXIKCW9yIChzdHJpbmcuZmluZChzZWxmLm5hbWUsICJzaWRhc2FjdmF5bmUiKSkgLS0gU0FDIFZheW5lIFBsdWdpbgoJb3IgKHNlbGYubmFtZSA9PSAiTU1BMjAxMyIgYW5kIHBWYXIgPT0gInNjcmlwdEFjdGl2ZSIgYW5kIHBUZXh0ID09ICJPcmJ3YWxrIE9uSG9sZCIgYW5kIHBUeXBlID09IDIpIC0tIE1NQSBBdXRvQ2FycnkKCW9yIChzZWxmLm5hbWUgPT0gIk1NQTIwMTMiIGFuZCBwVmFyID09ICJsYXN0SGl0dGluZyIgYW5kIHBUZXh0ID09ICJMYXN0SGl0IE9uSG9sZCIgYW5kIHBUeXBlID09IDIpIC0tIE1NQSBMYXN0SGl0CglvciAoc2VsZi5uYW1lID09ICJNTUEyMDEzIiBhbmQgcFZhciA9PSAibGFuZUNsZWFyIiBhbmQgcFRleHQgPT0gIkxhbmVDbGVhciBPbkhvbGQiIGFuZCBwVHlwZSA9PSAyKSAtLSBNTUEgTGFuZUNsZWFyCglvciAoc2VsZi5uYW1lID09ICJNTUEyMDEzIiBhbmQgcFZhciA9PSAiaHlicmlkTW9kZSIgYW5kIHBUZXh0ID09ICJIeWJyaWRNb2RlIE9uSG9sZCIgYW5kIHBUeXBlID09IDIpIC0tIE1NQSBBdXRvQ2FycnkKCW9yIChzZWxmLm5hbWUgPT0gInNpZGFzYWNtYWluIiBhbmQgcFZhciA9PSAiQXV0b0NhcnJ5IiBhbmQgcFRleHQgPT0gIkF1dG8gQ2FycnkiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUMgUmV2YW1wZWQgQXV0b0NhcnJ5CglvciAoc2VsZi5uYW1lID09ICJzaWRhc2FjbWFpbiIgYW5kIHBWYXIgPT0gIkxhc3RIaXQiIGFuZCBwVGV4dCA9PSAiTGFzdCBIaXQiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUMgUmV2YW1wZWQgTGFzdEhpdAoJb3IgKHNlbGYubmFtZSA9PSAic2lkYXNhY21haW4iIGFuZCBwVmFyID09ICJMYW5lQ2xlYXIiIGFuZCBwVGV4dCA9PSAiTGFuZSBDbGVhciIgYW5kIHBUeXBlID09IDIpIC0tIFNBQyBSZXZhbXBlZCBMYW5lQ2xlYXIKCW9yIChzZWxmLm5hbWUgPT0gInNpZGFzYWNtYWluIiBhbmQgcFZhciA9PSAiTWl4ZWRNb2RlIiBhbmQgcFRleHQgPT0gIk1peGVkIE1vZGUiIGFuZCBwVHlwZSA9PSAyKSAtLSBTQUMgUmV2YW1wZWQgTWl4ZWRNb2RlCglvciAoc2VsZi5uYW1lID09ICJTaGFkb3dWYXluZV9zb3ciIGFuZCBwVmFyID09ICJNb2RlMSIgYW5kIHBUZXh0ID09ICJNaXhlZCBNb2RlISIgYW5kIHBUeXBlID09IDIpIC0tIFNPVyBNaXhlZE1vZGUKCW9yIChzZWxmLm5hbWUgPT0gIlNoYWRvd1ZheW5lX3NvdyIgYW5kIHBWYXIgPT0gIk1vZGUzIiBhbmQgcFRleHQgPT0gIkxhc3QgaGl0ISIgYW5kIHBUeXBlID09IDIpIC0tIFNPVyBNaXhlZE1vZGUKCW9yIChzZWxmLm5hbWUgPT0gIlNoYWRvd1ZheW5lX3NvdyIgYW5kIHBWYXIgPT0gIk1vZGUyIiBhbmQgcFRleHQgPT0gIkxhbmVjbGVhciEiIGFuZCBwVHlwZSA9PSAyKSAtLSBTT1cgTWl4ZWRNb2RlCglvciAoc2VsZi5uYW1lID09ICJTaGFkb3dWYXluZV9zb3ciIGFuZCBwVmFyID09ICJNb2RlMCIgYW5kIHBUZXh0ID09ICJDYXJyeSBtZSEiIGFuZCBwVHlwZSA9PSAyKSAtLSBTT1cgTWl4ZWRNb2RlCgkpIHRoZW4KLS1+IAkJaWYgKHNlbGYubmFtZSA9PSAiTU1BMjAxMyIpIHRoZW4KLS1+IAkJCXBWYXIgPSAiQkxBTktTUEFDRSIKLS1+IAkJZW5kCgkJcFRleHQgPSAiU2hhZG93VmF5bmVIaWphY2tlZCIKCQlwVHlwZSA9IFNDUklQVF9QQVJBTV9JTkZPCgkJbG9jYWwgbmV3UGFyYW0gPSB7IHZhciA9IHBWYXIsIHRleHQgPSBwVGV4dCwgcFR5cGUgPSBwVHlwZSB9CgkJc2VsZltwVmFyXSA9IGRlZmF1bHRWYWx1ZQoJCXRhYmxlLmluc2VydChzZWxmLl9wYXJhbSwgbmV3UGFyYW0pCgkJX19TQ19fc2F2ZU1hc3RlcigpCgkJc2VsZjpsb2FkKCkKCWVsc2UKLS1+IAkJaWYgc3RyaW5nLmZpbmQocFZhciwiTW9kZSIpIGFuZCBzZWxmLm5hbWUgPT0gIlNoYWRvd1ZheW5lX3NvdyIgdGhlbgotLX4gCQkJcHJpbnQoKHNlbGYubmFtZSkuLiIgIi4ucFZhci4uIiAiLi5wVGV4dC4uIiAiLi5wVHlwZSkKLS1+IAkJZW5kCgkJYXNzZXJ0KHR5cGUocFZhcikgPT0gInN0cmluZyIgYW5kIHR5cGUocFRleHQpID09ICJzdHJpbmciIGFuZCB0eXBlKHBUeXBlKSA9PSAibnVtYmVyIiwgImFkZFBhcmFtOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPHN0cmluZz4sIDxzdHJpbmc+LCA8cFR5cGU+IGV4cGVjdGVkKSIpCgkJYXNzZXJ0KHN0cmluZy5maW5kKHBWYXIsICJbXiVhJWRdIikgPT0gbmlsLCAiYWRkUGFyYW06IHBWYXIgc2hvdWxkIGNvbnRhaW4gb25seSBjaGFyIGFuZCBudW1iZXIiKQoJCS0tYXNzZXJ0KHNlbGZbcFZhcl0gPT0gbmlsLCAiYWRkUGFyYW06IHBWYXIgc2hvdWxkIGJlIHVuaXF1ZSwgYWxyZWFkeSBleGlzdGluZyAiIC4uIHBWYXIpCgkJbG9jYWwgbmV3UGFyYW0gPSB7IHZhciA9IHBWYXIsIHRleHQgPSBwVGV4dCwgcFR5cGUgPSBwVHlwZSB9CgkJaWYgcFR5cGUgPT0gU0NSSVBUX1BBUkFNX09OT0ZGIHRoZW4KCQkJYXNzZXJ0KHR5cGUoZGVmYXVsdFZhbHVlKSA9PSAiYm9vbGVhbiIsICJhZGRQYXJhbTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDxib29sZWFuPiBleHBlY3RlZCkiKQoJCWVsc2VpZiBwVHlwZSA9PSBTQ1JJUFRfUEFSQU1fQ09MT1IgdGhlbgoJCQlhc3NlcnQodHlwZShkZWZhdWx0VmFsdWUpID09ICJ0YWJsZSIsICJhZGRQYXJhbTogd3JvbmcgYXJndW1lbnQgdHlwZXMgKDx0YWJsZT4gZXhwZWN0ZWQpIikKCQkJYXNzZXJ0KCNkZWZhdWx0VmFsdWUgPT0gNCwgImFkZFBhcmFtOiB3cm9uZyBhcmd1bWVudCAoe2EscixnLGJ9IGV4cGVjdGVkKSIpCgkJZWxzZWlmIHBUeXBlID09IFNDUklQVF9QQVJBTV9PTktFWURPV04gb3IgcFR5cGUgPT0gU0NSSVBUX1BBUkFNX09OS0VZVE9HR0xFIHRoZW4KCQkgICBhc3NlcnQodHlwZShkZWZhdWx0VmFsdWUpID09ICJib29sZWFuIiBhbmQgdHlwZShhKSA9PSAibnVtYmVyIiwgImFkZFBhcmFtOiB3cm9uZyBhcmd1bWVudCB0eXBlcyAoPGJvb2xlYW4+IDxudW1iZXI+IGV4cGVjdGVkKSIpCgkJCW5ld1BhcmFtLmtleSA9IGEKCQllbHNlaWYgcFR5cGUgPT0gU0NSSVBUX1BBUkFNX1NMSUNFIHRoZW4KCQkJYXNzZXJ0KHR5cGUoZGVmYXVsdFZhbHVlKSA9PSAibnVtYmVyIiBhbmQgdHlwZShhKSA9PSAibnVtYmVyIiBhbmQgdHlwZShiKSA9PSAibnVtYmVyIiBhbmQgKHR5cGUoYykgPT0gIm51bWJlciIgb3IgYyA9PSBuaWwpLCAiYWRkUGFyYW06IHdyb25nIGFyZ3VtZW50IHR5cGVzIChwVmFyLCBwVGV4dCwgcFR5cGUsIGRlZmF1bHRWYWx1ZSwgdmFsTWluLCB2YWxNYXgsIGRlY2ltYWwpIGV4cGVjdGVkIikKCQkJbmV3UGFyYW0ubWluID0gYQoJCQluZXdQYXJhbS5tYXggPSBiCgkJCW5ld1BhcmFtLmlkYyA9IGMgb3IgMAoJCQluZXdQYXJhbS5jdXJzb3IgPSAwCgkJZWxzZWlmIHBUeXBlID09IFNDUklQVF9QQVJBTV9MSVNUIHRoZW4KCQkJYXNzZXJ0KHR5cGUoZGVmYXVsdFZhbHVlKSA9PSAibnVtYmVyIiBhbmQgdHlwZShhKSA9PSAidGFibGUiLCAiYWRkUGFyYW06IHdyb25nIGFyZ3VtZW50IHR5cGVzIChwVmFyLCBwVGV4dCwgcFR5cGUsIGRlZmF1bHRWYWx1ZSwgbGlzdFRhYmxlKSBleHBlY3RlZCIpCgkJCW5ld1BhcmFtLmxpc3RUYWJsZSA9IGEKCQkJbmV3UGFyYW0ubWluID0gMQoJCQluZXdQYXJhbS5tYXggPSAjYQoJCQluZXdQYXJhbS5jdXJzb3IgPSAwCgkJZW5kCgkJc2VsZltwVmFyXSA9IGRlZmF1bHRWYWx1ZQoJCXRhYmxlLmluc2VydChzZWxmLl9wYXJhbSwgbmV3UGFyYW0pCgkJX19TQ19fc2F2ZU1hc3RlcigpCgkJc2VsZjpsb2FkKCkKCWVuZAplbmQKCmZ1bmN0aW9uIHNjcmlwdENvbmZpZzphZGRUUyh0c0luc3RhbmNlKQogICAgYXNzZXJ0KHR5cGUodHNJbnN0YW5jZS5tb2RlKSA9PSAibnVtYmVyIiwgImFkZFRTOiBleHBlY3RlZCBUYXJnZXRTZWxlY3RvcikiKQogICAgX1NDLnVzZVRTID0gdHJ1ZQogICAgdGFibGUuaW5zZXJ0KHNlbGYuX3RzSW5zdGFuY2VzLCB0c0luc3RhbmNlKQogICAgX19TQ19fc2F2ZU1hc3RlcigpCiAgICBzZWxmOmxvYWQoKQplbmQKCmZ1bmN0aW9uIHNjcmlwdENvbmZpZzpwZXJtYVNob3cocFZhcikKCWFzc2VydCh0eXBlKHBWYXIpID09ICJzdHJpbmciIGFuZCBzZWxmW3BWYXJdIH49IG5pbCwgInBlcm1hU2hvdzogZXhpc3RpbmcgcFZhciBleHBlY3RlZCkiKQoJZm9yIGluZGV4LCBwYXJhbSBpbiBpcGFpcnMoc2VsZi5fcGFyYW0pIGRvCgkJaWYgcGFyYW0udmFyID09IHBWYXIgdGhlbgoJCQlpZiBub3QgKHBhcmFtLnRleHQgPT0gIlNoYWRvd1ZheW5lSGlqYWNrZWQiKSBhbmQgbm90IChzdHJpbmcuZmluZChwYXJhbS50ZXh0LCAiQXV0byBDYXJyeTogUmVib3JuIikpIHRoZW4KCQkJCXRhYmxlLmluc2VydChzZWxmLl9wZXJtYVNob3csIGluZGV4KQoJCQllbmQKCQllbmQKCWVuZAoJX19TQ19fc2F2ZU1hc3RlcigpCmVuZAoKZnVuY3Rpb24gc2NyaXB0Q29uZmlnOl90eHRLZXkoa2V5KQoJcmV0dXJuIChrZXkgPiAzMiBhbmQga2V5IDwgOTYgYW5kICIgIiAuLiBzdHJpbmcuY2hhcihrZXkpIC4uICIgIiBvciAiKCIgLi4gdG9zdHJpbmcoa2V5KSAuLiAiKSIpCmVuZAoKZnVuY3Rpb24gc2NyaXB0Q29uZmlnOk9uRHJhdygpCiAgICBzZWxmLl94ID0gc2VsZi5fcGFyZW50IGFuZCAoc2VsZi5fcGFyZW50Ll94ICsgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIqMikgb3IgX1NDLl9JZHJhdy54CiAgICBpZiBzZWxmLl9zbGljZSBhbmQgX1NDLl9zbGljZUluc3RhbmNlIHRoZW4KICAgICAgICBsb2NhbCBjdXJzb3JYID0gbWF0aC5taW4obWF0aC5tYXgoMCwgR2V0Q3Vyc29yUG9zKCkueCAtIHNlbGYuX3ggLSBfU0MuZHJhdy5yb3czKSwgX1NDLmRyYXcud2lkdGggLSBfU0MuZHJhdy5yb3czKQogICAgICAgIHNlbGZbc2VsZi5fcGFyYW1bc2VsZi5fc2xpY2VdLnZhcl0gPSBtYXRoLnJvdW5kKHNlbGYuX3BhcmFtW3NlbGYuX3NsaWNlXS5taW4gKyBjdXJzb3JYIC8gKF9TQy5kcmF3LndpZHRoIC0gX1NDLmRyYXcucm93MykgKiAoc2VsZi5fcGFyYW1bc2VsZi5fc2xpY2VdLm1heCAtIHNlbGYuX3BhcmFtW3NlbGYuX3NsaWNlXS5taW4pLCBzZWxmLl9wYXJhbVtzZWxmLl9zbGljZV0uaWRjKQogICAgZW5kCiAgICBzZWxmLl95ID0gX1NDLmRyYXcueQogICAgRHJhd0xpbmUoc2VsZi5feCArIF9TQy5kcmF3LndpZHRoIC8gMiwgc2VsZi5feSwgc2VsZi5feCArIF9TQy5kcmF3LndpZHRoIC8gMiwgc2VsZi5feSArIHNlbGYuX2hlaWdodCwgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIgKiAyLCAxNDE0ODEyNzU2KSAtLSBncmV5CiAgICBsb2NhbCBtZW51VGV4dCA9IF9TQy5fY2hhbmdlS2V5IGFuZCBfU0MuX2NoYW5nZUtleVZhciBhbmQgX1NDLl9jaGFuZ2VLZXlJbnN0YW5jZSBhbmQgX1NDLl9jaGFuZ2VLZXlJbnN0YW5jZS5uYW1lID09IHNlbGYubmFtZSBhbmQgInByZXNzIGtleSBmb3IgIiAuLiBzZWxmLl9wYXJhbVtfU0MuX2NoYW5nZUtleVZhcl0udmFyIG9yIHNlbGYuaGVhZGVyCiAgICBEcmF3VGV4dChtZW51VGV4dCwgX1NDLmRyYXcuZm9udFNpemUsIHNlbGYuX3gsIHNlbGYuX3ksIDQyOTQ5NjcyODApIC0tIGl2b3J5CiAgICBzZWxmLl95ID0gc2VsZi5feSArIF9TQy5kcmF3LmNlbGxTaXplCiAgICBmb3IgaW5kZXgsIF8gaW4gaXBhaXJzKHNlbGYuX3N1Ykluc3RhbmNlcykgZG8KICAgICAgICBzZWxmOl9EcmF3U3ViSW5zdGFuY2UoaW5kZXgpCiAgICAgICAgaWYgc2VsZi5fc3ViTWVudUluZGV4ID09IGluZGV4IHRoZW4gXzpPbkRyYXcoKSBlbmQKICAgIGVuZAoKICAgIGlmICNzZWxmLl90c0luc3RhbmNlcyA+IDAgdGhlbgogICAgICAgIC0tX1NDLl9JZHJhdy55ID0gVFNfX0RyYXdNZW51KF9TQy5fSWRyYXcueCwgX1NDLl9JZHJhdy55KQogICAgICAgIGZvciBfLCB0c0luc3RhbmNlIGluIGlwYWlycyhzZWxmLl90c0luc3RhbmNlcykgZG8KICAgICAgICAgICAgc2VsZi5feSA9IHRzSW5zdGFuY2U6RHJhd01lbnUoc2VsZi5feCwgc2VsZi5feSkKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIGluZGV4LCBfIGluIGlwYWlycyhzZWxmLl9wYXJhbSkgZG8KICAgICAgICBzZWxmOl9EcmF3UGFyYW0oaW5kZXgpCiAgICBlbmQKICAgIHNlbGYuX2hlaWdodCA9IHNlbGYuX3kgLSBfU0MuZHJhdy55CiAgICBpZiBzZWxmLl9saXN0IGFuZCBfU0MuX2xpc3RJbnN0YW5jZSBhbmQgc2VsZi5fbGlzdFkgdGhlbgogICAgICAgIGxvY2FsIGN1cnNvclkgPSBtYXRoLm1pbihHZXRDdXJzb3JQb3MoKS55IC0gc2VsZi5fbGlzdFksIF9TQy5kcmF3LmNlbGxTaXplICogKHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLm1heCkpCiAgICAgICAgaWYgY3Vyc29yWSA+PSAwIHRoZW4KICAgICAgICAgICAgc2VsZltzZWxmLl9wYXJhbVtzZWxmLl9saXN0XS52YXJdID0gbWF0aC5yb3VuZChzZWxmLl9wYXJhbVtzZWxmLl9saXN0XS5taW4gKyBjdXJzb3JZIC8gKF9TQy5kcmF3LmNlbGxTaXplICogKHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLm1heCkpICogKHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLm1heCAtIHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLm1pbikpCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgbWF4V2lkdGggPSAwCiAgICAgICAgZm9yIGksIGVsIGluIHBhaXJzKHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLmxpc3RUYWJsZSkgZG8KICAgICAgICAgICAgbWF4V2lkdGggPSBtYXRoLm1heChtYXhXaWR0aCwgR2V0VGV4dEFyZWEoZWwsIF9TQy5kcmF3LmZvbnRTaXplKS54KQogICAgICAgIGVuZAogICAgICAgIC0tIEJHOgogICAgICAgIERyYXdSZWN0YW5nbGUoc2VsZi5feCArIF9TQy5kcmF3LnJvdzMsIHNlbGYuX2xpc3RZLCBtYXhXaWR0aCwgc2VsZi5fcGFyYW1bc2VsZi5fbGlzdF0ubWF4ICogX1NDLmRyYXcuY2VsbFNpemUsIEFSR0IoMjMwLDUwLDUwLDUwKSkKICAgICAgICAtLSBTRUxFQ1RFRDoKICAgICAgICBEcmF3UmVjdGFuZ2xlKHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czLCBzZWxmLl9saXN0WSArIChzZWxmW3NlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLnZhcl0tMSkgKiBfU0MuZHJhdy5jZWxsU2l6ZSwgbWF4V2lkdGgsIF9TQy5kcmF3LmNlbGxTaXplLCBfU0MuY29sb3IuZ3JlZW4pCiAgICAgICAgZm9yIGksIGVsIGluIHBhaXJzKHNlbGYuX3BhcmFtW3NlbGYuX2xpc3RdLmxpc3RUYWJsZSkgZG8KICAgICAgICAgICAgRHJhd1RleHQoZWwsIF9TQy5kcmF3LmZvbnRTaXplLCBzZWxmLl94ICsgX1NDLmRyYXcucm93Mywgc2VsZi5fbGlzdFkgKyAoaS0xKSAqIF9TQy5kcmF3LmNlbGxTaXplLCA0Mjk0OTY3MjgwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2NyaXB0Q29uZmlnOl9EcmF3U3ViSW5zdGFuY2UoaW5kZXgpCiAgICBsb2NhbCBwVmFyID0gc2VsZi5fc3ViSW5zdGFuY2VzW2luZGV4XS5uYW1lCiAgICBsb2NhbCBzZWxlY3RlZCA9IHNlbGYuX3N1Yk1lbnVJbmRleCA9PSBpbmRleAogICAgRHJhd0xpbmUoc2VsZi5feCAtIF9TQy5kcmF3LmJvcmRlciwgc2VsZi5feSArIF9TQy5kcmF3Lm1pZFNpemUsIHNlbGYuX3ggKyBfU0MuZHJhdy53aWR0aCArIF9TQy5kcmF3LmJvcmRlciwgc2VsZi5feSArIF9TQy5kcmF3Lm1pZFNpemUsIF9TQy5kcmF3LmNlbGxTaXplLCAoc2VsZWN0ZWQgYW5kIF9TQy5jb2xvci5yZWQgb3IgX1NDLmNvbG9yLmxncmV5KSkKICAgIERyYXdUZXh0KHNlbGYuX3N1Ykluc3RhbmNlc1tpbmRleF0uaGVhZGVyLCBfU0MuZHJhdy5mb250U2l6ZSwgc2VsZi5feCwgc2VsZi5feSwgKHNlbGVjdGVkIGFuZCBfU0MuY29sb3IuaXZvcnkgb3IgX1NDLmNvbG9yLmdyZXkpKQogICAgRHJhd1RleHQoIiAgICAgICAgPj4iLCBfU0MuZHJhdy5mb250U2l6ZSwgc2VsZi5feCArIF9TQy5kcmF3LnJvdzMgKyBfU0MuZHJhdy5ib3JkZXIsIHNlbGYuX3ksIChzZWxlY3RlZCBhbmQgX1NDLmNvbG9yLml2b3J5IG9yIF9TQy5jb2xvci5ncmV5KSkKICAgIC0tX1NDLl9JZHJhdy55ID0gX1NDLl9JZHJhdy55ICsgX1NDLmRyYXcuY2VsbFNpemUKICAgIHNlbGYuX3kgPSBzZWxmLl95ICsgX1NDLmRyYXcuY2VsbFNpemUKZW5kCgpmdW5jdGlvbiBzY3JpcHRDb25maWc6X0RyYXdQYXJhbSh2YXJJbmRleCkKICAgIGxvY2FsIHBWYXIgPSBzZWxmLl9wYXJhbVt2YXJJbmRleF0udmFyCglpZiAoc2VsZi5fcGFyYW1bdmFySW5kZXhdLnRleHQgPT0gIlNoYWRvd1ZheW5lSGlqYWNrZWQiKSBvciAoc3RyaW5nLmZpbmQoc2VsZi5fcGFyYW1bdmFySW5kZXhdLnRleHQsICJPbkhvbGQ6IikgYW5kIF9HLlNWX1BFUk1BU0hPVykgdGhlbgoJCURyYXdMaW5lKHNlbGYuX3ggLSBfU0MuZHJhdy5ib3JkZXIsIHNlbGYuX3kgKyBfU0MuZHJhdy5taWRTaXplLCBzZWxmLl94ICsgX1NDLmRyYXcucm93MyAtIF9TQy5kcmF3LmJvcmRlciwgc2VsZi5feSArIF9TQy5kcmF3Lm1pZFNpemUsIF9TQy5kcmF3LmNlbGxTaXplLCBfU0MuY29sb3IubGdyZXkpCgkJRHJhd1RleHQoIlNoYWRvd1ZheW5lIGZvdW5kLiBTZXQgdGhlIEtleXNldHRpbmdzIHRoZXJlISIsIF9TQy5kcmF3LmZvbnRTaXplLCBzZWxmLl94LCBzZWxmLl95LCBfU0MuY29sb3IuZ3JleSkKCQlzZWxmLl95ID0gc2VsZi5feSArIF9TQy5kcmF3LmNlbGxTaXplCgllbHNlCgkJRHJhd0xpbmUoc2VsZi5feCAtIF9TQy5kcmF3LmJvcmRlciwgc2VsZi5feSArIF9TQy5kcmF3Lm1pZFNpemUsIHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czIC0gX1NDLmRyYXcuYm9yZGVyLCBzZWxmLl95ICsgX1NDLmRyYXcubWlkU2l6ZSwgX1NDLmRyYXcuY2VsbFNpemUsIF9TQy5jb2xvci5sZ3JleSkKCQlEcmF3VGV4dChzZWxmLl9wYXJhbVt2YXJJbmRleF0udGV4dCwgX1NDLmRyYXcuZm9udFNpemUsIHNlbGYuX3gsIHNlbGYuX3ksIF9TQy5jb2xvci5ncmV5KQoJCWlmIHNlbGYuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fU0xJQ0UgdGhlbgoJCQlEcmF3VGV4dCh0b3N0cmluZyhzZWxmW3BWYXJdKSwgX1NDLmRyYXcuZm9udFNpemUsIHNlbGYuX3ggKyBfU0MuZHJhdy5yb3cyLCBzZWxmLl95LCBfU0MuY29sb3IuZ3JleSkKCQkJRHJhd0xpbmUoc2VsZi5feCArIF9TQy5kcmF3LnJvdzMsIHNlbGYuX3kgKyBfU0MuZHJhdy5taWRTaXplLCBzZWxmLl94ICsgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIsIHNlbGYuX3kgKyBfU0MuZHJhdy5taWRTaXplLCBfU0MuZHJhdy5jZWxsU2l6ZSwgX1NDLmNvbG9yLmxncmV5KQoJCQktLSBjdXJzb3IKCQkJc2VsZi5fcGFyYW1bdmFySW5kZXhdLmN1cnNvciA9IChzZWxmW3BWYXJdIC0gc2VsZi5fcGFyYW1bdmFySW5kZXhdLm1pbikgLyAoc2VsZi5fcGFyYW1bdmFySW5kZXhdLm1heCAtIHNlbGYuX3BhcmFtW3ZhckluZGV4XS5taW4pICogKF9TQy5kcmF3LndpZHRoIC0gX1NDLmRyYXcucm93MykKCQkJRHJhd0xpbmUoc2VsZi5feCArIF9TQy5kcmF3LnJvdzMgKyBzZWxmLl9wYXJhbVt2YXJJbmRleF0uY3Vyc29yIC0gX1NDLmRyYXcuYm9yZGVyLCBzZWxmLl95ICsgX1NDLmRyYXcubWlkU2l6ZSwgc2VsZi5feCArIF9TQy5kcmF3LnJvdzMgKyBzZWxmLl9wYXJhbVt2YXJJbmRleF0uY3Vyc29yICsgX1NDLmRyYXcuYm9yZGVyLCBzZWxmLl95ICsgX1NDLmRyYXcubWlkU2l6ZSwgX1NDLmRyYXcuY2VsbFNpemUsIDQyOTI1OTg2NDApCgkJZWxzZWlmIHNlbGYuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fTElTVCB0aGVuCgkJCWxvY2FsIHRleHQgPSB0b3N0cmluZyhzZWxmLl9wYXJhbVt2YXJJbmRleF0ubGlzdFRhYmxlW3NlbGZbcFZhcl1dKQoJCQlsb2NhbCBtYXhXaWR0aCA9IChfU0MuZHJhdy53aWR0aCAtIF9TQy5kcmF3LnJvdzMpICogMC44CgkJCWxvY2FsIHRleHRXaWR0aCA9IEdldFRleHRBcmVhKHRleHQsIF9TQy5kcmF3LmZvbnRTaXplKS54CgkJCWlmIHRleHRXaWR0aCA+IG1heFdpZHRoIHRoZW4KCQkJCXRleHQgPSB0ZXh0OnN1YigxLCBtYXRoLmZsb29yKHRleHQ6bGVuKCkgKiBtYXhXaWR0aCAvIHRleHRXaWR0aCkpIC4uICIuLiIKCQkJZW5kCgkJCURyYXdUZXh0KHRleHQsIF9TQy5kcmF3LmZvbnRTaXplLCBzZWxmLl94ICsgX1NDLmRyYXcucm93Mywgc2VsZi5feSwgX1NDLmNvbG9yLmdyZXkpCgkJCWlmIHNlbGYuX2xpc3QgYW5kIF9TQy5fbGlzdEluc3RhbmNlIHRoZW4gc2VsZi5fbGlzdFkgPSBzZWxmLl95ICsgX1NDLmRyYXcuY2VsbFNpemUgZW5kCgkJZWxzZWlmIHNlbGYuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fSU5GTyB0aGVuCgkJCURyYXdUZXh0KHRvc3RyaW5nKHNlbGZbcFZhcl0pLCBfU0MuZHJhdy5mb250U2l6ZSwgc2VsZi5feCArIF9TQy5kcmF3LnJvdzMgKyBfU0MuZHJhdy5ib3JkZXIsIHNlbGYuX3ksIF9TQy5jb2xvci5ncmV5KQoJCWVsc2VpZiBzZWxmLl9wYXJhbVt2YXJJbmRleF0ucFR5cGUgPT0gU0NSSVBUX1BBUkFNX0NPTE9SIHRoZW4KCQkJRHJhd1JlY3RhbmdsZShzZWxmLl94ICsgX1NDLmRyYXcucm93MyArIF9TQy5kcmF3LmJvcmRlciwgc2VsZi5feSwgODAsIF9TQy5kcmF3LmNlbGxTaXplLCBBUkdCKHNlbGZbcFZhcl1bMV0sIHNlbGZbcFZhcl1bMl0sIHNlbGZbcFZhcl1bM10sIHNlbGZbcFZhcl1bNF0pKQoJCWVsc2UKCQkJaWYgKHNlbGYuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05LRVlET1dOIG9yIHNlbGYuX3BhcmFtW3ZhckluZGV4XS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05LRVlUT0dHTEUpIHRoZW4KCQkJCURyYXdUZXh0KHNlbGY6X3R4dEtleShzZWxmLl9wYXJhbVt2YXJJbmRleF0ua2V5KSwgX1NDLmRyYXcuZm9udFNpemUsIHNlbGYuX3ggKyBfU0MuZHJhdy5yb3cyLCBzZWxmLl95LCBfU0MuY29sb3IuZ3JleSkKCQkJZW5kCgkJCURyYXdMaW5lKHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czLCBzZWxmLl95ICsgX1NDLmRyYXcubWlkU2l6ZSwgc2VsZi5feCArIF9TQy5kcmF3LndpZHRoICsgX1NDLmRyYXcuYm9yZGVyLCBzZWxmLl95ICsgX1NDLmRyYXcubWlkU2l6ZSwgX1NDLmRyYXcuY2VsbFNpemUsIChzZWxmW3BWYXJdIGFuZCBfU0MuY29sb3IuZ3JlZW4gb3IgX1NDLmNvbG9yLmxncmV5KSkKCQkJRHJhd1RleHQoKHNlbGZbcFZhcl0gYW5kICIgICAgICAgIE9OIiBvciAiICAgICAgICBPRkYiKSwgX1NDLmRyYXcuZm9udFNpemUsIHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czICsgX1NDLmRyYXcuYm9yZGVyLCBzZWxmLl95LCBfU0MuY29sb3IuZ3JleSkKCQllbmQKCQlzZWxmLl95ID0gc2VsZi5feSArIF9TQy5kcmF3LmNlbGxTaXplCgllbmQKZW5kCgpmdW5jdGlvbiBzY3JpcHRDb25maWc6bG9hZCgpCiAgICBsb2NhbCBmdW5jdGlvbiBzZW5zaXRpdmVNZXJnZShiYXNlLCB0KQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKHQpIGRvCiAgICAgICAgICAgIGlmIHR5cGUoYmFzZVtpXSkgPT0gdHlwZSh2KSB0aGVuCiAgICAgICAgICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbiBzZW5zaXRpdmVNZXJnZShiYXNlW2ldLCB2KQogICAgICAgICAgICAgICAgZWxzZSBiYXNlW2ldID0gdgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgY29uZmlnID0gX19TQ19fbG9hZChzZWxmLm5hbWUpCiAgICBmb3IgdmFyLCB2YWx1ZSBpbiBwYWlycyhjb25maWcpIGRvCiAgICAgICBpZiB0eXBlKHZhbHVlKSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgaWYgc2VsZlt2YXJdIHRoZW4gc2Vuc2l0aXZlTWVyZ2Uoc2VsZlt2YXJdLCB2YWx1ZSkgZW5kCiAgICAgICAgZWxzZSBzZWxmW3Zhcl0gPSB2YWx1ZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2NyaXB0Q29uZmlnOnNhdmUoKQogICAgbG9jYWwgY29udGVudCA9IHt9CiAgICBjb250ZW50Ll9wYXJhbSA9IGNvbnRlbnQuX3BhcmFtIG9yIHt9CiAgICBmb3IgdmFyLCBwYXJhbSBpbiBwYWlycyhzZWxmLl9wYXJhbSkgZG8KICAgICAgICBpZiBwYXJhbS5wVHlwZSB+PSBTQ1JJUFRfUEFSQU1fSU5GTyB0aGVuCiAgICAgICAgICAgIGNvbnRlbnRbcGFyYW0udmFyXSA9IHNlbGZbcGFyYW0udmFyXQogICAgICAgICAgICBpZiBwYXJhbS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05LRVlET1dOIG9yIHBhcmFtLnBUeXBlID09IFNDUklQVF9QQVJBTV9PTktFWVRPR0dMRSB0aGVuCiAgICAgICAgICAgICAgICBjb250ZW50Ll9wYXJhbVt2YXJdID0geyBrZXkgPSBwYXJhbS5rZXkgfQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgY29udGVudC5fdHNJbnN0YW5jZXMgPSBjb250ZW50Ll90c0luc3RhbmNlcyBvciB7fQogICAgZm9yIGksIHRzIGluIHBhaXJzKHNlbGYuX3RzSW5zdGFuY2VzKSBkbwogICAgICAgIGNvbnRlbnQuX3RzSW5zdGFuY2VzW2ldID0geyBtb2RlID0gdHMubW9kZSB9CiAgICBlbmQKICAgIC0tIGZvciBpLHBTaG93IGluIHBhaXJzKHNlbGYuX3Blcm1hU2hvdykgZG8KICAgIC0tIHRhYmxlLmluc2VydCAoY29udGVudCwgIl9wZXJtYVNob3cuIi4uaS4uIj0iLi50b3N0cmluZyhwU2hvdykpCiAgICAtLSBlbmQKICAgIF9fU0NfX3NhdmUoc2VsZi5uYW1lLCBjb250ZW50KQplbmQKCmZ1bmN0aW9uIHNjcmlwdENvbmZpZzpSZXNldFN1YkluZGV4ZXMoKQogICAgaWYgc2VsZi5fc3ViTWVudUluZGV4ID4gMCB0aGVuCiAgICAgICAgc2VsZi5fc3ViSW5zdGFuY2VzW3NlbGYuX3N1Yk1lbnVJbmRleF06UmVzZXRTdWJJbmRleGVzKCkKICAgICAgICBzZWxmLl9zdWJNZW51SW5kZXggPSAwCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBzY3JpcHRDb25maWc6T25XbmRNc2coKQogICAgbG9jYWwgeTEgPSBfU0MuZHJhdy55ICsgX1NDLmRyYXcuY2VsbFNpemUKICAgIGlmIEN1cnNvcklzVW5kZXIoc2VsZi5feCwgX1NDLmRyYXcueSwgX1NDLmRyYXcud2lkdGggKyBfU0MuZHJhdy5ib3JkZXIsIF9TQy5kcmF3LmNlbGxTaXplKSB0aGVuIHNlbGY6UmVzZXRTdWJJbmRleGVzKCkgZW5kCiAgICBmb3IgaSwgaW5zdGFuY2UgaW4gaXBhaXJzKHNlbGYuX3N1Ykluc3RhbmNlcykgZG8KICAgICAgICBpZiBDdXJzb3JJc1VuZGVyKHNlbGYuX3gsIHkxLCBfU0MuZHJhdy53aWR0aCArIF9TQy5kcmF3LmJvcmRlciwgX1NDLmRyYXcuY2VsbFNpemUpIHRoZW4gc2VsZi5fc3ViTWVudUluZGV4ID0gaSByZXR1cm4gZW5kCiAgICAgICAgeTEgPSB5MSArIF9TQy5kcmF3LmNlbGxTaXplCiAgICBlbmQKICAgIGlmICNzZWxmLl90c0luc3RhbmNlcyA+IDAgdGhlbgogICAgICAgIGZvciBfLCB0c0luc3RhbmNlIGluIGlwYWlycyhzZWxmLl90c0luc3RhbmNlcykgZG8KICAgICAgICAgICAgeTEgPSB0c0luc3RhbmNlOkNsaWNrTWVudShzZWxmLl94LCB5MSkKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIGksIHBhcmFtIGluIGlwYWlycyhzZWxmLl9wYXJhbSkgZG8KICAgICAgICBpZiBwYXJhbS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05LRVlET1dOIG9yIHBhcmFtLnBUeXBlID09IFNDUklQVF9QQVJBTV9PTktFWVRPR0dMRSB0aGVuCiAgICAgICAgICAgIGlmIEN1cnNvcklzVW5kZXIoc2VsZi5feCArIF9TQy5kcmF3LnJvdzIsIHkxLCBfU0MuZHJhdy5mb250U2l6ZSwgX1NDLmRyYXcuZm9udFNpemUpIHRoZW4KICAgICAgICAgICAgICAgIF9TQy5fY2hhbmdlS2V5LCBfU0MuX2NoYW5nZUtleVZhciwgX1NDLl9jaGFuZ2VLZXlNZW51ID0gdHJ1ZSwgaSwgdHJ1ZQogICAgICAgICAgICAgICAgX1NDLl9jaGFuZ2VLZXlJbnN0YW5jZSA9IHNlbGYKICAgICAgICAgICAgICAgIHNlbGY6UmVzZXRTdWJJbmRleGVzKCkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBwYXJhbS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fT05PRkYgb3IgcGFyYW0ucFR5cGUgPT0gU0NSSVBUX1BBUkFNX09OS0VZVE9HR0xFIHRoZW4KICAgICAgICAgICAgaWYgQ3Vyc29ySXNVbmRlcihzZWxmLl94ICsgX1NDLmRyYXcucm93MywgeTEsIF9TQy5kcmF3LndpZHRoIC0gX1NDLmRyYXcucm93MywgX1NDLmRyYXcuZm9udFNpemUpIHRoZW4KICAgICAgICAgICAgICAgIHNlbGZbcGFyYW0udmFyXSA9IG5vdCBzZWxmW3BhcmFtLnZhcl0KICAgICAgICAgICAgICAgIHNlbGY6c2F2ZSgpCiAgICAgICAgICAgICAgICBzZWxmOlJlc2V0U3ViSW5kZXhlcygpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgaWYgcGFyYW0ucFR5cGUgPT0gU0NSSVBUX1BBUkFNX0NPTE9SIHRoZW4KICAgICAgICAgICAgaWYgQ3Vyc29ySXNVbmRlcihzZWxmLl94ICsgX1NDLmRyYXcucm93MywgeTEsIF9TQy5kcmF3LndpZHRoIC0gX1NDLmRyYXcucm93MywgX1NDLmRyYXcuZm9udFNpemUpIHRoZW4KICAgICAgICAgICAgICAgIF9fQ1AobmlsLCBuaWwsIHNlbGZbcGFyYW0udmFyXVsxXSwgc2VsZltwYXJhbS52YXJdWzJdLCBzZWxmW3BhcmFtLnZhcl1bM10sIHNlbGZbcGFyYW0udmFyXVs0XSwgc2VsZltwYXJhbS52YXJdKQogICAgICAgICAgICAgICAgc2VsZjpzYXZlKCkKICAgICAgICAgICAgICAgIHNlbGY6UmVzZXRTdWJJbmRleGVzKCkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBwYXJhbS5wVHlwZSA9PSBTQ1JJUFRfUEFSQU1fU0xJQ0UgdGhlbgogICAgICAgICAgICBpZiBDdXJzb3JJc1VuZGVyKHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czIC0gX1NDLmRyYXcuYm9yZGVyLCB5MSwgV0lORE9XX1csIF9TQy5kcmF3LmZvbnRTaXplKSB0aGVuCiAgICAgICAgICAgICAgICBzZWxmLl9zbGljZSA9IGkKICAgICAgICAgICAgICAgIF9TQy5fc2xpY2VJbnN0YW5jZSA9IHNlbGYKICAgICAgICAgICAgICAgIHNlbGY6UmVzZXRTdWJJbmRleGVzKCkKCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgaWYgcGFyYW0ucFR5cGUgPT0gU0NSSVBUX1BBUkFNX0xJU1QgdGhlbgogICAgICAgICAgICBpZiBDdXJzb3JJc1VuZGVyKHNlbGYuX3ggKyBfU0MuZHJhdy5yb3czIC0gX1NDLmRyYXcuYm9yZGVyLCB5MSwgV0lORE9XX1csIF9TQy5kcmF3LmZvbnRTaXplKSB0aGVuCiAgICAgICAgICAgICAgICBzZWxmLl9saXN0ID0gaQogICAgICAgICAgICAgICAgX1NDLl9saXN0SW5zdGFuY2UgPSBzZWxmCiAgICAgICAgICAgICAgICBzZWxmOlJlc2V0U3ViSW5kZXhlcygpCgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHkxID0geTEgKyBfU0MuZHJhdy5jZWxsU2l6ZQogICAgZW5kCmVuZAplbmQKX0xvYWRDdXN0b21BbGxDbGFzcygp"	MyFile = io.open(SCRIPT_PATH.."/Common/ScriptConfigHook.lua", "w+")
		MyFile:seek("set")
		MyFile:write(_StringDecode(ScriptConfigHookString))
		MyFile:close()
		NeedScriptReload = true
		print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">ScriptConfigHook Updated/Installed. Reload with F9!</font>")
	end

	for scriptName, environment in pairs(_G.environment) do
		if scriptName == "Sida's Auto Carry - Reborn.lua" then
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">ScriptLoadOrder Error. Please do the following things:</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">1. Go into BoL and untick Sida's Auto Carry - Reborn.lua</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">2. Rightclick on ShadowVayne.lua -> Reload Scripts</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">3. Go Ingame and press 2x F9</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">4. Go into BoL and tick Sida's Auto Carry - Reborn.lua</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">5. Go Ingame and press 2x F9</font>")
			NeedScriptReload = true
		end
		if scriptName == "MarksmanMightyAssistant.lua" then
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">ScriptLoadOrder Error. Please do the following things:</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">1. Go into BoL and untick MarksmanMightyAssistant.lua</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">2. Rightclick on ShadowVayne.lua -> Reload Scripts</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">3. Go Ingame and press 2x F9</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">4. Go into BoL and tick MarksmanMightyAssistant.lua</font>")
			print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">5. Go Ingame and press 2x F9</font>")
			NeedScriptReload = true
		end
	end
end
_ScriptConfigHookCheck()
-- ScriptConfigHook End

function OnTick()
	if not ScriptOnLoadDone and not NeedScriptReload then
		_DownloadLib("honda7/BoL/raw/master/Common/VPrediction.lua", "VPrediction")
		_DownloadLib("honda7/BoL/raw/master/Common/SOW.lua", "SOW")
		if FileExist(SCRIPT_PATH.."/Common/SOW.lua") and FileExist(SCRIPT_PATH.."/Common/VPrediction.lua") and FileExist(SCRIPT_PATH.."/Common/SourceLib.lua") then
			if HadToDownload then _PrintScriptMsg("All Librarys are successfully downloaded") end
			require "VPrediction"
			require "SOW"
			VP = VPrediction(true)
			_LoadTables()
			_CheckSACMMASOW()
			_LoadMenu()
			AddTickCallback(_GetRunningModes)
			AddTickCallback(_CheckEnemyStunnAbleBeta)
			AddTickCallback(_GetUpdate)
			AddTickCallback(_NonTargetGapCloserAfterCast)
			AddTickCallback(_SetNewTarget)
			AddTickCallback(_UseBotRK)
			AddTickCallback(_ClickThreshLantern)
			AddTickCallback(_UpdateCustomPermaShow)
			AddCreateObjCallback(_ThreshLanternObj)
			autoLevelSetFunction(_AutoLevelSpell)
			autoLevelSetSequence({0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0})
			_ResetRunningModes()
			ScriptOnLoadDone = true
			if (SACLoaded or MMALoaded) and #GetEnemyHeroes() > 1 then
				_arrangePrioritys(#GetEnemyHeroes())
			end
		end
	end
end

function OnDraw()
	if ScriptOnLoadDone then
		if VayneMenu.draw.DrawNeededAutohits then
			for i, enemy in ipairs(GetEnemyHeroes()) do
				DrawText(tostring(_GetNeededAutoHits(enemy)),16,GetUnitHPBarPos(enemy).x,GetUnitHPBarPos(enemy).y,0xFF80FF00)
			end
		end

		if VayneMenu.draw.DrawERange then
			if VayneMenu.draw.DrawEColor == 1 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 710, 0x80FFFF)
			elseif VayneMenu.draw.DrawEColor == 2 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 710, 0x0080FF)
			elseif VayneMenu.draw.DrawEColor == 3 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 710, 0x5555FF)
			elseif VayneMenu.draw.DrawEColor == 4 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 710, 0xFF2D2D)
			elseif VayneMenu.draw.DrawEColor == 5 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 710, 0x8B42B3)
			end
		end

		if VayneMenu.draw.DrawAARange then
			if VayneMenu.draw.DrawAAColor == 1 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 655, 0x80FFFF)
			elseif VayneMenu.draw.DrawAAColor == 2 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 655, 0x0080FF)
			elseif VayneMenu.draw.DrawAAColor == 3 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 655, 0x5555FF)
			elseif VayneMenu.draw.DrawAAColor == 4 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 655, 0xFF2D2D)
			elseif VayneMenu.draw.DrawAAColor == 5 then
				DrawCircle(myHero.x, myHero.y, myHero.z, 655, 0x8B42B3)
			end
		end
	end
end

function OnProcessSpell(unit, spell)
	if not myHero.dead and ScriptOnLoadDone then
		-- AntiGapCloser Targeted Spells
		if isAGapcloserUnitTarget[unit.charName] and spell.name == isAGapcloserUnitTarget[unit.charName].spell and unit.team ~= myHero.team then
			if spell.target ~= nil and spell.target.hash == myHero.hash then
				if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitTarget[unit.charName].spellKey)][(unit.charName).."AutoCarry"] and ShadowVayneAutoCarry then _CastESpell(unit, "Gapcloser Targeted ("..(spell.name)..") / AutoCarry Mode") end
				if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitTarget[unit.charName].spellKey)][(unit.charName).."LastHit"] and ShadowVayneMixedMode then _CastESpell(unit, "Gapcloser Targeted ("..(spell.name)..") / Lasthit Mode") end
				if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitTarget[unit.charName].spellKey)][(unit.charName).."MixedMode"] and ShadowVayneLaneClear then _CastESpell(unit, "Gapcloser Targeted ("..(spell.name)..") / Mixed Mode") end
				if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitTarget[unit.charName].spellKey)][(unit.charName).."LaneClear"] and ShadowVayneLastHit then _CastESpell(unit, "Gapcloser Targeted ("..(spell.name)..") / Laneclear Mode") end
				if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitTarget[unit.charName].spellKey)][(unit.charName).."Always"] then _CastESpell(unit, "Gapcloser Targeted ("..(spell.name)..") / Always") end
			end
		end

		-- AntiGapCloser Interrupt Spells
		if isAChampToInterrupt[spell.name] and unit.charName == isAChampToInterrupt[spell.name].champ and GetDistance(unit) <= 715 and unit.team ~= myHero.team then
			if VayneMenu.interrupt[(unit.charName)..(isAChampToInterrupt[spell.name].spellKey)][(unit.charName).."AutoCarry"] and ShadowVayneAutoCarry then _CastESpell(unit, "Interrupt ("..(spell.name)..") / AutoCarry Mode") end
			if VayneMenu.interrupt[(unit.charName)..(isAChampToInterrupt[spell.name].spellKey)][(unit.charName).."LastHit"] and ShadowVayneMixedMode then _CastESpell(unit, "Interrupt ("..(spell.name)..") / Lasthit Mode") end
			if VayneMenu.interrupt[(unit.charName)..(isAChampToInterrupt[spell.name].spellKey)][(unit.charName).."MixedMode"] and ShadowVayneLaneClear then _CastESpell(unit, "Interrupt ("..(spell.name)..") / Mixed Mode") end
			if VayneMenu.interrupt[(unit.charName)..(isAChampToInterrupt[spell.name].spellKey)][(unit.charName).."LaneClear"] and ShadowVayneLastHit then _CastESpell(unit, "Interrupt ("..(spell.name)..") / Laneclear Mode") end
			if VayneMenu.interrupt[(unit.charName)..(isAChampToInterrupt[spell.name].spellKey)][(unit.charName).."Always"] then _CastESpell(unit, "Interrupt ("..(spell.name)..") / Always") end
		end

		if unit.isMe then
			if spell.name:find("Attack") then
				LastAttackedEnemy = spell.target
				if VayneMenu.keysetting.basiccondemn and spell.target.type == myHero.type then -- Auto-E after AA
					_CastESpell(spell.target, "E After Autohit ("..(spell.target.charName)..")", (spell.windUpTime - GetLatency() / 2000))
					VayneMenu.keysetting.basiccondemn = false
				end
			end


			if spell.name:find("VayneCondemn") then -- E detected, cooldown for next E 500 ticks
				CastedLastE = GetTickCount() + 500
			end
		end

		if isAGapcloserUnitNoTarget[spell.name] and GetDistance(unit) <= 2000 and (spell.target == nil or spell.target.isMe) and unit.team ~= myHero.team then
			if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitNoTarget[spell.name].spellKey)][(unit.charName).."AutoCarry"] and ShadowVayneAutoCarry then spellExpired = false end
			if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitNoTarget[spell.name].spellKey)][(unit.charName).."LastHit"] and ShadowVayneMixedMode then spellExpired = false end
			if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitNoTarget[spell.name].spellKey)][(unit.charName).."MixedMode"] and ShadowVayneLaneClear then spellExpired = false end
			if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitNoTarget[spell.name].spellKey)][(unit.charName).."LaneClear"] and ShadowVayneLastHit then spellExpired = false end
			if VayneMenu.anticapcloser[(unit.charName)..(isAGapcloserUnitNoTarget[spell.name].spellKey)][(unit.charName).."Always"] then spellExpired = false end
			informationTable = {
				spellSource = unit,
				spellCastedTick = GetTickCount(),
				spellStartPos = Point(spell.startPos.x, spell.startPos.z),
				spellEndPos = Point(spell.endPos.x, spell.endPos.z),
				spellRange = isAGapcloserUnitNoTarget[spell.name].range,
				spellSpeed = isAGapcloserUnitNoTarget[spell.name].projSpeed,
				spellName = spell.name
			}
		end
	end
end

function _AutoLevelSpell()
	if GetGame().map.index == 8 and myHero.level < 4 then
		LevelSpell(_Q)
		LevelSpell(_W)
		LevelSpell(_E)
	end

	if VayneMenu.autolevel.UseAutoLevelfirst and myHero.level < 4 then
		return AutoLevelSpellTable[AutoLevelSpellTable["SpellOrder"][VayneMenu.autolevel.first3level]][myHero.level]
	end

	if VayneMenu.autolevel.UseAutoLevelrest and myHero.level > 3 then
		return AutoLevelSpellTable[AutoLevelSpellTable["SpellOrder"][VayneMenu.autolevel.restlevel]][myHero.level]
	end
end

function _ResetRunningModes()
	VayneMenu.keysetting.autocarry = false
	VayneMenu.keysetting.mixedmode = false
	VayneMenu.keysetting.laneclear = false
	VayneMenu.keysetting.lasthit = false
	ShadowVayneAutoCarry = false
	ShadowVayneMixedMode = false
	ShadowVayneLaneClear = false
	ShadowVayneLastHit = false
	if MMALoaded then
		_G.MMA_Orbwalker = false
		_G.MMA_HybridMode = false
		_G.MMA_LaneClear = false
		_G.MMA_LastHit = false
	end
	if SACLoaded then
		Keys.AutoCarry = false
		Keys.MixedMode = false
		Keys.LaneClear = false
		Keys.LastHit = false
	end
	if SOWLoaded then
		VayneMenu.sow.Mode0 = false
		VayneMenu.sow.Mode1 = false
		VayneMenu.sow.Mode2 = false
		VayneMenu.sow.Mode3 = false
	end
end

function _SetNewTarget()
	if not myHero.dead and SOWLoaded and LastPrioUpdate + 100 < GetTickCount() then
		LastPrioUpdate = GetTickCount()
		local PrioOrder = 1
		local AATable = {}
		for i, enemy in ipairs(GetEnemyHeroes()) do
			if GetDistance(enemy) < 700 and not enemy.dead and enemy.visible then
				AATable[(_GetNeededAutoHits(enemy))] = enemy
			end
		end
		for NeedAA, Champ in _SortAATable(AATable) do
			SOWi:ForceTarget(Champ)
			break
		end
	end
end

function _GetNeededAutoHits(enemy)
		local PredictHP = math.ceil(enemy.health)
		local ThisAA = 0
		local BladeSlot = GetInventorySlotItem(3153)
		local TrueDMGPercent = ((enemy.maxHealth/100))*(3+(myHero:GetSpellData(_W).level))
		if myHero:GetSpellData(_W).level > 0 then TargetTrueDmg = math.floor((((enemy.maxHealth/100)*(3+(myHero:GetSpellData(_W).level)))+(10+(myHero:GetSpellData(_W).level)*10))/3) else	TargetTrueDmg = 0 end
		while PredictHP > 0 do
			ThisAA = ThisAA + 1
			DMGThisAA = math.floor((math.floor(myHero.totalDamage)) * 100 / (100 + enemy.armor))
			if BladeSlot ~= nil then BladeDMG = math.floor(math.floor(PredictHP)*5 / (100 + enemy.armor)) else BladeDMG = 0 end
			MyDMG = DMGThisAA + BladeDMG + TargetTrueDmg
			PredictHP = PredictHP - MyDMG
		end

		if ThisAA ~= math.floor(ThisAA/3)*3 then
			local PredictHP = math.ceil(enemy.health)
			for i = 1,math.floor(ThisAA/3)*3,1 do
				DMGThisAA = math.floor((math.floor(myHero.totalDamage)) * 100 / (100 + enemy.armor))
				if BladeSlot ~= nil then BladeDMG = math.floor(math.floor(PredictHP)*5 / (100 + enemy.armor)) else BladeDMG = 0 end
				MyDMG = DMGThisAA + BladeDMG + TargetTrueDmg
				PredictHP = PredictHP - MyDMG
			end

			for i = 1,2,1 do
				DMGThisAA = math.floor((math.floor(myHero.totalDamage)) * 100 / (100 + enemy.armor))
				if BladeSlot ~= nil then BladeDMG = math.floor(math.floor(PredictHP)*5 / (100 + enemy.armor)) else BladeDMG = 0 end
				MyDMG = DMGThisAA + BladeDMG
				PredictHP = PredictHP - MyDMG
			end

			if PredictHP > 0 then
				ThisAA = (math.ceil(ThisAA/3)*3)
			end
		end
	return ThisAA
end

function _SetNewPrioOrder()
	if LastPrioUpdate + 100 < GetTickCount() and SOWLoaded then
		LastPrioUpdate = GetTickCount()
		local PrioOrder = 1
		local AATable = {}
		for i, enemy in ipairs(GetEnemyHeroes()) do
			AATable[(_GetNeededAutoHits(enemy))] = enemy.hash
		end
		for NeedAA, ChampHash in _SortAATable(AATable) do
			for i, enemy in ipairs(GetEnemyHeroes()) do
				if enemy.hash == ChampHash then
					if enemy.dead then
						VayneMenu.STS.STS[ChampHash] = 5
					else
						VayneMenu.STS.STS[ChampHash] = PrioOrder
					end
					PrioOrder = PrioOrder + 1
					break
				end
			end
		end
	end
end

function _SortAATable(t, f)
	local a = {}
		for n in pairs(t) do table.insert(a, n) end
			table.sort(a, f)
			local i = 0
			local iter = function ()
			i = i + 1
			if a[i] == nil then
				return nil
			else
				return a[i], t[a[i]]
			end
		end
    return iter
end

function _CastESpell(Target, Reason, Delay)
	if VIP_USER and VayneMenu.vip.EPackets then
		DelayAction(function() Packet('S_CAST', { spellId = _E, targetNetworkId = Target.networkID }):send(true) end, Delay)
	else
		DelayAction(function() CastSpell(_E, Target) end, Delay)
	end
	CastedLastE = GetTickCount() + 500
end

function _UpdateCustomPermaShow()
	local PermaShowCount = 0
		if VayneMenu.permashowsettings.epermashow then
			PermaShowCount = PermaShowCount + 1
			_G.SV_PERMASHOW[(PermaShowCount).."_Name"] = tostring("Condemn on next BasicAttack")
			_G.SV_PERMASHOW[(PermaShowCount).."_Status"] = VayneMenu.keysetting.basiccondemn
		end

		if VayneMenu.permashowsettings.carrypermashow then
			PermaShowCount = PermaShowCount + 1
			_G.SV_PERMASHOW[(PermaShowCount).."_Name"] = tostring("AutoCarry (Using: "..AutoCarryOrbText..")")
			_G.SV_PERMASHOW[(PermaShowCount).."_Status"] = ShadowVayneAutoCarry
		end

		if VayneMenu.permashowsettings.mixedpermashow then
			PermaShowCount = PermaShowCount + 1
			_G.SV_PERMASHOW[(PermaShowCount).."_Name"] = tostring("MixedMode (Using: "..MixedModeOrbText..")")
			_G.SV_PERMASHOW[(PermaShowCount).."_Status"] = ShadowVayneMixedMode
		end

		if VayneMenu.permashowsettings.laneclearpermashow then
			PermaShowCount = PermaShowCount + 1
			_G.SV_PERMASHOW[(PermaShowCount).."_Name"] = tostring("LaneClear (Using: "..LaneClearOrbText..")")
			_G.SV_PERMASHOW[(PermaShowCount).."_Status"] = ShadowVayneLaneClear
		end

		if VayneMenu.permashowsettings.lasthitpermashow then
			PermaShowCount = PermaShowCount + 1
			_G.SV_PERMASHOW[(PermaShowCount).."_Name"] = tostring("LastHit (Using: "..LastHitOrbText..")")
			_G.SV_PERMASHOW[(PermaShowCount).."_Status"] = ShadowVayneLastHit
		end
		_G.SV_PERMASHOW.Count = PermaShowCount
end

function _CheckEnemyStunnAble()
	if not myHero.dead and myHero:CanUseSpell(_E) == READY and CastedLastE < GetTickCount() then
		for i, enemy in ipairs(GetEnemyHeroes()) do
			if 	(VayneMenu.targets[enemy.charName][(enemy.charName).."AutoCarry"] and ShadowVayneAutoCarry) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."MixedMode"] and ShadowVayneMixedMode) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."LaneClear"] and ShadowVayneLaneClear) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."LastHit"] and ShadowVayneLastHit) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."Always"])	then
				if GetDistance(enemy, myHero) <= 715 and not enemy.dead and enemy.visible then
					if VIP_USER and VayneMenu.vip.vpred then
						local CastPosition,  HitChance, enemy = VP:GetLineCastPosition(enemy, 0.30, 65, 1200, 2000, myHero, false)  -- Enemy, Delay, Range (scan?), Speed, Source, collosion)
					else
						local PredictEnemyPos = enemy
					end
					for i = 1, VayneMenu.autostunn.accuracy  do
						local CheckWallPos = enemy + (Vector(enemy) - myHero):normalized()*(math.ceil(VayneMenu.autostunn.pushDistance/VayneMenu.autostunn.accuracy)*i)
--~ 						if not BushFound and IsWallOfGrass(D3DXVECTOR3(CheckWallPos.x, CheckWallPos.y, CheckWallPos.z)) then
--~ 							BushFound = true
--~ 							BushPos = CheckWallPos
--~ 						end
						if IsWall(D3DXVECTOR3(CheckWallPos.x, CheckWallPos.y, CheckWallPos.z)) then
							if UnderTurret(ChecksWallPos, true) then
								if VayneMenu.autostunn.towerstunn then
									if GetDistance(enemy, myHero) <= 715 then
										_CastESpell(enemy, "AutoStunn Undertower ("..(enemy.charName)..")")
--~ 										if BushFound and VayneMenu.autostunn.trinket then DelayAction(function() CastSpell(ITEM_7, BushPos.x, BushPos.z) end, 0.25)	else BushFound = false end
										break
									end
								end
							else
								if GetDistance(CheckWallPos, enemy) < VayneMenu.autostunn.pushDistance then	_CastESpell(enemy, "AutoStunn Not Undertower ("..(enemy.charName)..")") end
								if BushFound and VayneMenu.autostunn.trinket then DelayAction(function() CastSpell(ITEM_7, BushPos.x, BushPos.z) end, 0.25)	else BushFound = false end
								break
							end
						end
					end
				end
			end
		end
	end
end

function _CheckEnemyStunnAbleBeta()
	if not myHero.dead and myHero:CanUseSpell(_E) == READY and CastedLastE < GetTickCount() then
		for i, enemy in ipairs(GetEnemyHeroes()) do
			if 	(VayneMenu.targets[enemy.charName][(enemy.charName).."AutoCarry"] and ShadowVayneAutoCarry) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."MixedMode"] and ShadowVayneMixedMode) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."LaneClear"] and ShadowVayneLaneClear) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."LastHit"] and ShadowVayneLastHit) or
				(VayneMenu.targets[enemy.charName][(enemy.charName).."Always"])	then
				if GetDistance(enemy, myHero) <= 1000 and not enemy.dead and enemy.visible then
					local CurrentDirection = (Vector(enemy) - ChampInfoTable[enemy.charName].CurrentVector)
					if CurrentDirection ~= Vector(0,0,0) then
						CurrentDirection = CurrentDirection:normalized()
					end
					ChampInfoTable[enemy.charName].CurrentAngle = ChampInfoTable[enemy.charName].CurrentDirection:dotP( CurrentDirection )
					ChampInfoTable[enemy.charName].CurrentDirection = CurrentDirection
					ChampInfoTable[enemy.charName].CurrentVector = Vector(enemy)
					if ChampInfoTable[enemy.charName].CurrentDirection ~= Vector(0,0,0) then
						if ChampInfoTable[enemy.charName].CurrentAngle and ChampInfoTable[enemy.charName].CurrentAngle > 0.8 then
							local AfterCastPos = Vector(enemy) + ChampInfoTable[enemy.charName].CurrentDirection * (enemy.ms * 0.0005)
							local timeElapsed = _GetCollisionTime(AfterCastPos, ChampInfoTable[enemy.charName].CurrentDirection, enemy.ms, myHero, 2200 )
							if timeElapsed ~= nil then
								StunnPos =  Vector(enemy) + ChampInfoTable[enemy.charName].CurrentDirection * enemy.ms * (timeElapsed + 0.5)/2
							end
						end
					else
						StunnPos = Vector(enemy)
					end
					if GetDistance(Vector(StunnPos), myHero) <= 710 then
						local BushFound, Bushpos = false, nil
						for i = 1, VayneMenu.autostunn.pushDistance, 10  do
							local CheckWallPos = Vector(StunnPos) + (Vector(StunnPos) - myHero):normalized()*(i)
							if IsWallOfGrass(D3DXVECTOR3(CheckWallPos.x, CheckWallPos.y, CheckWallPos.z)) and not BushFound then
								BushFound = true
								BushPos = CheckWallPos
							end
							if IsWall(D3DXVECTOR3(CheckWallPos.x, CheckWallPos.y, CheckWallPos.z)) then
								if UnderTurret(D3DXVECTOR3(CheckWallPos.x, CheckWallPos.y, CheckWallPos.z), true) then
									if VayneMenu.autostunn.towerstunn then
										_CastPacketSpell(_E, enemy)
										CastedLastE = GetTickCount() + 500
										_ScriptDebugMsg("Target: "..(enemy.charName)..", Reason: Autostunn, Field: UnderTower, Bush: "..(tostring(BushFound)), "stunndebug")
										break
									end
								else
									_CastPacketSpell(_E, enemy)
									if BushFound and VayneMenu.autostunn.trinket and myHero:CanUseSpell(ITEM_7) == 0 then
										CastSpell(ITEM_7, BushPos.x, BushPos.z)
									end
									_ScriptDebugMsg("Target: "..(enemy.charName)..", Reason: Autostunn, Field: NoTower, Bush: "..(tostring(BushFound)), "stunndebug")
									break
								end
							end
						end
					end
				end
			end
		end
	end
end

function _GetCollisionTime (targetPos, targetDir, targetSpeed, sourcePos, projSpeed ) --Function done by Yomie from EzCondemn
	local velocity = targetDir * targetSpeed

	local velocityX = velocity.x
	local velocityY = velocity.z

	local relStart = targetPos - sourcePos

	local relStartX = relStart.x
	local relStartY = relStart.z

	local a = velocityX * velocityX + velocityY * velocityY - projSpeed * projSpeed
	local b = 2 * velocityX * relStartX + 2 * velocityY * relStartY
	local c = relStartX * relStartX + relStartY * relStartY

	local disc = b * b - 4 * a * c

	if disc >= 0 then
		local t1 = -( b + math.sqrt( disc )) / (2 * a )
		local t2 = -( b - math.sqrt( disc )) / (2 * a )


		if t1 and t2 and t1 > 0 and t2 > 0 then
			if t1 > t2 then
				return t2
			else
				return t1
			end
		elseif t1 and t1 > 0 then
			return t1
		elseif t2 and t2 > 0 then
			return t2
		end
	end

	return nil
end

function _CastPacketSpell(SpellToCast, TargetToCast)
	if VIP_USER and VayneMenu.vip.EPackets then
		Packet('S_CAST', { spellId = SpellToCast, targetNetworkId = TargetToCast.networkID }):send(true)
		CastedLastE = GetTickCount() + 500
	else
		CastSpell(_E, TargetToCast)
		CastedLastE = GetTickCount() + 500
	end

end

function _NonTargetGapCloserAfterCast()
	if not myHero.dead and myHero:CanUseSpell(_E) == READY then
		if spellExpired == false and (GetTickCount() - informationTable.spellCastedTick) <= (informationTable.spellRange/informationTable.spellSpeed)*1000 then
			local spellDirection     = (informationTable.spellEndPos - informationTable.spellStartPos):normalized()
			local spellStartPosition = informationTable.spellStartPos + spellDirection
			local spellEndPosition   = informationTable.spellStartPos + spellDirection * informationTable.spellRange
			local heroPosition = Point(myHero.x, myHero.z)
			local SkillShot = LineSegment(Point(spellStartPosition.x, spellStartPosition.y), Point(spellEndPosition.x, spellEndPosition.y))
			if heroPosition:distance(SkillShot) <= 250 then
				if VayneMenu.vip.EPackets then _CastESpell(informationTable.spellSource, "Gapcloser NonTargeted ("..(informationTable.spellName)..")") end
			end
		else
			spellExpired = true
			informationTable = {}
		end
	end
end

function _PrintScriptMsg(Msg)
	print("<font color=\"#F0Ff8d\"><b>ShadowVayne:</b></font> <font color=\"#FF0F0F\">"..Msg.."</font>")
end

function _ScriptDebugMsg(Msg, DebugMode)
	if VayneMenu.debug[DebugMode] then
		print("<font color=\"#F0Ff8d\"><b>ShadowVayne Debug:</b></font> <font color=\"#FF0F0F\">"..Msg.."</font>")
	end
end

function _GetRunningModes()
	ShadowVayneAutoCarry = VayneMenu.keysetting.autocarry
	ShadowVayneMixedMode = VayneMenu.keysetting.mixedmode
	ShadowVayneLaneClear = VayneMenu.keysetting.laneclear
	ShadowVayneLastHit = VayneMenu.keysetting.lasthit
	if SACLoaded then Keys.AutoCarry,Keys.MixedMode,Keys.LaneClear,Keys.LastHit = false,false,false,false end
	if RevampedLoaded then RevampedMenu.AutoCarry,RevampedMenu.MixedMode,RevampedMenu.LaneClear,RevampedMenu.LastHit = false,false,false,false end
	if SOWLoaded then VayneMenu.sow.Mode0,VayneMenu.sow.Mode1,VayneMenu.sow.Mode2,VayneMenu.sow.Mode3 = false,false,false,false end
	if MMALoaded then _G.MMA_Orbwalker,_G.MMA_HybridMode,_G.MMA_LaneClear,_G.MMA_LastHit = false,false,false,false end
	if SACLoaded or MMALoaded or RevampedLoaded then
		if VayneMenu.keysetting._param[15].listTable[VayneMenu.keysetting.AutoCarryOrb] == nil then VayneMenu.keysetting.AutoCarryOrb = 1 end
		if VayneMenu.keysetting._param[16].listTable[VayneMenu.keysetting.MixedModeOrb] == nil then VayneMenu.keysetting.MixedModeOrb = 1 end
		if VayneMenu.keysetting._param[17].listTable[VayneMenu.keysetting.LaneClearOrb] == nil then VayneMenu.keysetting.LaneClearOrb = 1 end
		if VayneMenu.keysetting._param[18].listTable[VayneMenu.keysetting.LastHitOrb] == nil then VayneMenu.keysetting.LastHitOrb = 1 end
		AutoCarryOrbText = VayneMenu.keysetting._param[15].listTable[VayneMenu.keysetting.AutoCarryOrb]
		MixedModeOrbText = VayneMenu.keysetting._param[16].listTable[VayneMenu.keysetting.MixedModeOrb]
		LaneClearOrbText = VayneMenu.keysetting._param[17].listTable[VayneMenu.keysetting.LaneClearOrb]
		LastHitOrbText = VayneMenu.keysetting._param[18].listTable[VayneMenu.keysetting.LastHitOrb]
	else
		AutoCarryOrbText = "SOW"
		MixedModeOrbText = "SOW"
		LaneClearOrbText = "SOW"
		LastHitOrbText = "SOW"
	end
	if AutoCarryOrbText == "MMA" then _G.MMA_Orbwalker = ShadowVayneAutoCarry end
	if AutoCarryOrbText == "Reborn" then Keys.AutoCarry = ShadowVayneAutoCarry end
	if AutoCarryOrbText == "SOW" then VayneMenu.sow.Mode0 = ShadowVayneAutoCarry end
	if AutoCarrycOrbText == "Revamped" then _G.AutoCarry.AutoCarry.MainMenu.AutoCarry = ShadowVayneAutoCarry end

	if MixedModeOrbText == "MMA" then _G.MMA_HybridMode = ShadowVayneMixedMode end
	if MixedModeOrbText == "Reborn" then Keys.MixedMode = ShadowVayneMixedMode end
	if MixedModeOrbText == "SOW" then VayneMenu.sow.Mode1 = ShadowVayneMixedMode end
	if MixedModeOrbText == "Revamped" then _G.AutoCarry.AutoCarry.MainMenu.MixedMode = ShadowVayneMixedMode end

	if LaneClearOrbText == "MMA" then _G.MMA_LaneClear = ShadowVayneLaneClear end
	if LaneClearOrbText == "Reborn" then Keys.LaneClear = ShadowVayneLaneClear end
	if LaneClearOrbText == "SOW" then VayneMenu.sow.Mode2 = ShadowVayneLaneClear end
	if LaneClearOrbText == "Revamped" then _G.AutoCarry.AutoCarry.MainMenu.LaneClear = ShadowVayneLaneClear end

	if LastHitOrbText == "MMA" then _G.MMA_LastHit = ShadowVayneLastHit end
	if LastHitOrbText == "Reborn" then Keys.LastHit = ShadowVayneLastHit end
	if LastHitOrbText == "SOW" then VayneMenu.sow.Mode3 = ShadowVayneLastHit end
	if LastHitOrbText == "Revamped" then _G.AutoCarry.AutoCarry.MainMenu.LastHit = ShadowVayneLastHit end
end

function _LoadMenu()
	VayneMenu = scriptConfig("Shadow Vayne", "ShadowVayne")
	VayneMenu:addSubMenu("[Condemn]: AntiGapCloser Settings", "anticapcloser")
	VayneMenu:addSubMenu("[Condemn]: AutoStunn Settings", "autostunn")
	VayneMenu:addSubMenu("[Condemn]: AutoStunn Targets", "targets")
	VayneMenu:addSubMenu("[Condemn]: Interrupt Settings", "interrupt")
	VayneMenu:addSubMenu("[Misc]: Key Settings", "keysetting")
	VayneMenu:addSubMenu("[Misc]: AutoLevelSpells Settings", "autolevel")
	VayneMenu:addSubMenu("[Misc]: VIP Settings", "vip")
	VayneMenu:addSubMenu("[Misc]: PermaShow Settings", "permashowsettings")
	VayneMenu:addSubMenu("[Misc]: AutoUpdate Settings", "autoup")
	VayneMenu:addSubMenu("[Misc]: Draw Settings", "draw")
	VayneMenu:addSubMenu("[BotRK]: Settings", "botrksettings")
	VayneMenu:addSubMenu("[QSS]: Settings", "qqs")
	VayneMenu:addSubMenu("[Debug]: Settings", "debug")

	VayneMenu.qqs:addParam("nil","QSS/Cleanse is not Supported yet", SCRIPT_PARAM_INFO, "")

	if SOWLoaded then
		require "SOW"
	  	VayneMenu:addSubMenu("[Sow]: Orbwalker Settings", "sow")
		SOWi = SOW(VP)
		SOWi:LoadToMenu(VayneMenu.sow)
	end

	VayneMenu.keysetting:addParam("nil","Basic Key Settings", SCRIPT_PARAM_INFO, "")
	VayneMenu.keysetting:addParam("basiccondemn","Condemn on next BasicAttack:", SCRIPT_PARAM_ONKEYTOGGLE, false, string.byte( "E" ))
	VayneMenu.keysetting:addParam("threshlantern","Grab the Thresh lantern: ", SCRIPT_PARAM_ONKEYDOWN, false, string.byte( "T" ))
	VayneMenu.keysetting.basiccondemn = false
	VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
	VayneMenu.keysetting:addParam("nil","Key Settings", SCRIPT_PARAM_INFO, "")
	VayneMenu.keysetting:addParam("autocarry","Auto Carry Mode Key:", SCRIPT_PARAM_ONKEYDOWN, false, string.byte( "V" ))
	VayneMenu.keysetting:addParam("mixedmode","Mixed Mode Key:", SCRIPT_PARAM_ONKEYDOWN, false, string.byte( "C" ))
	VayneMenu.keysetting:addParam("laneclear","Lane Clear Mode Key:", SCRIPT_PARAM_ONKEYDOWN, false, string.byte( "M" ))
	VayneMenu.keysetting:addParam("lasthit","Last Hit Mode Key:", SCRIPT_PARAM_ONKEYDOWN, false, string.byte( "N" ))

	if SOWLoaded then
		if not MMALoaded then
			if SACLoaded then
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Sida's AutoCarry Reborn found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Simple Orbwalker (SOW) found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Choose...", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("AutoCarryOrb", "Orbwalker in AutoCarry: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn"})
				VayneMenu.keysetting:addParam("MixedModeOrb", "Orbwalker in MixedMode: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn"})
				VayneMenu.keysetting:addParam("LaneClearOrb", "Orbwalker in LaneClear: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn"})
				VayneMenu.keysetting:addParam("LastHitOrb", "Orbwalker in LastHit: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn"})
				DelayAction(function()  _PrintScriptMsg("SAC:Reborn & SOW found. Check your Keysettings") end, 1)
			end

			if RevampedLoaded then
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Sida's AutoCarry Revamped found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Simple Orbwalker (SOW) found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Choose...", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("AutoCarryOrb", "Orbwalker in AutoCarry: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped"})
				VayneMenu.keysetting:addParam("MixedModeOrb", "Orbwalker in MixedMode: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped"})
				VayneMenu.keysetting:addParam("LaneClearOrb", "Orbwalker in LaneClear: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped"})
				VayneMenu.keysetting:addParam("LastHitOrb", "Orbwalker in LastHit: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped"})
				DelayAction(function()  _PrintScriptMsg("SAC:Revamped & SOW found. Check your Keysettings") end, 1)
			end
		else
			if SACLoaded then
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Sida's AutoCarry Reborn found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Simple Orbwalker (SOW) found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Choose...", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("AutoCarryOrb", "Orbwalker in AutoCarry: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn", "MMA"})
				VayneMenu.keysetting:addParam("MixedModeOrb", "Orbwalker in MixedMode: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn", "MMA"})
				VayneMenu.keysetting:addParam("LaneClearOrb", "Orbwalker in LaneClear: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn", "MMA"})
				VayneMenu.keysetting:addParam("LastHitOrb", "Orbwalker in LastHit: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Reborn", "MMA"})
				DelayAction(function()  _PrintScriptMsg("SAC:Reborn, SOW & MMA found. Check your Keysettings") end, 1)
			elseif RevampedLoaded then
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Sida's AutoCarry Revamped found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Simple Orbwalker (SOW) found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Choose...", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("AutoCarryOrb", "Orbwalker in AutoCarry: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped", "MMA"})
				VayneMenu.keysetting:addParam("MixedModeOrb", "Orbwalker in MixedMode: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped", "MMA"})
				VayneMenu.keysetting:addParam("LaneClearOrb", "Orbwalker in LaneClear: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped", "MMA"})
				VayneMenu.keysetting:addParam("LastHitOrb", "Orbwalker in LastHit: ", SCRIPT_PARAM_LIST, 1, { "SOW", "Revamped", "MMA"})
				DelayAction(function()  _PrintScriptMsg("SAC:Revamped, SOW & MMA found. Check your Keysettings") end, 1)
			else
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","MarksmanMightyAssistant found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Simple Orbwalker (SOW) found", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("nil","Choose...", SCRIPT_PARAM_INFO, "")
				VayneMenu.keysetting:addParam("AutoCarryOrb", "Orbwalker in AutoCarry: ", SCRIPT_PARAM_LIST, 1, { "SOW", "MMA"})
				VayneMenu.keysetting:addParam("MixedModeOrb", "Orbwalker in MixedMode: ", SCRIPT_PARAM_LIST, 1, { "SOW", "MMA"})
				VayneMenu.keysetting:addParam("LaneClearOrb", "Orbwalker in LaneClear: ", SCRIPT_PARAM_LIST, 1, { "SOW", "MMA"})
				VayneMenu.keysetting:addParam("LastHitOrb", "Orbwalker in LastHit: ", SCRIPT_PARAM_LIST, 1, { "SOW", "MMA"})
				DelayAction(function()  _PrintScriptMsg("SOW & MMA found. Check your Keysettings") end, 1)
			end
		end
	end

	for i, enemy in ipairs(GetEnemyHeroes()) do
--~ 	Gapcloser Menu Targeted Skills
		if isAGapcloserUnitTarget[enemy.charName] then
			VayneMenu.anticapcloser:addSubMenu((enemy.charName).." "..(isAGapcloserUnitTarget[enemy.charName].spellKey), (enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey))
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam("sep", "Interrupt "..(enemy.charName).." "..(isAGapcloserUnitTarget[enemy.charName].spellKey)..":", SCRIPT_PARAM_INFO, "")
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam((enemy.charName).."AutoCarry", "in AutoCarry", SCRIPT_PARAM_ONOFF, true)
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam((enemy.charName).."MixedMode", "in MixedMode", SCRIPT_PARAM_ONOFF, true)
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam((enemy.charName).."LaneClear", "in LaneClear", SCRIPT_PARAM_ONOFF, false)
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam((enemy.charName).."LastHit", "in LastHit", SCRIPT_PARAM_ONOFF, false)
			VayneMenu.anticapcloser[(enemy.charName)..(isAGapcloserUnitTarget[enemy.charName].spellKey)]:addParam((enemy.charName).."Always", "Always", SCRIPT_PARAM_ONOFF, false)
		end

--~ 	Gapcloser Menu NoTargeted Skills
		for _, TableInfo in pairs(isAGapcloserUnitNoTarget) do
			if TableInfo.champ == enemy.charName then
				VayneMenu.anticapcloser:addSubMenu((enemy.charName).." "..(TableInfo.spellKey), (enemy.charName)..(TableInfo.spellKey))
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam("sep", "Interrupt "..(enemy.charName).." "..(TableInfo.spellKey)..":", SCRIPT_PARAM_INFO, "")
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."AutoCarry", "in AutoCarry", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."MixedMode", "in MixedMode", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."LaneClear", "in LaneClear", SCRIPT_PARAM_ONOFF, false)
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."LastHit", "in LastHit", SCRIPT_PARAM_ONOFF, false)
				VayneMenu.anticapcloser[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."Always", "Always", SCRIPT_PARAM_ONOFF, false)
			end
		end

--~ 	Autostunn Target Menu
		VayneMenu.targets:addSubMenu(enemy.charName, enemy.charName)
		VayneMenu.targets[enemy.charName]:addParam("sep", "Stunn "..(enemy.charName), SCRIPT_PARAM_INFO, "")
		VayneMenu.targets[enemy.charName]:addParam((enemy.charName).."AutoCarry", "in AutoCarry", SCRIPT_PARAM_ONOFF, true)
		VayneMenu.targets[enemy.charName]:addParam((enemy.charName).."MixedMode", "in MixedMode", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.targets[enemy.charName]:addParam((enemy.charName).."LaneClear", "in LaneClear", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.targets[enemy.charName]:addParam((enemy.charName).."LastHit", "in LastHit", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.targets[enemy.charName]:addParam((enemy.charName).."Always", "Always", SCRIPT_PARAM_ONOFF, false)

--~ 	Interrupt Champs Menu
		for _, TableInfo in pairs(isAChampToInterrupt) do
			if TableInfo.champ == enemy.charName then
				VayneMenu.interrupt:addSubMenu((enemy.charName).." "..(TableInfo.spellKey), (enemy.charName)..(TableInfo.spellKey))
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam("sep", "Interrupt "..(enemy.charName).." "..(TableInfo.spellKey), SCRIPT_PARAM_INFO, "")
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."AutoCarry", "in AutoCarry", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."MixedMode", "in MixedMode", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."LaneClear", "in LaneClear", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."LastHit", "in LastHit", SCRIPT_PARAM_ONOFF, true)
				VayneMenu.interrupt[(enemy.charName)..(TableInfo.spellKey)]:addParam((enemy.charName).."Always", "Always", SCRIPT_PARAM_ONOFF, true)
			end
		end
	end

--~ 	AutoStunn Settings Menu
		VayneMenu.autostunn:addParam("pushDistance", "Push Distance", SCRIPT_PARAM_SLICE, 390, 0, 450, 0)
--~ 		VayneMenu.autostunn:addParam("accuracy", "Accuracy", SCRIPT_PARAM_SLICE, 5, 1, 10, 0)
		VayneMenu.autostunn:addParam("towerstunn", "Stunn if Enemy lands unter a Tower", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.autostunn:addParam("trinket", "Use Auto-Trinket Bush", SCRIPT_PARAM_ONOFF, true)

--~ 	Draw Menu
		VayneMenu.draw:addParam("DrawERange", "Draw E Range", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.draw:addParam("DrawAARange", "Draw Basicattack Range", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.draw:addParam("DrawNeededAutohits", "Draw Needed Autohits", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.draw:addParam("DrawEColor", "E Range Color", SCRIPT_PARAM_LIST, 1, { "Riot standard", "Green", "Blue", "Red", "Purple" })
		VayneMenu.draw:addParam("DrawAAColor", "Basicattack Range Color", SCRIPT_PARAM_LIST, 1, { "Riot standard", "Green", "Blue", "Red", "Purple" })

--~ 	Autolevel Menu
		VayneMenu.autolevel:addParam("UseAutoLevelfirst", "Use AutoLevelSpells Level 1-3", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.autolevel:addParam("UseAutoLevelrest", "Use AutoLevelSpells Level 4-18", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.autolevel:addParam("first3level", "Level 1-3:", SCRIPT_PARAM_LIST, 1, { "Q-W-E", "Q-E-W", "W-Q-E", "W-E-Q", "E-Q-W", "E-W-Q" })
		VayneMenu.autolevel:addParam("restlevel", "Level 4-18:", SCRIPT_PARAM_LIST, 1, { "Q-W-E", "Q-E-W", "W-Q-E", "W-E-Q", "E-Q-W", "E-W-Q" })
		VayneMenu.autolevel:addParam("fap", "", SCRIPT_PARAM_INFO, "","" )
		VayneMenu.autolevel:addParam("fap", "You can Click on the \"Q-W-E\"", SCRIPT_PARAM_INFO, "","" )
		VayneMenu.autolevel:addParam("fap", "to change the Autospellorder", SCRIPT_PARAM_INFO, "","" )

--~ 	Vip Menu
		VayneMenu.vip:addParam("EPackets", "Use Packets for E Cast (VIP Only)", SCRIPT_PARAM_ONOFF, true)
		VayneMenu.vip:addParam("vpred", "Use VPrediction (VIP Only)", SCRIPT_PARAM_ONOFF, true)

--~ 	PermaShow Menu
		VayneMenu.permashowsettings:addParam("epermashow", "PermaShow \"E on Next BasicAttack\"", SCRIPT_PARAM_ONOFF, true)
		if SOWLoaded then
			VayneMenu.permashowsettings:addParam("carrypermashow", "PermaShow: AutoCarry", SCRIPT_PARAM_ONOFF, true)
			VayneMenu.permashowsettings:addParam("mixedpermashow", "PermaShow: Mixed Mode", SCRIPT_PARAM_ONOFF, true)
			VayneMenu.permashowsettings:addParam("laneclearpermashow", "PermaShow: Laneclear", SCRIPT_PARAM_ONOFF, true)
			VayneMenu.permashowsettings:addParam("lasthitpermashow", "PermaShow: Last hit", SCRIPT_PARAM_ONOFF, true)
		end

--~ 	AutoUpdate Menu
		VayneMenu.autoup:addParam("autoupcheck", "Check for Updates", SCRIPT_PARAM_ONOFF, true)
		VayneMenu.autoup:addParam("autoupdown", "Download Available Updates", SCRIPT_PARAM_ONOFF, true)
		VayneMenu.autoup:addParam("fap", "", SCRIPT_PARAM_INFO, "","" )
		VayneMenu.autoup:addParam("fap", "The first will check if download is available", SCRIPT_PARAM_INFO, "","" )
		VayneMenu.autoup:addParam("fap", "The second will download it", SCRIPT_PARAM_INFO, "","" )

--~ 	BotRK Settings Menu
		VayneMenu.botrksettings:addParam("botrkautocarry", "Use BotRK in AutoCarry", SCRIPT_PARAM_ONOFF, true)
		VayneMenu.botrksettings:addParam("botrkmixedmode", "Use BotRK in MixedMode", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.botrksettings:addParam("botrklaneclear", "Use BotRK in LaneClear", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.botrksettings:addParam("botrklasthit", "Use BotRK in LastHit", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.botrksettings:addParam("botrkalways", "Use BotRK always", SCRIPT_PARAM_ONOFF, false)
		VayneMenu.botrksettings:addParam("botrkmaxheal", "Max Own Health Percent", SCRIPT_PARAM_SLICE, 50, 1, 100, 0)
		VayneMenu.botrksettings:addParam("botrkminheal", "Min Enemy Health Percent", SCRIPT_PARAM_SLICE, 20, 1, 100, 0)

--~ 	Debug Settings Menu
		VayneMenu.debug:addParam("stunndebug", "Debug AutoStunn", SCRIPT_PARAM_ONOFF, false)

end

function _CheckSACMMASOW()
	if AutoCarry ~= nil then
		if AutoCarry.Helper ~= nil then
			Skills, Keys, Items, Data, Jungle, Helper, MyHero, Minions, Crosshair, Orbwalker = AutoCarry.Helper:GetClasses()
			SACLoaded = true
		else
			RevampedLoaded = true
			RevampedMenu = _G.AutoCarry.AutoCarry.MainMenu
		end
	end

	if _G.MMA_Loaded then
		MMALoaded = true
	end

	if not FileExist(SCRIPT_PATH.."/Common/SOW.lua") and not RevampedLoaded and not SACLoaded and not MMALoaded then
		DelayAction(function() _PrintScriptMsg("No Orbwalker found. It will use the raw Keysettings") end, 1)
		DelayAction(function() _PrintScriptMsg("Download SOW from the Forum") end, 1)
	elseif FileExist(SCRIPT_PATH.."/Common/SOW.lua") then
		SOWLoaded = true
	end
end

function _GetUpdate()
	if not AlreadyChecked then
		if not OnLoadDone then
			if Beta then SCRIPT_NAME = "ShadowVayneBeta" else SCRIPT_NAME = "ShadowVayne" end
				OwnScriptFile = io.open(SCRIPT_PATH..(GetCurrentEnv().FILE_NAME), "r")
				LocalVersion = string.sub(OwnScriptFile:read("*a"), 51, 54)
				FileClose = OwnScriptFile:close()
				_PrintScriptMsg("Loaded Version: "..(LocalVersion))
			OnLoadDone = true
			SHADOWVAYNE_SCRIPT_URL = "http://raw.github.com/Superx321/BoL/master/"..SCRIPT_NAME..".lua?rand="..tostring(math.random(1,10000))
			SHADOWVAYNE_PATH = SCRIPT_PATH..(GetCurrentEnv().FILE_NAME)
			ServerWebResult = GetWebResult("raw.github.com", "/Superx321/BoL/master/"..SCRIPT_NAME..".lua?rand="..tostring(math.random(1,10000)))
			if ServerWebResult ~= nil then
				ServerVersion = string.sub(ServerWebResult, 51, 54)
			else
				ServerVersion = nil
			end
		end
		if VayneMenu.autoup.autoupcheck then
			if tonumber(ServerVersion) ~= nil and tonumber(LocalVersion) ~= nil then
				if tonumber(LocalVersion) < tonumber(ServerVersion) then
					if VayneMenu.autoup.autoupdown then
						_PrintScriptMsg("New Version ("..(ServerVersion)..") available, downloading...")
						DownloadFile(SHADOWVAYNE_SCRIPT_URL, SHADOWVAYNE_PATH, function () _PrintScriptMsg("Updated to Version "..(ServerVersion)..". Please reload with F9") end)
					else
						_PrintScriptMsg("New Version is available. Turn on AutoUpdate or download manually")
					end
				else
					_PrintScriptMsg("No Updates available")
				end
				AlreadyChecked = true
			else
				_PrintScriptMsg("Error downloading Version Info.")
				AlreadyChecked = true
			end
		end
	end
end

function _UseBotRK()
	local BladeSlot = GetInventorySlotItem(3153)
	if LastAttackedEnemy ~= nil and GetDistance(LastAttackedEnemy) < 450 and not LastAttackedEnemy.dead and LastAttackedEnemy.visible and BladeSlot ~= nil and myHero:CanUseSpell(BladeSlot) == 0 then
		if (VayneMenu.botrksettings.botrkautocarry and ShadowVayneAutoCarry) or
		 (VayneMenu.botrksettings.botrkmixedmode and ShadowVayneMixedMode) or
		 (VayneMenu.botrksettings.botrklaneclear and ShadowVayneLaneClear) or
		 (VayneMenu.botrksettings.botrklasthit and ShadowVayneLastHit) or
		 (VayneMenu.botrksettings.botrkalways) then
			if (math.floor(myHero.health / myHero.maxHealth * 100)) <= VayneMenu.botrksettings.botrkmaxheal then
				if (math.floor(LastAttackedEnemy.health / LastAttackedEnemy.maxHealth * 100)) >= VayneMenu.botrksettings.botrkminheal then
					CastSpell(BladeSlot, LastAttackedEnemy)
				end
			end
		end
	end
end

function _ThreshLanternObj(Obj)
	if Obj.name == "ThreshLantern" then
		LanternObj = Obj
	end
end

function _ClickThreshLantern()
	if VayneMenu.keysetting.threshlantern and LanternObj then
		LanternPacket = CLoLPacket(0x39)
		LanternPacket:EncodeF(myHero.networkID)
		LanternPacket:EncodeF(LanternObj.networkID)
		LanternPacket.dwArg1 = 1
		LanternPacket.dwArg2 = 0
		SendPacket(LanternPacket)
	end
end

function _DownloadLib(FilePath, LibName)
	if not FileExist(SCRIPT_PATH.."Common/"..LibName..".lua") then
		if not DownloadStarted then
			DownloadStarted = true
			_PrintScriptMsg("Downloading Library ("..LibName.."), please wait until its finished")
			DownloadFile("http://github.com/"..FilePath.."?rand="..tostring(math.random(1,10000)), SCRIPT_PATH.."Common/"..LibName..".lua",  function() DownloadStarted, HadToDownload = false, true end)
		end
	end
end

function _SetPriority(table, hero, priority)
    for i=1, #table, 1 do
        if hero.charName:find(table[i]) ~= nil then
            TS_SetHeroPriority(priority, hero.charName)
        end
    end
end

function _arrangePrioritys(enemies)
    local priorityOrder = {
        [2] = {1,1,2,2,2},
        [3] = {1,1,2,3,3},
        [4] = {1,2,3,4,4},
        [5] = {1,2,3,4,5},
    }
    for i, enemy in ipairs(GetEnemyHeroes()) do
        _SetPriority(priorityTable.AD_Carry, enemy, priorityOrder[enemies][1])
        _SetPriority(priorityTable.AP,       enemy, priorityOrder[enemies][2])
        _SetPriority(priorityTable.Support,  enemy, priorityOrder[enemies][3])
        _SetPriority(priorityTable.Bruiser,  enemy, priorityOrder[enemies][4])
        _SetPriority(priorityTable.Tank,     enemy, priorityOrder[enemies][5])
    end
end

function _LoadTables()
	isAGapcloserUnitTarget = {
        ['Akali']       = {true, spell = "AkaliShadowDance", 	spellKey = "R"},
        ['Alistar']     = {true, spell = "Headbutt", 			spellKey = "W"},
        ['Diana']       = {true, spell = "DianaTeleport", 		spellKey = "R"},
        ['Irelia']      = {true, spell = "IreliaGatotsu",		spellKey = "Q"},
        ['Jax']         = {true, spell = "JaxLeapStrike", 		spellKey = "Q"},
        ['Jayce']       = {true, spell = "JayceToTheSkies",		spellKey = "Q"},
        ['Maokai']      = {true, spell = "MaokaiUnstableGrowth",spellKey = "W"},
        ['MonkeyKing']  = {true, spell = "MonkeyKingNimbus",	spellKey = "E"},
        ['Pantheon']    = {true, spell = "Pantheon_LeapBash",	spellKey = "W"},
        ['Poppy']       = {true, spell = "PoppyHeroicCharge",	spellKey = "E"},
		['Quinn']       = {true, spell = "QuinnE",				spellKey = "E"},
        ['XinZhao']     = {true, spell = "XenZhaoSweep",		spellKey = "E"},
        ['LeeSin']	    = {true, spell = "blindmonkqtwo",		spellKey = "Q"}
    }

	isAGapcloserUnitNoTarget = {
		["AatroxQ"]					= {true, champ = "Aatrox", 		range = 1000,  	projSpeed = 1200, spellKey = "Q"},
		["GragasE"]					= {true, champ = "Gragas", 		range = 600,   	projSpeed = 2000, spellKey = "E"},
		["GravesMove"]				= {true, champ = "Graves", 		range = 425,   	projSpeed = 2000, spellKey = "E"},
		["HecarimUlt"]				= {true, champ = "Hecarim", 	range = 1000,   projSpeed = 1200, spellKey = "R"},
		["JarvanIVDragonStrike"]	= {true, champ = "JarvanIV",	range = 770,   	projSpeed = 2000, spellKey = "Q"},
		["JarvanIVCataclysm"]		= {true, champ = "JarvanIV", 	range = 650,   	projSpeed = 2000, spellKey = "R"},
		["KhazixE"]					= {true, champ = "Khazix", 		range = 900,   	projSpeed = 2000, spellKey = "E"},
		["khazixelong"]				= {true, champ = "Khazix", 		range = 900,   	projSpeed = 2000, spellKey = "E"},
		["LeblancSlide"]			= {true, champ = "Leblanc", 	range = 600,   	projSpeed = 2000, spellKey = "W"},
		["LeblancSlideM"]			= {true, champ = "Leblanc", 	range = 600,   	projSpeed = 2000, spellKey = "WMimic"},
		["LeonaZenithBlade"]		= {true, champ = "Leona", 		range = 900,  	projSpeed = 2000, spellKey = "E"},
		["UFSlash"]					= {true, champ = "Malphite", 	range = 1000,  	projSpeed = 1800, spellKey = "R"},
		["RenektonSliceAndDice"]	= {true, champ = "Renekton", 	range = 450,  	projSpeed = 2000, spellKey = "E"},
		["SejuaniArcticAssault"]	= {true, champ = "Sejuani", 	range = 650,  	projSpeed = 2000, spellKey = "Q"},
		["ShenShadowDash"]			= {true, champ = "Shen", 		range = 575,  	projSpeed = 2000, spellKey = "E"},
		["RocketJump"]				= {true, champ = "Tristana", 	range = 900,  	projSpeed = 2000, spellKey = "W"},
		["slashCast"]				= {true, champ = "Tryndamere", 	range = 650,  	projSpeed = 1450, spellKey = "E"}
	}

	isAChampToInterrupt = {
                ["KatarinaR"]					= {true, champ = "Katarina",	spellKey = "R"},
                ["GalioIdolOfDurand"]			= {true, champ = "Galio",		spellKey = "R"},
                ["Crowstorm"]					= {true, champ = "FiddleSticks",spellKey = "R"},
                ["Drain"]						= {true, champ = "FiddleSticks",spellKey = "W"},
                ["AbsoluteZero"]				= {true, champ = "Nunu",		spellKey = "R"},
                ["ShenStandUnited"]				= {true, champ = "Shen",		spellKey = "R"},
                ["UrgotSwap2"]					= {true, champ = "Urgot",		spellKey = "R"},
                ["AlZaharNetherGrasp"]			= {true, champ = "Malzahar",	spellKey = "R"},
                ["FallenOne"]					= {true, champ = "Karthus",		spellKey = "R"},
                ["Pantheon_GrandSkyfall_Jump"]	= {true, champ = "Pantheon",	spellKey = "R"},
                ["VarusQ"]						= {true, champ = "Varus",		spellKey = "Q"},
                ["CaitlynAceintheHole"]			= {true, champ = "Caitlyn",		spellKey = "R"},
                ["MissFortuneBulletTime"]		= {true, champ = "MissFortune",	spellKey = "R"},
                ["InfiniteDuress"]				= {true, champ = "Warwick",		spellKey = "R"}
	}

	AutoLevelSpellTable = {
                ["SpellOrder"]	= {"QWE", "QEW", "WQE", "WEQ", "EQW", "EWQ"},
                ["QWE"]	= {1,2,3,1,1,4,1,2,1,2,4,2,2,3,3,4,3,3},
                ["QEW"]	= {1,3,2,1,1,4,1,3,1,3,4,3,3,2,2,4,2,2},
                ["WQE"]	= {2,1,3,2,2,4,2,1,2,1,4,1,1,3,3,4,3,3},
                ["WEQ"]	= {2,3,1,2,2,4,2,3,2,3,4,3,3,1,1,4,1,1},
                ["EQW"]	= {3,1,2,3,3,4,3,1,3,1,4,1,1,2,2,4,2,2},
                ["EWQ"]	= {3,2,1,3,3,4,3,2,3,2,4,2,2,1,1,4,1,1}
	}

	priorityTable = {

    AP = {
        "Ahri", "Akali", "Anivia", "Annie", "Brand", "Cassiopeia", "Diana", "Evelynn", "FiddleSticks", "Fizz", "Gragas", "Heimerdinger", "Karthus",
        "Kassadin", "Katarina", "Kayle", "Kennen", "Leblanc", "Lissandra", "Lux", "Malzahar", "Mordekaiser", "Morgana", "Nidalee", "Orianna",
        "Rumble", "Ryze", "Sion", "Swain", "Syndra", "Teemo", "TwistedFate", "Veigar", "Viktor", "Vladimir", "Xerath", "Ziggs", "Zyra", "MasterYi", "Velkoz",
    },
    Support = {
        "Blitzcrank", "Janna", "Karma", "Leona", "Lulu", "Nami", "Sona", "Soraka", "Thresh", "Zilean", "Braum",
    },

    Tank = {
        "Amumu", "Chogath", "DrMundo", "Galio", "Hecarim", "Malphite", "Maokai", "Nasus", "Rammus", "Sejuani", "Shen", "Singed", "Skarner", "Volibear",
        "Warwick", "Yorick", "Zac", "Nunu", "Taric", "Alistar",
    },

    AD_Carry = {
        "Ashe", "Caitlyn", "Corki", "Draven", "Ezreal", "Graves", "Jayce", "KogMaw", "MissFortune", "Pantheon", "Quinn", "Shaco", "Sivir",
        "Talon", "Tristana", "Twitch", "Urgot", "Varus", "Vayne", "Zed", "Jinx" , "Lucian",

    },

    Bruiser = {
        "Darius", "Elise", "Fiora", "Gangplank", "Garen", "Irelia", "JarvanIV", "Jax", "Khazix", "LeeSin", "Nautilus", "Nocturne", "Olaf", "Poppy",
        "Renekton", "Rengar", "Riven", "Shyvana", "Trundle", "Tryndamere", "Udyr", "Vi", "MonkeyKing", "XinZhao", "Aatrox",
    },

}

	ChampHitBoxes = {['RecItemsCLASSIC'] = 65, ['TeemoMushroom'] = 50.0, ['TestCubeRender'] = 65, ['Xerath'] = 65, ['Kassadin'] = 65, ['Rengar'] = 65, ['Thresh'] = 55.0, ['RecItemsTUTORIAL'] = 65, ['Ziggs'] = 55.0, ['ZyraPassive'] = 20.0, ['ZyraThornPlant'] = 20.0, ['KogMaw'] = 65, ['HeimerTBlue'] = 35.0, ['EliseSpider'] = 65, ['Skarner'] = 80.0, ['ChaosNexus'] = 65, ['Katarina'] = 65, ['Riven'] = 65, ['SightWard'] = 1, ['HeimerTYellow'] = 35.0, ['Ashe'] = 65, ['VisionWard'] = 1, ['TT_NGolem2'] = 80.0, ['ThreshLantern'] = 65, ['RecItemsCLASSICMap10'] = 65, ['RecItemsODIN'] = 65, ['TT_Spiderboss'] = 200.0, ['RecItemsARAM'] = 65, ['OrderNexus'] = 65, ['Soraka'] = 65, ['Jinx'] = 65, ['TestCubeRenderwCollision'] = 65, ['Red_Minion_Wizard'] = 48.0, ['JarvanIV'] = 65, ['Blue_Minion_Wizard'] = 48.0, ['TT_ChaosTurret2'] = 88.4, ['TT_ChaosTurret3'] = 88.4, ['TT_ChaosTurret1'] = 88.4, ['ChaosTurretGiant'] = 88.4, ['Dragon'] = 100.0, ['LuluSnowman'] = 50.0, ['Worm'] = 100.0, ['ChaosTurretWorm'] = 88.4, ['TT_ChaosInhibitor'] = 65, ['ChaosTurretNormal'] = 88.4, ['AncientGolem'] = 100.0, ['ZyraGraspingPlant'] = 20.0, ['HA_AP_OrderTurret3'] = 88.4, ['HA_AP_OrderTurret2'] = 88.4, ['Tryndamere'] = 65, ['OrderTurretNormal2'] = 88.4, ['Singed'] = 65, ['OrderInhibitor'] = 65, ['Diana'] = 65, ['HA_FB_HealthRelic'] = 65, ['TT_OrderInhibitor'] = 65, ['GreatWraith'] = 80.0, ['Yasuo'] = 65, ['OrderTurretDragon'] = 88.4, ['OrderTurretNormal'] = 88.4, ['LizardElder'] = 65.0, ['HA_AP_ChaosTurret'] = 88.4, ['Ahri'] = 65, ['Lulu'] = 65, ['ChaosInhibitor'] = 65, ['HA_AP_ChaosTurret3'] = 88.4, ['HA_AP_ChaosTurret2'] = 88.4, ['ChaosTurretWorm2'] = 88.4, ['TT_OrderTurret1'] = 88.4, ['TT_OrderTurret2'] = 88.4, ['TT_OrderTurret3'] = 88.4, ['LuluFaerie'] = 65, ['HA_AP_OrderTurret'] = 88.4, ['OrderTurretAngel'] = 88.4, ['YellowTrinketUpgrade'] = 1, ['MasterYi'] = 65, ['Lissandra'] = 65, ['ARAMOrderTurretNexus'] = 88.4, ['Draven'] = 65, ['FiddleSticks'] = 65, ['SmallGolem'] = 80.0, ['ARAMOrderTurretFront'] = 88.4, ['ChaosTurretTutorial'] = 88.4, ['NasusUlt'] = 80.0, ['Maokai'] = 80.0, ['Wraith'] = 50.0, ['Wolf'] = 50.0, ['Sivir'] = 65, ['Corki'] = 65, ['Janna'] = 65, ['Nasus'] = 80.0, ['Golem'] = 80.0, ['ARAMChaosTurretFront'] = 88.4, ['ARAMOrderTurretInhib'] = 88.4, ['LeeSin'] = 65, ['HA_AP_ChaosTurretTutorial'] = 88.4, ['GiantWolf'] = 65.0, ['HA_AP_OrderTurretTutorial'] = 88.4, ['YoungLizard'] = 50.0, ['Jax'] = 65, ['LesserWraith'] = 50.0, ['Blitzcrank'] = 80.0, ['brush_D_SR'] = 65, ['brush_E_SR'] = 65, ['brush_F_SR'] = 65, ['brush_C_SR'] = 65, ['brush_A_SR'] = 65, ['brush_B_SR'] = 65, ['ARAMChaosTurretInhib'] = 88.4, ['Shen'] = 65, ['Nocturne'] = 65, ['Sona'] = 65, ['ARAMChaosTurretNexus'] = 88.4, ['YellowTrinket'] = 1, ['OrderTurretTutorial'] = 88.4, ['Caitlyn'] = 65, ['Trundle'] = 65, ['Malphite'] = 80.0, ['Mordekaiser'] = 80.0, ['ZyraSeed'] = 65, ['Vi'] = 50, ['Tutorial_Red_Minion_Wizard'] = 48.0, ['Renekton'] = 80.0, ['Anivia'] = 65, ['Fizz'] = 65, ['Heimerdinger'] = 55.0, ['Evelynn'] = 65, ['Rumble'] = 80.0, ['Leblanc'] = 65, ['Darius'] = 80.0, ['OlafAxe'] = 50.0, ['Viktor'] = 65, ['XinZhao'] = 65, ['Orianna'] = 65, ['Vladimir'] = 65, ['Nidalee'] = 65, ['Tutorial_Red_Minion_Basic'] = 48.0, ['ZedShadow'] = 65, ['Syndra'] = 65, ['Zac'] = 80.0, ['Olaf'] = 65, ['Veigar'] = 55.0, ['Twitch'] = 65, ['Alistar'] = 80.0, ['Akali'] = 65, ['Urgot'] = 80.0, ['Leona'] = 65, ['Talon'] = 65, ['Karma'] = 65, ['Jayce'] = 65, ['Galio'] = 80.0, ['Shaco'] = 65, ['Taric'] = 65, ['TwistedFate'] = 65, ['Varus'] = 65, ['Garen'] = 65, ['Swain'] = 65, ['Vayne'] = 65, ['Fiora'] = 65, ['Quinn'] = 65, ['Kayle'] = 65, ['Blue_Minion_Basic'] = 48.0, ['Brand'] = 65, ['Teemo'] = 55.0, ['Amumu'] = 55.0, ['Annie'] = 55.0, ['Odin_Blue_Minion_caster'] = 48.0, ['Elise'] = 65, ['Nami'] = 65, ['Poppy'] = 55.0, ['AniviaEgg'] = 65, ['Tristana'] = 55.0, ['Graves'] = 65, ['Morgana'] = 65, ['Gragas'] = 80.0, ['MissFortune'] = 65, ['Warwick'] = 65, ['Cassiopeia'] = 65, ['Tutorial_Blue_Minion_Wizard'] = 48.0, ['DrMundo'] = 80.0, ['Volibear'] = 80.0, ['Irelia'] = 65, ['Odin_Red_Minion_Caster'] = 48.0, ['Lucian'] = 65, ['Yorick'] = 80.0, ['RammusPB'] = 65, ['Red_Minion_Basic'] = 48.0, ['Udyr'] = 65, ['MonkeyKing'] = 65, ['Tutorial_Blue_Minion_Basic'] = 48.0, ['Kennen'] = 55.0, ['Nunu'] = 65, ['Ryze'] = 65, ['Zed'] = 65, ['Nautilus'] = 80.0, ['Gangplank'] = 65, ['shopevo'] = 65, ['Lux'] = 65, ['Sejuani'] = 80.0, ['Ezreal'] = 65, ['OdinNeutralGuardian'] = 65, ['Khazix'] = 65, ['Sion'] = 80.0, ['Aatrox'] = 65, ['Hecarim'] = 80.0, ['Pantheon'] = 65, ['Shyvana'] = 50.0, ['Zyra'] = 65, ['Karthus'] = 65, ['Rammus'] = 65, ['Zilean'] = 65, ['Chogath'] = 80.0, ['Malzahar'] = 65, ['YorickRavenousGhoul'] = 1.0, ['YorickSpectralGhoul'] = 1.0, ['JinxMine'] = 65, ['YorickDecayedGhoul'] = 1.0, ['XerathArcaneBarrageLauncher'] = 65, ['Odin_SOG_Order_Crystal'] = 65, ['TestCube'] = 65, ['ShyvanaDragon'] = 80.0, ['FizzBait'] = 65, ['ShopKeeper'] = 65, ['Blue_Minion_MechMelee'] = 65.0, ['OdinQuestBuff'] = 65, ['TT_Buffplat_L'] = 65, ['TT_Buffplat_R'] = 65, ['KogMawDead'] = 65, ['TempMovableChar'] = 48.0, ['Lizard'] = 50.0, ['GolemOdin'] = 80.0, ['OdinOpeningBarrier'] = 65, ['TT_ChaosTurret4'] = 88.4, ['TT_Flytrap_A'] = 65, ['TT_Chains_Order_Periph'] = 65, ['TT_NWolf'] = 65.0, ['ShopMale'] = 65, ['OdinShieldRelic'] = 65, ['TT_Chains_Xaos_Base'] = 65, ['LuluSquill'] = 50.0, ['TT_Shopkeeper'] = 65, ['redDragon'] = 100.0, ['MonkeyKingClone'] = 65, ['Odin_skeleton'] = 65, ['OdinChaosTurretShrine'] = 88.4, ['Cassiopeia_Death'] = 65, ['OdinCenterRelic'] = 48.0, ['Ezreal_cyber_1'] = 65, ['Ezreal_cyber_3'] = 65, ['Ezreal_cyber_2'] = 65, ['OdinRedSuperminion'] = 55.0, ['TT_Speedshrine_Gears'] = 65, ['JarvanIVWall'] = 65, ['DestroyedNexus'] = 65, ['ARAMOrderNexus'] = 65, ['Red_Minion_MechCannon'] = 65.0, ['OdinBlueSuperminion'] = 55.0, ['SyndraOrbs'] = 65, ['LuluKitty'] = 50.0, ['SwainNoBird'] = 65, ['LuluLadybug'] = 50.0, ['CaitlynTrap'] = 65, ['TT_Shroom_A'] = 65, ['ARAMChaosTurretShrine'] = 88.4, ['Odin_Windmill_Propellers'] = 65, ['DestroyedInhibitor'] = 65, ['TT_NWolf2'] = 50.0, ['OdinMinionGraveyardPortal'] = 1.0, ['SwainBeam'] = 65, ['Summoner_Rider_Order'] = 65.0, ['TT_Relic'] = 65, ['odin_lifts_crystal'] = 65, ['OdinOrderTurretShrine'] = 88.4, ['SpellBook1'] = 65, ['Blue_Minion_MechCannon'] = 65.0, ['TT_ChaosInhibitor_D'] = 65, ['Odin_SoG_Chaos'] = 65, ['TrundleWall'] = 65, ['HA_AP_HealthRelic'] = 65, ['OrderTurretShrine'] = 88.4, ['OriannaBall'] = 48.0, ['ChaosTurretShrine'] = 88.4, ['LuluCupcake'] = 50.0, ['HA_AP_ChaosTurretShrine'] = 88.4, ['TT_Chains_Bot_Lane'] = 65, ['TT_NWraith2'] = 50.0, ['TT_Tree_A'] = 65, ['SummonerBeacon'] = 65, ['Odin_Drill'] = 65, ['TT_NGolem'] = 80.0, ['Shop'] = 65, ['AramSpeedShrine'] = 65, ['DestroyedTower'] = 65, ['OriannaNoBall'] = 65, ['Odin_Minecart'] = 65, ['Summoner_Rider_Chaos'] = 65.0, ['OdinSpeedShrine'] = 65, ['TT_Brazier'] = 65, ['TT_SpeedShrine'] = 65, ['odin_lifts_buckets'] = 65, ['OdinRockSaw'] = 65, ['OdinMinionSpawnPortal'] = 1.0, ['SyndraSphere'] = 48.0, ['TT_Nexus_Gears'] = 65, ['Red_Minion_MechMelee'] = 65.0, ['SwainRaven'] = 65, ['crystal_platform'] = 65, ['MaokaiSproutling'] = 48.0, ['Urf'] = 65, ['TestCubeRender10Vision'] = 65, ['MalzaharVoidling'] = 10.0, ['GhostWard'] = 1, ['MonkeyKingFlying'] = 65, ['LuluPig'] = 50.0, ['AniviaIceBlock'] = 65, ['TT_OrderInhibitor_D'] = 65, ['yonkey'] = 65, ['Odin_SoG_Order'] = 65, ['RammusDBC'] = 65, ['FizzShark'] = 65, ['LuluDragon'] = 50.0, ['OdinTestCubeRender'] = 65, ['OdinCrane'] = 65, ['TT_Tree1'] = 65, ['ARAMOrderTurretShrine'] = 88.4, ['TT_Chains_Order_Base'] = 65, ['Odin_Windmill_Gears'] = 65, ['ARAMChaosNexus'] = 65, ['TT_NWraith'] = 50.0, ['TT_OrderTurret4'] = 88.4, ['Odin_SOG_Chaos_Crystal'] = 65, ['TT_SpiderLayer_Web'] = 65, ['OdinQuestIndicator'] = 1.0, ['JarvanIVStandard'] = 65, ['TT_DummyPusher'] = 65, ['OdinClaw'] = 65, ['EliseSpiderling'] = 1.0, ['QuinnValor'] = 65, ['UdyrTigerUlt'] = 65, ['UdyrTurtleUlt'] = 65, ['UdyrUlt'] = 65, ['UdyrPhoenixUlt'] = 65, ['ShacoBox'] = 10, ['HA_AP_Poro'] = 65, ['AnnieTibbers'] = 80.0, ['UdyrPhoenix'] = 65, ['UdyrTurtle'] = 65, ['UdyrTiger'] = 65, ['HA_AP_OrderShrineTurret'] = 88.4, ['HA_AP_OrderTurretRubble'] = 65, ['HA_AP_Chains_Long'] = 65, ['HA_AP_OrderCloth'] = 65, ['HA_AP_PeriphBridge'] = 65, ['HA_AP_BridgeLaneStatue'] = 65, ['HA_AP_ChaosTurretRubble'] = 88.4, ['HA_AP_BannerMidBridge'] = 65, ['HA_AP_PoroSpawner'] = 50.0, ['HA_AP_Cutaway'] = 65, ['HA_AP_Chains'] = 65, ['HA_AP_ShpSouth'] = 65, ['HA_AP_HeroTower'] = 65, ['HA_AP_ShpNorth'] = 65, ['ChaosInhibitor_D'] = 65, ['ZacRebirthBloblet'] = 65, ['OrderInhibitor_D'] = 65, ['Nidalee_Spear'] = 65, ['Nidalee_Cougar'] = 65, ['TT_Buffplat_Chain'] = 65, ['WriggleLantern'] = 1, ['TwistedLizardElder'] = 65.0, ['RabidWolf'] = 65.0, ['HeimerTGreen'] = 50.0, ['HeimerTRed'] = 50.0, ['ViktorFF'] = 65, ['TwistedGolem'] = 80.0, ['TwistedSmallWolf'] = 50.0, ['TwistedGiantWolf'] = 65.0, ['TwistedTinyWraith'] = 50.0, ['TwistedBlueWraith'] = 50.0, ['TwistedYoungLizard'] = 50.0, ['Red_Minion_Melee'] = 48.0, ['Blue_Minion_Melee'] = 48.0, ['Blue_Minion_Healer'] = 48.0, ['Ghast'] = 60.0, ['blueDragon'] = 100.0, ['Red_Minion_MechRange'] = 65.0, ['Test_CubeSphere'] = 65,}

	ChampInfoTable = {}
	for i, enemy in ipairs(GetEnemyHeroes()) do
		ChampInfoTable[enemy.charName] = {CurrentVector = Vector(0,0,0), CurrentDirection = Vector(0,0,0), CurrentAngle = 0, CurrentHitBox = ChampHitBoxes[enemy.charName]}
	end


end
